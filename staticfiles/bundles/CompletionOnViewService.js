!function(e,t){for(var i in t)e[i]=t[i]}(window,webpackJsonp([35],{"./lms/static/completion/js/CompletionOnViewService.js":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){function n(t,i){var n=e(i).find(".xblock-student_view[data-mark-completed-on-view-after-delay]").get();if(n.length>0){var o=new s.a;n.forEach(function(e){var t=parseInt(e.dataset.markCompletedOnViewAfterDelay,10);t>=0&&o.addElement(e,t)}),o.addHandler(function(i,n){var s=i.dataset.usageId;s&&!a.has(s)&&n.elementHasBeenViewed&&e.ajax({type:"POST",url:t.handlerUrl(i,"publish_completion"),data:JSON.stringify({completion:1})}).then(function(){a.add(s),i.dataset.markCompletedOnViewAfterDelay=0})})}}t.markBlocksCompletedOnViewIfNeeded=n;var s=i("./lms/static/completion/js/ViewedEvent.js"),a=new Set}.call(t,i(0))},"./lms/static/completion/js/ViewedEvent.js":function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){function i(){var i=Date.now();n+t<i&&(n=i,e())}var n=0;return i}i.d(t,"a",function(){return r});var a=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),o=function(){function e(t,i,s){n(this,e),this.el=t,this.viewedAfterMs=i,this.callback=s,this.topSeen=!1,this.bottomSeen=!1,this.seenForMs=0,this.becameVisibleAt=void 0,this.hasBeenViewed=!1}return a(e,[{key:"getBoundingRect",value:function(){return this.el.getBoundingClientRect()}},{key:"handleVisible",value:function(){var e=this;this.becameVisibleAt||(this.becameVisibleAt=Date.now(),setTimeout(function(){e.checkIfViewed()},this.viewedAfterMs-this.seenForMs))}},{key:"handleNotVisible",value:function(){this.becameVisibleAt&&(this.seenForMs=Date.now()-this.becameVisibleAt),this.becameVisibleAt=void 0}},{key:"markTopSeen",value:function(){this.topSeen=!0,this.checkIfViewed()}},{key:"markBottomSeen",value:function(){this.bottomSeen=!0,this.checkIfViewed()}},{key:"getTotalTimeSeen",value:function(){return this.becameVisibleAt?this.seenForMs+(Date.now()-this.becameVisibleAt):this.seenForMs}},{key:"areViewedCriteriaMet",value:function(){return this.topSeen&&this.bottomSeen&&this.getTotalTimeSeen()>=this.viewedAfterMs}},{key:"checkIfViewed",value:function(){this.hasBeenViewed||this.areViewedCriteriaMet()&&(this.hasBeenViewed=!0,this.callback(this.el,{elementHasBeenViewed:this.hasBeenViewed}))}}]),e}(),r=function(){function e(){n(this,e),this.elementViewings=new Set,this.handlers=[],this.registerDomHandlers()}return a(e,[{key:"addElement",value:function(e,t){var i=this;this.elementViewings.add(new o(e,t,function(e,t){return i.callHandlers(e,t)})),this.updateVisible()}},{key:"addHandler",value:function(e){this.handlers.push(e)}},{key:"updateVisible",value:function(){this.elementViewings.forEach(function(e){if(!e.hasBeenViewed){var t=Date.now(),i=e.getBoundingRect(),n=!1;i.top>0&&i.top<window.innerHeight&&(e.markTopSeen(t),n=!0),i.bottom>0&&i.bottom<window.innerHeight&&(e.markBottomSeen(t),n=!0),i.top<0&&i.bottom>window.innerHeight&&(n=!0),n?e.handleVisible(t):e.handleNotVisible(t)}})}},{key:"registerDomHandlers",value:function(){var e=this;window.onscroll=s(function(){return e.updateVisible()},100),window.onresize=s(function(){return e.updateVisible()},100),this.updateVisible()}},{key:"callHandlers",value:function(e,t){this.handlers.forEach(function(i){i(e,t)})}}]),e}()}},["./lms/static/completion/js/CompletionOnViewService.js"]));