var edx=edx||{};(function($,analytics){"use strict";$(document).ready(function(){var $errorContainer=$(".credit-error-msg"),creditStatusError=$errorContainer.data("credit-error");if(creditStatusError==="True"){$errorContainer.toggleClass("is-hidden")}$(".purchase-credit-btn").on("click",function(event){var courseKey=$(event.target).data("course-key");analytics.track("edx.bi.credit.clicked_purchase_credit",{category:"credit",label:courseKey})});$(".pending-credit-btn").on("click",function(event){var $target=$(event.target),courseKey=$target.data("course-key"),username=$target.data("user"),providerId=$target.data("provider");event.preventDefault();edx.commerce.credit.createCreditRequest(providerId,courseKey,username).fail(function(){$(".credit-action").hide();$errorContainer.toggleClass("is-hidden")})})})})(jQuery,window.analytics);var edx=edx||{};(function($){"use strict";edx.dashboard=edx.dashboard||{};edx.dashboard.donation={};edx.dashboard.donation.DonationView=function(params){var configureForm=function(form,method,url,params){$("input",form).remove();form.attr("action",url);form.attr("method",method);_.each(params,function(value,key){$("<input>").attr({type:"hidden",name:key,value:value}).appendTo(form)})};var firePaymentAnalyticsEvent=function(course){analytics.track("edx.bi.user.payment_processor.visited",{category:"donations",label:course})};var addDonationToCart=function(amount,course){return $.ajax({url:"/shoppingcart/donation/",type:"POST",data:{amount:amount,course_id:course}})};var view={initialize:function(params){this.$el=params.el;this.course=params.course;_.bindAll(view,"render","donate","startPayment","validate","startPayment","displayServerError","submitPaymentForm");return this},render:function(){var html=_.template($("#donation-tpl").html())({});this.$el.html(html);this.$amount=$('input[name="amount"]',this.$el);this.$submit=$(".action-donate",this.$el);this.$errorMsg=$(".donation-error-msg",this.$el);this.$paymentForm=$(".payment-form",this.$el);this.$submit.click(this.donate);return this},donate:function(event){if(event){event.preventDefault()}this.$submit.addClass("disabled");if(this.validate()){var amount=this.$amount.val();addDonationToCart(amount,this.course).done(this.startPayment).fail(this.displayServerError)}else{this.$submit.removeClass("disabled")}},startPayment:function(data){configureForm(this.$paymentForm,"post",data.payment_url,data.payment_params);firePaymentAnalyticsEvent(this.course);this.submitPaymentForm(this.$paymentForm)},validate:function(){var amount=this.$amount.val();var isValid=this.validateAmount(amount);if(isValid){this.$amount.removeClass("validation-error");this.$errorMsg.text("")}else{this.$amount.addClass("validation-error");this.$errorMsg.text(gettext("Please enter a valid donation amount."))}return isValid},validateAmount:function(amount){var amountRegex=/^\d+.\d{2}$|^\d+$/i;if(!amountRegex.test(amount)){return false}if(parseFloat(amount)<.01){return false}return true},displayServerError:function(){this.$errorMsg.text(gettext("Your donation could not be submitted."));this.$submit.removeClass("disabled")},submitPaymentForm:function(form){form.submit()}};view.initialize(params);return view};$(document).ready(function(){$(".donate-container").each(function(){var $container=$(this);var course=$container.data("course");var view=new edx.dashboard.donation.DonationView({el:$container,course:course}).render()})})})(jQuery);var edx=edx||{};(function($){"use strict";edx.dashboard=edx.dashboard||{};edx.dashboard.dropdown={};edx.dashboard.dropdown.toggleCourseActionsDropdownMenu=function(event){var $target=$(event.currentTarget),dashboardIndex=$target.data().dashboardIndex,$dropdown=$($target.data("dropdownSelector")||"#actions-dropdown-"+dashboardIndex),$dropdownButton=$($target.data("dropdownButtonSelector")||"#actions-dropdown-link-"+dashboardIndex),ariaExpandedState=$dropdownButton.attr("aria-expanded")==="true",menuItems=$dropdown.find("a");var catchKeyPress=function(object,event){var $focusedItem=$(":focus");var focusedItemIndex=menuItems.index($focusedItem);var itemToFocusIndex;if(event.which===32||event.which===27){$dropdownButton.click();event.preventDefault()}else if(event.which===38||event.which===9&&event.shiftKey){if(focusedItemIndex===0||focusedItemIndex===-1){menuItems.last().focus()}else{itemToFocusIndex=focusedItemIndex-1;menuItems.get(itemToFocusIndex).focus()}event.preventDefault()}else if(event.which===40||event.which===9){if(focusedItemIndex===menuItems.length-1||focusedItemIndex===-1){menuItems.first().focus()}else{itemToFocusIndex=focusedItemIndex+1;menuItems.get(itemToFocusIndex).focus()}event.preventDefault()}};$dropdown.toggleClass("is-visible");if($dropdown.hasClass("is-visible")){$dropdown.attr("tabindex",-1);$dropdown.focus()}else{$dropdown.removeAttr("tabindex");$dropdownButton.focus()}$dropdownButton.attr("aria-expanded",!ariaExpandedState);$dropdown.on("keydown",function(e){catchKeyPress($(this),e)})};edx.dashboard.dropdown.bindToggleButtons=function(selector){$(selector).bind("click",edx.dashboard.dropdown.toggleCourseActionsDropdownMenu)};$(document).ready(function(){edx.dashboard.dropdown.bindToggleButtons(".action-more");edx.dashboard.dropdown.bindToggleButtons(".js-entitlement-action-more")})})(jQuery);var edx=edx||{};(function($,gettext,Logger,accessibleModal,interpolate){"use strict";edx.dashboard=edx.dashboard||{};edx.dashboard.legacy={};edx.dashboard.legacy.init=function(urls){var $notifications=$(".dashboard-notifications"),$upgradeButtonLinks=$(".action-upgrade"),$verifyButtonLinks=$(".verification-cta > .cta");if($notifications.children().length>0){$notifications.focus()}window.analytics.trackLink($upgradeButtonLinks,"edx.bi.dashboard.upgrade_button.clicked",generateProperties);window.analytics.trackLink($verifyButtonLinks,"edx.bi.user.verification.resumed",generateProperties);window.analytics.trackLink($(".action-linkedin-profile"),"edx.bi.user.linkedin_add_to_profile",function(element){var $el=$(element);return{category:"linkedin",label:$el.data("course-id"),mode:$el.data("certificate-mode")}});function generateProperties(element){var $el=$(element),properties={};if($el.hasClass("action-upgrade")){properties.category="upgrade"}else if($el.hasClass("cta")){properties.category="verification"}properties.label=$el.data("course-id");return properties}function setDialogAttributes(isPaidCourse,certNameLong,courseNumber,courseName,enrollmentMode,showRefundOption,courseKey){var auditRefundableCourses=(window.experimentVariables||{}).auditRefundableCourses,courseInExperiment=auditRefundableCourses?auditRefundableCourses.indexOf(courseKey)>-1:false,diagAttr={};if(isPaidCourse||courseInExperiment){if(showRefundOption){diagAttr["data-refund-info"]=gettext("You will be refunded the amount you paid.")}else{diagAttr["data-refund-info"]=gettext("You will not be refunded the amount you paid.")}diagAttr["data-track-info"]=gettext("Are you sure you want to unenroll from the purchased course "+"%(courseName)s (%(courseNumber)s)?")}else if(enrollmentMode!=="verified"){diagAttr["data-track-info"]=gettext("Are you sure you want to unenroll from %(courseName)s "+"(%(courseNumber)s)?")}else if(showRefundOption){diagAttr["data-track-info"]=gettext("Are you sure you want to unenroll from the verified "+"%(certNameLong)s  track of %(courseName)s  (%(courseNumber)s)?");diagAttr["data-refund-info"]=gettext("You will be refunded the amount you paid.")}else{diagAttr["data-track-info"]=gettext("Are you sure you want to unenroll from the verified "+"%(certNameLong)s track of %(courseName)s (%(courseNumber)s)?");diagAttr["data-refund-info"]=gettext("The refund deadline for this course has passed,"+"so you will not receive a refund.")}return diagAttr}$("#failed-verification-button-dismiss").click(function(){$.ajax({url:urls.verifyToggleBannerFailedOff,type:"post"});$("#failed-verification-banner").addClass("is-hidden")});$(".action-upgrade").click(function(){Logger.log("edx.course.enrollment.upgrade.clicked",{location:"learner_dashboard"})});$(".action-email-settings").click(function(event){$("#email_settings_course_id").val($(event.target).data("course-id"));$("#email_settings_course_number").text($(event.target).data("course-number"));if($(event.target).data("optout")==="False"){$("#receive_emails").prop("checked",true)}});$(".action-unenroll").click(function(event){var isPaidCourse=$(event.target).data("course-is-paid-course")==="True",certNameLong=$(event.target).data("course-cert-name-long"),enrollmentMode=$(event.target).data("course-enrollment-mode"),courseNumber=$(event.target).data("course-number"),courseName=$(event.target).data("course-name"),courseRefundUrl=$(event.target).data("course-refund-url"),courseKey=$(event.target).data("course-id"),dialogMessageAttr;var request=$.ajax({url:courseRefundUrl,method:"GET",dataType:"json"});request.success(function(data,textStatus,xhr){if(xhr.status===200){dialogMessageAttr=setDialogAttributes(isPaidCourse,certNameLong,courseNumber,courseName,enrollmentMode,data.course_refundable_status,courseKey);$("#track-info").empty();$("#refund-info").empty();$("#track-info").html(interpolate(dialogMessageAttr["data-track-info"],{courseNumber:['<span id="unenroll_course_number">',courseNumber,"</span>"].join(""),courseName:['<span id="unenroll_course_name">',courseName,"</span>"].join(""),certNameLong:['<span id="unenroll_cert_name">',certNameLong,"</span>"].join("")},true));if("data-refund-info"in dialogMessageAttr){$("#refund-info").text(dialogMessageAttr["data-refund-info"])}$("#unenroll_course_id").val($(event.target).data("course-id"))}else{$("#unenroll_error").text(gettext("Unable to determine whether we should give you a refund because"+" of System Error. Please try again later.")).stop().css("display","block");$('#unenroll_form input[type="submit"]').prop("disabled",true)}});request.fail(function(){$("#unenroll_error").text(gettext("Unable to determine whether we should give you a refund because"+" of System Error. Please try again later.")).stop().css("display","block");$('#unenroll_form input[type="submit"]').prop("disabled",true)});$("#unenroll-modal").css("position","fixed")});$("#email_settings_form").submit(function(){$.ajax({type:"POST",url:urls.changeEmailSettings,data:$(this).serializeArray(),success:function(data){if(data.success){location.href=urls.dashboard}},error:function(xhr){if(xhr.status===403){location.href=urls.signInUser}}});return false});$(".action-email-settings").each(function(index){$(this).attr("id","email-settings-"+index);var trigger="#"+$(this).attr("id");accessibleModal(trigger,"#email-settings-modal .close-modal","#email-settings-modal","#dashboard-main")});$(".action-unenroll").each(function(index){$(this).attr("id","unenroll-"+index);var trigger="#"+$(this).attr("id");accessibleModal(trigger,"#unenroll-modal .close-modal","#unenroll-modal","#dashboard-main")});$("#unregister_block_course").click(function(event){$("#unenroll_course_id").val($(event.target).data("course-id"));$("#unenroll_course_number").text($(event.target).data("course-number"));$("#unenroll_course_name").text($(event.target).data("course-name"))})}})(jQuery,gettext,Logger,accessible_modal,interpolate);var edx=edx||{};(function($){"use strict";edx.dashboard=edx.dashboard||{};edx.dashboard.generateTrackProperties=function(element){var $el=$(element),properties={};properties.category="dashboard";properties.label=$el.data("course-key");return properties};edx.dashboard.trackCourseTitleClicked=function($courseTitleLink,properties){var trackProperty=properties||edx.dashboard.generateTrackProperties;window.analytics.trackLink($courseTitleLink,"edx.bi.dashboard.course_title.clicked",trackProperty)};edx.dashboard.trackCourseImageLinkClicked=function($courseImageLink,properties){var trackProperty=properties||edx.dashboard.generateTrackProperties;window.analytics.trackLink($courseImageLink,"edx.bi.dashboard.course_image.clicked",trackProperty)};edx.dashboard.trackEnterCourseLinkClicked=function($enterCourseLink,properties){var trackProperty=properties||edx.dashboard.generateTrackProperties;window.analytics.trackLink($enterCourseLink,"edx.bi.dashboard.enter_course.clicked",trackProperty)};edx.dashboard.trackCourseOptionDropdownClicked=function($optionsDropdown,properties){var trackProperty=properties||edx.dashboard.generateTrackProperties;window.analytics.trackLink($optionsDropdown,"edx.bi.dashboard.course_options_dropdown.clicked",trackProperty)};edx.dashboard.trackLearnVerifiedLinkClicked=function($courseLearnVerified,properties){var trackProperty=properties||edx.dashboard.generateTrackProperties;window.analytics.trackLink($courseLearnVerified,"edx.bi.dashboard.verified_info_link.clicked",trackProperty)};edx.dashboard.trackFindCourseBtnClicked=function($findCoursesBtn,properties){var trackProperty=properties||{category:"dashboard",label:null};window.analytics.trackLink($findCoursesBtn,"edx.bi.dashboard.find_courses_button.clicked",trackProperty)};$(document).ready(function(){if(!window.analytics){return}edx.dashboard.trackCourseTitleClicked($(".course-title > a"));edx.dashboard.trackCourseImageLinkClicked($(".cover"));edx.dashboard.trackEnterCourseLinkClicked($(".enter-course"));edx.dashboard.trackCourseOptionDropdownClicked($(".wrapper-action-more"));edx.dashboard.trackLearnVerifiedLinkClicked($(".verified-info"));edx.dashboard.trackFindCourseBtnClicked($(".btn-find-courses"))})})(jQuery);
