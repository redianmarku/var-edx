(function(){"use strict";function t(t,i){function n(){this.constructor=t}for(var s in i)e.call(i,s)&&(t[s]=i[s]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t}var e={}.hasOwnProperty,i=[].indexOf||function(t){for(var e=0,i=this.length;i>e;e++)if(e in this&&this[e]===t)return e;return-1};"undefined"!=typeof Backbone&&null!==Backbone&&(this.Content=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.contents={},n.contentInfos={},n.prototype.template=function(){return DiscussionUtil.getTemplate("_content")},n.prototype.actions={editable:".admin-edit",can_reply:".discussion-reply",can_delete:".admin-delete",can_openclose:".admin-openclose",can_report:".admin-report",can_vote:".admin-vote"},n.prototype.urlMappers={},n.prototype.urlFor=function(t){return this.urlMappers[t].apply(this)},n.prototype.can=function(t){return(this.get("ability")||{})[t]},n.prototype.canBeEndorsed=function(){return!1},n.prototype.updateInfo=function(t){return t?(this.set("ability",t.ability),this.set("voted",t.voted),this.set("subscribed",t.subscribed)):void 0},n.prototype.addComment=function(t,e){var i,n,s;return e=e||{},e.silent||(s=this.get("thread"),i=parseInt(s.get("comments_count")),s.set("comments_count",i+1)),this.get("children").push(t),n=new Comment($.extend({},t,{thread:this.get("thread")})),this.get("comments").add(n),this.trigger("comment:add"),n},n.prototype.removeComment=function(t){var e,i;return i=this.get("thread"),e=parseInt(i.get("comments_count")),i.set("comments_count",e-1-t.getCommentsCount()),this.trigger("comment:remove")},n.prototype.resetComments=function(t){var e,i,n,s,o;for(this.set("children",[]),this.set("comments",new Comments),s=t||[],o=[],i=0,n=s.length;n>i;i++)e=s[i],o.push(this.addComment(e,{silent:!0}));return o},n.prototype.initialize=function(){var t;return n.addContent(this.id,this),t=this.get("user_id"),t?(this.set("staff_authored",DiscussionUtil.isStaff(t)),this.set("community_ta_authored",DiscussionUtil.isTA(t)||DiscussionUtil.isGroupTA(t))):(this.set("staff_authored",!1),this.set("community_ta_authored",!1)),n.getInfo(this.id)&&this.updateInfo(n.getInfo(this.id)),this.set("user_url",DiscussionUtil.urlFor("user_profile",t)),this.resetComments(this.get("children"))},n.prototype.remove=function(){return"comment"===this.get("type")?(this.get("thread").removeComment(this),this.get("thread").trigger("comment:remove",this)):this.trigger("thread:remove",this)},n.addContent=function(t,e){this.contents[t]=e},n.getContent=function(t){return this.contents[t]},n.getInfo=function(t){return this.contentInfos[t]},n.loadContentInfos=function(t){var e,i;for(e in t)t.hasOwnProperty(e)&&(i=t[e],this.getContent(e)&&this.getContent(e).updateInfo(i));return $.extend(this.contentInfos,t)},n.prototype.pinThread=function(){var t;return t=this.get("pinned"),this.set("pinned",t),this.trigger("change",this)},n.prototype.unPinThread=function(){var t;return t=this.get("pinned"),this.set("pinned",t),this.trigger("change",this)},n.prototype.flagAbuse=function(){var t;return t=this.get("abuse_flaggers"),t.push(window.user.get("id")),this.set("abuse_flaggers",t),this.trigger("change",this)},n.prototype.unflagAbuse=function(){return this.get("abuse_flaggers").pop(window.user.get("id")),this.trigger("change",this)},n.prototype.isFlagged=function(){var t,e;return e=DiscussionUtil.getUser(),t=this.get("abuse_flaggers"),e&&(i.call(t,e.id)>=0||DiscussionUtil.isPrivilegedUser(e.id)&&t.length>0)},n.prototype.incrementVote=function(t){var e;return e=_.clone(this.get("votes")),e.up_count=e.up_count+t,this.set("votes",e)},n.prototype.vote=function(){return this.incrementVote(1)},n.prototype.unvote=function(){return this.incrementVote(-1)},n}(Backbone.Model),this.Thread=function(e){function i(){return i.__super__.constructor.apply(this,arguments)}return t(i,e),i.prototype.urlMappers={retrieve:function(){return DiscussionUtil.urlFor("retrieve_single_thread",this.get("commentable_id"),this.id)},reply:function(){return DiscussionUtil.urlFor("create_comment",this.id)},unvote:function(){return DiscussionUtil.urlFor("undo_vote_for_"+this.get("type"),this.id)},upvote:function(){return DiscussionUtil.urlFor("upvote_"+this.get("type"),this.id)},downvote:function(){return DiscussionUtil.urlFor("downvote_"+this.get("type"),this.id)},close:function(){return DiscussionUtil.urlFor("openclose_thread",this.id)},update:function(){return DiscussionUtil.urlFor("update_thread",this.id)},_delete:function(){return DiscussionUtil.urlFor("delete_thread",this.id)},follow:function(){return DiscussionUtil.urlFor("follow_thread",this.id)},unfollow:function(){return DiscussionUtil.urlFor("unfollow_thread",this.id)},flagAbuse:function(){return DiscussionUtil.urlFor("flagAbuse_"+this.get("type"),this.id)},unFlagAbuse:function(){return DiscussionUtil.urlFor("unFlagAbuse_"+this.get("type"),this.id)},pinThread:function(){return DiscussionUtil.urlFor("pin_thread",this.id)},unPinThread:function(){return DiscussionUtil.urlFor("un_pin_thread",this.id)}},i.prototype.initialize=function(){return this.set("thread",this),i.__super__.initialize.call(this)},i.prototype.comment=function(){return this.set("comments_count",parseInt(this.get("comments_count"))+1)},i.prototype.follow=function(){return this.set("subscribed",!0)},i.prototype.unfollow=function(){return this.set("subscribed",!1)},i.prototype.display_body=function(){return this.has("highlighted_body")?String(this.get("highlighted_body")).replace(/<highlight>/g,"<mark>").replace(/<\/highlight>/g,"</mark>"):this.get("body")},i.prototype.display_title=function(){return this.has("highlighted_title")?String(this.get("highlighted_title")).replace(/<highlight>/g,"<mark>").replace(/<\/highlight>/g,"</mark>"):this.get("title")},i.prototype.toJSON=function(){var t;return t=_.clone(this.attributes),_.extend(t,{title:this.display_title(),body:this.display_body()})},i.prototype.created_at_date=function(){return new Date(this.get("created_at"))},i.prototype.created_at_time=function(){return new Date(this.get("created_at")).getTime()},i.prototype.hasResponses=function(){return this.get("comments_count")>0},i}(this.Content),this.Comment=function(e){function i(){var t=this;return this.canBeEndorsed=function(){return i.prototype.canBeEndorsed.apply(t,arguments)},i.__super__.constructor.apply(this,arguments)}return t(i,e),i.prototype.urlMappers={reply:function(){return DiscussionUtil.urlFor("create_sub_comment",this.id)},unvote:function(){return DiscussionUtil.urlFor("undo_vote_for_"+this.get("type"),this.id)},upvote:function(){return DiscussionUtil.urlFor("upvote_"+this.get("type"),this.id)},downvote:function(){return DiscussionUtil.urlFor("downvote_"+this.get("type"),this.id)},endorse:function(){return DiscussionUtil.urlFor("endorse_comment",this.id)},update:function(){return DiscussionUtil.urlFor("update_comment",this.id)},_delete:function(){return DiscussionUtil.urlFor("delete_comment",this.id)},flagAbuse:function(){return DiscussionUtil.urlFor("flagAbuse_"+this.get("type"),this.id)},unFlagAbuse:function(){return DiscussionUtil.urlFor("unFlagAbuse_"+this.get("type"),this.id)}},i.prototype.getCommentsCount=function(){var t;return t=0,this.get("comments").each(function(e){return t+=e.getCommentsCount()+1}),t},i.prototype.canBeEndorsed=function(){var t;return t=window.user.get("id"),t&&(DiscussionUtil.isPrivilegedUser(t)||"question"===this.get("thread").get("thread_type")&&this.get("thread").get("user_id")===t)},i}(this.Content),this.Comments=function(e){function i(){return i.__super__.constructor.apply(this,arguments)}return t(i,e),i.prototype.model=Comment,i.prototype.initialize=function(){var t=this;return this.bind("add",function(e){e.collection=t})},i.prototype.find=function(t){return _.first(this.where({id:t}))},i}(Backbone.Collection))}).call(window),RequireJS.define("common/js/discussion/content",function(){}),function(){"use strict";var t={}.hasOwnProperty,e=function(e,i){function n(){this.constructor=e}for(var s in i)t.call(i,s)&&(e[s]=i[s]);return n.prototype=i.prototype,e.prototype=new n,e.__super__=i.prototype,e};"undefined"!=typeof Backbone&&null!==Backbone&&(this.Discussion=function(t){function i(){return i.__super__.constructor.apply(this,arguments)}return e(i,t),i.prototype.model=Thread,i.prototype.initialize=function(t,e){var i=this;return e||(e={}),this.pages=e.pages||1,this.current_page=1,this.sort_preference=e.sort,this.is_commentable_divided=e.is_commentable_divided,this.bind("add",function(t){t.discussion=i}),this.setSortComparator(this.sort_preference),this.on("thread:remove",function(t){i.remove(t)})},i.prototype.find=function(t){return _.first(this.where({id:t}))},i.prototype.hasMorePages=function(){return this.current_page<this.pages},i.prototype.setSortComparator=function(t){switch(t){case"activity":this.comparator=this.sortByDateRecentFirst;break;case"votes":this.comparator=this.sortByVotes;break;case"comments":this.comparator=this.sortByComments}},i.prototype.addThread=function(t){var e;return this.find(t.id)?void 0:(e=new Thread(t),this.add(e),e)},i.prototype.retrieveAnotherPage=function(t,e,i,n){var s,o,r=this;switch(e||(e={}),i||(i={}),s={page:this.current_page+1},_.contains(["unread","unanswered","flagged"],e.filter)&&(s[e.filter]=!0),t){case"search":o=DiscussionUtil.urlFor("search"),s.text=e.search_text;break;case"commentables":o=DiscussionUtil.urlFor("retrieve_discussion",e.commentable_ids),s.commentable_ids=e.commentable_ids;break;case"all":o=DiscussionUtil.urlFor("threads");break;case"followed":o=DiscussionUtil.urlFor("followed_threads",e.user_id);break;case"user":o=DiscussionUtil.urlFor("user_profile",e.user_id)}return e.group_id&&(s.group_id=e.group_id),s.sort_key=i.sort_key||"activity",s.sort_order=i.sort_order||"desc",DiscussionUtil.safeAjax({$elem:this.$el,url:o,data:s,dataType:"json",success:function(t){var e,i,n;return e=r.models,n=[function(){var e,i,n,o;for(n=t.discussion_data,o=[],e=0,i=n.length;i>e;e++)s=n[e],o.push(new Thread(s));return o}()][0],i=_.union(e,n),Content.loadContentInfos(t.annotated_content_info),r.pages=t.num_pages,r.current_page=t.page,r.is_commentable_divided=t.is_commentable_divided,r.reset(i)},error:n})},i.prototype.sortByDate=function(t){return this.pinnedThreadsSortComparatorWithDate(t,!0)},i.prototype.sortByDateRecentFirst=function(t){return this.pinnedThreadsSortComparatorWithDate(t,!1)},i.prototype.sortByVotes=function(t,e){var i,n;return i=parseInt(t.get("votes").up_count),n=parseInt(e.get("votes").up_count),this.pinnedThreadsSortComparatorWithCount(t,e,i,n)},i.prototype.sortByComments=function(t,e){var i,n;return i=parseInt(t.get("comments_count")),n=parseInt(e.get("comments_count")),this.pinnedThreadsSortComparatorWithCount(t,e,i,n)},i.prototype.pinnedThreadsSortComparatorWithCount=function(t,e,i,n){return t.get("pinned")&&!e.get("pinned")?-1:e.get("pinned")&&!t.get("pinned")?1:i>n?-1:n>i?1:t.created_at_time()>e.created_at_time()?-1:1},i.prototype.pinnedThreadsSortComparatorWithDate=function(t,e){var i,n,s;return n=new Date(t.get("last_activity_at")).getTime(),t.get("pinned")?(s=new Date,i=new Date(s.getTime()+864e5+n)):i=n,e?i:-i},i}(Backbone.Collection))}.call(window),RequireJS.define("common/js/discussion/discussion",function(){}),function(){"use strict";this.DiscussionUtil=function(){function t(){}t.wmdEditors={},t.leftKey=37,t.rightKey=39,t.getTemplate=function(t){return $("script#"+t).html()},t.setUser=function(t){this.user=t},t.getUser=function(){return this.user},t.loadRoles=function(t){this.roleIds=t},t.isStaff=function(t){var e;return _.isUndefined(t)&&(t=this.user?this.user.id:void 0),_.isUndefined(this.roleIds)&&(this.roleIds={}),e=_.union(this.roleIds.Moderator,this.roleIds.Administrator),_.include(e,parseInt(t))},t.isTA=function(t){var e;return _.isUndefined(t)&&(t=this.user?this.user.id:void 0),e=_.union(this.roleIds["Community TA"]),_.include(e,parseInt(t))},t.isGroupTA=function(t){var e,i=t;return _.isUndefined(t)&&(i=this.user?this.user.id:void 0),e=_.union(this.roleIds["Group Moderator"]),_.include(e,parseInt(i,10))},t.isPrivilegedUser=function(t){return this.isStaff(t)||this.isTA(t)},t.bulkUpdateContentInfo=function(t){var e,i,n;n=[];for(e in t)t.hasOwnProperty(e)&&(i=t[e],n.push(Content.getContent(e).updateInfo(i)));return n},t.generateDiscussionLink=function(t,e,i){return $("<a>").addClass("discussion-link").attr("href","#").addClass(t).text(e).click(function(){return i(this)})},t.urlFor=function(t,e,i,n){return{follow_discussion:"/courses/"+$$course_id+"/discussion/"+e+"/follow",unfollow_discussion:"/courses/"+$$course_id+"/discussion/"+e+"/unfollow",create_thread:"/courses/"+$$course_id+"/discussion/"+e+"/threads/create",update_thread:"/courses/"+$$course_id+"/discussion/threads/"+e+"/update",create_comment:"/courses/"+$$course_id+"/discussion/threads/"+e+"/reply",delete_thread:"/courses/"+$$course_id+"/discussion/threads/"+e+"/delete",flagAbuse_thread:"/courses/"+$$course_id+"/discussion/threads/"+e+"/flagAbuse",unFlagAbuse_thread:"/courses/"+$$course_id+"/discussion/threads/"+e+"/unFlagAbuse",flagAbuse_comment:"/courses/"+$$course_id+"/discussion/comments/"+e+"/flagAbuse",unFlagAbuse_comment:"/courses/"+$$course_id+"/discussion/comments/"+e+"/unFlagAbuse",upvote_thread:"/courses/"+$$course_id+"/discussion/threads/"+e+"/upvote",downvote_thread:"/courses/"+$$course_id+"/discussion/threads/"+e+"/downvote",pin_thread:"/courses/"+$$course_id+"/discussion/threads/"+e+"/pin",un_pin_thread:"/courses/"+$$course_id+"/discussion/threads/"+e+"/unpin",undo_vote_for_thread:"/courses/"+$$course_id+"/discussion/threads/"+e+"/unvote",follow_thread:"/courses/"+$$course_id+"/discussion/threads/"+e+"/follow",unfollow_thread:"/courses/"+$$course_id+"/discussion/threads/"+e+"/unfollow",update_comment:"/courses/"+$$course_id+"/discussion/comments/"+e+"/update",endorse_comment:"/courses/"+$$course_id+"/discussion/comments/"+e+"/endorse",create_sub_comment:"/courses/"+$$course_id+"/discussion/comments/"+e+"/reply",delete_comment:"/courses/"+$$course_id+"/discussion/comments/"+e+"/delete",upvote_comment:"/courses/"+$$course_id+"/discussion/comments/"+e+"/upvote",downvote_comment:"/courses/"+$$course_id+"/discussion/comments/"+e+"/downvote",undo_vote_for_comment:"/courses/"+$$course_id+"/discussion/comments/"+e+"/unvote",upload:"/courses/"+$$course_id+"/discussion/upload",users:"/courses/"+$$course_id+"/discussion/users",search:"/courses/"+$$course_id+"/discussion/forum/search",retrieve_discussion:"/courses/"+$$course_id+"/discussion/forum/"+e+"/inline",retrieve_single_thread:"/courses/"+$$course_id+"/discussion/forum/"+e+"/threads/"+i,openclose_thread:"/courses/"+$$course_id+"/discussion/threads/"+e+"/close",user_profile:"/courses/"+$$course_id+"/discussion/forum/users/"+e,followed_threads:"/courses/"+$$course_id+"/discussion/forum/users/"+e+"/followed",threads:"/courses/"+$$course_id+"/discussion/forum",enable_notifications:"/notification_prefs/enable/",disable_notifications:"/notification_prefs/disable/",notifications_status:"/notification_prefs/status/"}[t]},t.ignoreEnterKey=function(t){return 13===t.which?t.preventDefault():void 0},t.activateOnSpace=function(t,e){return 32===t.which?(t.preventDefault(),e(t)):void 0},t.makeFocusTrap=function(t){return t.keydown(function(t){return 9===t.which?t.preventDefault():void 0})},t.showLoadingIndicator=function(t,e){var i=edx.HtmlUtils.joinHtml(edx.HtmlUtils.HTML("<div class='loading-animation' tabindex='0'>"),edx.HtmlUtils.HTML("<span class='icon fa fa-spinner' aria-hidden='true'></span><span class='sr'>"),gettext("Loading content"),edx.HtmlUtils.HTML("</span></div>")),n=$(i.toString());t.after(n),this.$_loading=n,e&&(this.makeFocusTrap(this.$_loading),this.$_loading.focus())},t.hideLoadingIndicator=function(){return this.$_loading.remove()},t.discussionAlert=function(t,e){var i,n,s=$("#alert-popup").html()||"";0===$("#discussion-alert").length&&(i=$(edx.HtmlUtils.template(s)({}).toString()),this.makeFocusTrap(i.find("button")),n=$("<a href='#discussion-alert' id='discussion-alert-trigger'/>").css("display","none"),n.leanModal({closeButton:"#discussion-alert .dismiss",overlay:1,top:200}),$("body").append(i).append(n)),$("#discussion-alert header h2").text(t),$("#discussion-alert p").text(e),$("#discussion-alert-trigger").click(),$("#discussion-alert button").focus()},t.safeAjax=function(t){var e,i,n,s=this;return e=t.$elem,e&&e.prop("disabled")?(i=$.Deferred(),i.reject(),i.promise()):(t.url=URI(t.url).addSearch({ajax:1}),t.error||(t.error=function(){s.discussionAlert(gettext("Error"),gettext("Your request could not be processed. Refresh the page and try again."))}),e&&e.prop("disabled",!0),t.$loading&&(t.loadingCallback?t.loadingCallback.apply(t.$loading):s.showLoadingIndicator(t.$loading,t.takeFocus)),n=$.ajax(t).always(function(){return e&&e.prop("disabled",!1),t.$loading?t.loadedCallback?t.loadedCallback.apply(t.$loading):s.hideLoadingIndicator():void 0}))},t.updateWithUndo=function(t,e,i,n,s){var o,r=this;return n&&(i.error=function(){return r.discussionAlert(gettext("Error"),n)}),o=_.pick(t.attributes,_.keys(e)),t.set(e),"function"==typeof s&&s(),this.safeAjax(i).fail(function(){return t.set(o)})},t.bindLocalEvents=function(t,e){var i,n,s,o,r,a;a=[];for(n in e)e.hasOwnProperty(n)&&(s=e[n],r=n.split(" "),i=r[0],o=r[1],a.push(t(o).unbind(i)[i](s)));return a},t.formErrorHandler=function(t){return function(e){var i,n,s,o;if(i=function(t,e){return edx.HtmlUtils.joinHtml(edx.HtmlUtils.HTML("<li>"),edx.HtmlUtils.template($("#new-post-alert-template").html())({message:t,alertId:e}),edx.HtmlUtils.HTML("</li>"))},t.empty().show(),400===e.status){if(n=JSON.parse(e.responseText),n.errors)for(s=0;s<n.errors.length;s++)o=i(n.errors[s],s),edx.HtmlUtils.append(t,o)}else o=i("Your request could not be processed. Refresh the page and try again.",0),edx.HtmlUtils.append(t,o);$('div[role="alert"]',t).first().focus()}},t.clearFormErrors=function(t){return t.empty()},t.postMathJaxProcessor=function(t){var e,i;return i=/^\$([^\$]*)\$/g,e=/^\$\$([^\$]*)\$\$/g,this.processEachMathAndCode(t,function(t,n){return"display"===n?t.replace(e,function(t,e){return"\\["+e+"\\]"}):"inline"===n?t.replace(i,function(t,e){return"\\("+e+"\\)"}):t})},t.makeWmdEditor=function(t,e,i){var n,s,o,r,a,u,c;return o=e("."+i),u=o.data("placeholder"),r=o.data("id"),n="-"+i+"-"+r,a=this.urlFor("upload"),c=function(t){return function(e){return t.postMathJaxProcessor(edx.HtmlUtils.HTML(e)).toString()}},s=Markdown.makeWmdEditor(o,n,a,c(this)),this.wmdEditors[""+i+"-"+r]=s,u&&o.find("#wmd-input"+n).attr("placeholder",u),s},t.getWmdEditor=function(t,e,i){var n,s;return n=e("."+i),s=n.attr("data-id"),this.wmdEditors[""+i+"-"+s]},t.getWmdInput=function(t,e,i){var n,s;return n=e("."+i),s=n.attr("data-id"),e("#wmd-input-"+i+"-"+s)},t.getWmdContent=function(t,e,i){return this.getWmdInput(t,e,i).val()},t.setWmdContent=function(t,e,i,n){return this.getWmdInput(t,e,i).val(n),this.getWmdEditor(t,e,i).refreshPreview()};var e=/^([^\$]*?)\$\$([^\$]*?)\$\$(.*)$/m,i=/^([^\$]*?)\$([^\$]+?)\$(.*)$/m,n="@@ESCAPED_D@@",s="@@ESCAPED_B@@";return t.processEachMathAndCode=function(t,o){var r,a,u,c;for(a={},u="",r=edx.HtmlUtils.setHtml($("<div>"),edx.HtmlUtils.ensureHtml(t)),r.find("code").each(function(t,e){return a[t]=$(e).html(),$(e).text(t)}),c=r.html(),c=c.replace(/\\\$/g,n);;)if(i.test(c))c=c.replace(i,function(t,e,i,n){return u+=e+o("$"+i+"$","inline"),n});else{if(!e.test(c)){u+=c;break}c=c.replace(e,function(t,e,i,n){return u+=e+o("$$"+i+"$$","display"),n})}return c=u,c=c.replace(new RegExp(n,"g"),"\\$"),c=c.replace(/\\\\\\\\/g,s),c=c.replace(/\\begin\{([a-z]*\*?)\}([\s\S]*?)\\end\{\1\}/gim,function(t,e,i){return o("\\begin{"+e+"}"+i+("\\end{"+e+"}"))}),c=c.replace(new RegExp(s,"g"),"\\\\\\\\"),r=edx.HtmlUtils.setHtml($("<div>"),edx.HtmlUtils.HTML(c)),r.find("code").each(function(t,e){edx.HtmlUtils.setHtml($(e),edx.HtmlUtils.HTML(o(a[t],"code")))}),edx.HtmlUtils.HTML(r.html())},t.unescapeHighlightTag=function(t){return edx.HtmlUtils.HTML(t.toString().replace(/\&lt\;highlight\&gt\;/g,"<span class='search-highlight'>").replace(/\&lt\;\/highlight\&gt\;/g,"</span>"))},t.stripHighlight=function(t){return t.replace(/\&(amp\;)?lt\;highlight\&(amp\;)?gt\;/g,"").replace(/\&(amp\;)?lt\;\/highlight\&(amp\;)?gt\;/g,"")},t.stripLatexHighlight=function(t){return this.processEachMathAndCode(t,this.stripHighlight)},t.markdownWithHighlight=function(t){var e;t=t.replace(/^\&gt\;/gm,">"),e=Markdown.getMathCompatibleConverter();var i=edx.HtmlUtils.HTML(e.makeHtml(t));return this.unescapeHighlightTag(this.stripLatexHighlight(i))},t.abbreviateString=function(t,e){if(t.length<e)return t;for(;e<t.length&&" "!==t[e];)e++;return t.substr(0,e)+gettext("…")},t.convertMath=function(t){edx.HtmlUtils.setHtml(t,this.postMathJaxProcessor(this.markdownWithHighlight(t.text())))},t.typesetMathJax=function(t){"undefined"!=typeof MathJax&&null!==MathJax&&MathJax.Hub.Queue(["Typeset",MathJax.Hub,t[0]])},t.abbreviateHTML=function(t,e){var i,n,s;s=edx.HtmlUtils.HTML(jQuery.truncate(t.toString(),{length:e,noBreaks:!0,ellipsis:gettext("…")})),i=$(edx.HtmlUtils.joinHtml(edx.HtmlUtils.HTML("<div>"),s,edx.HtmlUtils.HTML("</div>")).toString()),n=i.find("img:not(:first)"),n.length>0&&edx.HtmlUtils.append(i,edx.HtmlUtils.interpolateHtml(edx.HtmlUtils.HTML("<p><em>{text}</em></p>"),{text:gettext("Some images in this post have been omitted")}));var o=edx.HtmlUtils.interpolateHtml(edx.HtmlUtils.HTML("<em>{text}</em>"),{text:gettext("image omitted")});return n.after(edx.HtmlUtils.ensureHtml(o).toString()).remove(),i.html()},t.getPaginationParams=function(t,e,i){var n,s,o,r;return n=2,o=Math.max(t-n,1),s=Math.min(t+n,e),r=function(t){return{number:t,url:i(t)}},{page:t,lowPages:_.range(o,t).map(r),highPages:_.range(t+1,s+1).map(r),previous:t>1?r(t-1):null,next:e>t?r(t+1):null,leftdots:o>2,rightdots:e-1>s,first:o>1?r(1):null,last:e>s?r(e):null}},t.handleKeypressInToolbar=function(t){var e,i,n,s,o,r,a,u,c;e=$(t.target),o=t.which||t.keyCode,n=e.parent(),s=n.children(".wmd-button"),u=o===this.leftKey||o===this.rightKey,c=s.length>0,u&&c&&(a=s.index(e),r=o===this.leftKey?a-1:a+1,r=Math.max(Math.min(r,s.length-1),0),i=$(s[r]),this.moveSelectionToNextItem(e,i))},t.moveSelectionToNextItem=function(t,e){t.attr("aria-selected","false"),t.attr("tabindex","-1"),e.attr("aria-selected","true"),e.attr("tabindex","0"),e.focus()},t}.call(this)}.call(window),RequireJS.define("common/js/discussion/utils",function(){}),function(){"use strict";var t={}.hasOwnProperty,e=function(e,i){function n(){this.constructor=e}for(var s in i)t.call(i,s)&&(e[s]=i[s]);return n.prototype=i.prototype,e.prototype=new n,e.__super__=i.prototype,e};"undefined"!=typeof Backbone&&null!==Backbone&&(this.DiscussionUser=function(t){function i(){return i.__super__.constructor.apply(this,arguments)}return e(i,t),i.prototype.following=function(t){return _.include(this.get("subscribed_thread_ids"),t.id)},i.prototype.voted=function(t){return _.include(this.get("upvoted_ids"),t.id)},i.prototype.vote=function(t){return this.get("upvoted_ids").push(t.id),t.vote()},i.prototype.unvote=function(t){return this.set("upvoted_ids",_.without(this.get("upvoted_ids"),t.id)),t.unvote()},i}(Backbone.Model))}.call(this),RequireJS.define("common/js/discussion/models/discussion_user",function(){}),function(){"use strict";var t={}.hasOwnProperty,e=function(e,i){function n(){this.constructor=e}for(var s in i)t.call(i,s)&&(e[s]=i[s]);return n.prototype=i.prototype,e.prototype=new n,e.__super__=i.prototype,e};"undefined"!=typeof Backbone&&null!==Backbone&&(this.DiscussionCourseSettings=function(t){function i(){return i.__super__.constructor.apply(this,arguments)}return e(i,t),i}(Backbone.Model))}.call(this),RequireJS.define("common/js/discussion/models/discussion_course_settings",function(){}),RequireJS.define("text",{load:function(t){throw new Error("Dynamic load not allowed: "+t)}}),RequireJS.define("text!common/templates/components/system-feedback.underscore",[],function(){return'<div class="wrapper wrapper-<%= type %> wrapper-<%= type %>-<%= intent %>\n            <% if(obj.shown) { %>is-shown<% } else { %>is-hiding<% } %>\n            <% if(_.contains([\'help\', \'mini\'], intent)) { %>wrapper-<%= type %>-status<% } %>"\n     id="<%= type %>-<%= intent %>"\n     aria-hidden="<% if(obj.shown) { %>false<% } else { %>true<% } %>"\n     aria-labelledby="<%= type %>-<%= intent %>-title"\n     tabindex="-1"\n     <% if (obj.message) { %>aria-describedby="<%= type %>-<%= intent %>-description" <% } %>\n     <% if (obj.actions) { %>role="dialog"<% } %>\n  >\n  <div class="<%= type %> <%= intent %> <% if(obj.actions) { %>has-actions<% } %>">\n    <% if(obj.icon) { %>\n      <% var iconClass = {"warning": "warning", "confirmation": "check", "error": "warning", "announcement": "bullhorn", "step-required": "exclamation-circle", "help": "question", "mini": "cog"} %>\n      <span class="feedback-symbol fa fa-<%= iconClass[intent] %>" aria-hidden="true"></span>\n    <% } %>\n\n    <div class="copy">\n      <h2 class="title title-3" id="<%= type %>-<%= intent %>-title"><%- title %></h2>\n      <% if(obj.message) { %><p class="message" id="<%= type %>-<%= intent %>-description"><%- message %></p><% } %>\n    </div>\n\n    <% if(obj.actions) { %>\n    <nav class="nav-actions">\n      <ul>\n        <% if(actions.primary) { %>\n        <li class="nav-item">\n          <button class="action-primary <%= actions.primary.class %>"><%- actions.primary.text %></button>\n        </li>\n        <% } %>\n        <% if(actions.secondary) {\n             _.each(actions.secondary, function(secondary) { %>\n        <li class="nav-item">\n          <button class="action-secondary <%= secondary.class %>"><%- secondary.text %></button>\n        </li>\n        <%   });\n           } %>\n      </ul>\n    </nav>\n    <% } %>\n\n    <% if(obj.closeIcon) { %>\n    <a href="#" rel="view" class="action action-close action-<%= type %>-close">\n      <span class="icon fa fa-times-circle" aria-hidden="true"></span>\n      <span class="label">close <%= type %></span>\n    </a>\n    <% } %>\n  </div>\n</div>\n'}),function(t){"use strict";RequireJS.define("common/js/components/views/feedback",["jquery","underscore","underscore.string","backbone","edx-ui-toolkit/js/utils/html-utils","text!../../../../common/templates/components/system-feedback.underscore"],function(t,e,i,n,s,o){var r=["a[href]:not([tabindex='-1'])","area[href]:not([tabindex='-1'])","input:not([disabled]):not([tabindex='-1'])","select:not([disabled]):not([tabindex='-1'])","textarea:not([disabled]):not([tabindex='-1'])","button:not([disabled]):not([tabindex='-1'])","iframe:not([tabindex='-1'])","[tabindex]:not([tabindex='-1'])","[contentEditable=true]:not([tabindex='-1'])"],a=n.View.extend({options:{title:"",message:"",intent:null,type:null,shown:!0,icon:!0,closeIcon:!0,minShown:0,maxShown:1/0,outFocusElement:null},initialize:function(i){if(this.options=e.extend({},this.options,i),!this.options.type)throw"SystemFeedback: type required (given "+JSON.stringify(this.options)+")";if(!this.options.intent)throw"SystemFeedback: intent required (given "+JSON.stringify(this.options)+")";return this.setElement(t("#page-"+this.options.type)),this.options.actions&&this.options.actions.secondary&&!e.isArray(this.options.actions.secondary)&&(this.options.actions.secondary=[this.options.actions.secondary]),this},inFocus:function(t){var e,i=t||".wrapper";return this.options.outFocusElement=this.options.outFocusElement||document.activeElement,this.$(i).first().focus(),e=this.$(r.join()),e.on("keydown",function(t){9===t.which&&t.shiftKey&&t.target===e.first()[0]?(t.preventDefault(),e.last().focus()):9!==t.which||t.shiftKey||t.target!==e.last()[0]||(t.preventDefault(),e.first().focus())}),this},outFocus:function(){return this.$(r.join()).off("keydown"),this.options.outFocusElement&&this.options.outFocusElement.focus(),this},show:function(){return clearTimeout(this.hideTimeout),this.options.shown=!0,this.shownAt=new Date,this.render(),t.isNumeric(this.options.maxShown)&&(this.hideTimeout=setTimeout(e.bind(this.hide,this),this.options.maxShown)),this},hide:function(){return this.shownAt&&t.isNumeric(this.options.minShown)&&this.options.minShown>new Date-this.shownAt?(clearTimeout(this.hideTimeout),this.hideTimeout=setTimeout(e.bind(this.hide,this),this.options.minShown-(new Date-this.shownAt))):(this.options.shown=!1,delete this.shownAt,this.render()),this},events:{"click .action-close":"hide","click .action-primary":"primaryClick","click .action-secondary":"secondaryClick"},render:function(){var t=a["active_"+this.options.type];return t&&t!==this&&(t.stopListening(),t.undelegateEvents()),s.setHtml(this.$el,s.template(o)(this.options)),a["active_"+this.options.type]=this,this},primaryClick:function(t){var e,i;e=this.options.actions,e&&(i=e.primary,i&&(i.preventDefault!==!1&&t.preventDefault(),i.click&&i.click.call(t.target,this,t)))},secondaryClick:function(t){var i,n,s,o;i=this.options.actions,i&&(n=i.secondary,n&&(o=0,t&&t.target&&(o=e.indexOf(this.$(".action-secondary"),t.target)),s=n[o],s.preventDefault!==!1&&t.preventDefault(),s.click&&s.click.call(t.target,this,t)))}});return a})}.call(this,define||RequireJS.define),function(t){"use strict";RequireJS.define("common/js/components/views/feedback_notification",["jquery","underscore","underscore.string","./feedback"],function(t,e,i,n){var s,o,r,a=n.extend({options:t.extend({},n.prototype.options,{type:"notification",closeIcon:!1})});return s=e.compose(i.capitalize,i.camelize),o=["warning","error","confirmation","announcement","step-required","help","mini"],e.each(o,function(e){var i;i=a.extend({options:t.extend({},a.prototype.options,{intent:e})}),a[s(e)]=i}),r=a.Mini.prototype.options,r.minShown=1250,r.closeIcon=!1,a})}.call(this,define||RequireJS.define),function(t){"use strict";RequireJS.define("common/js/components/views/feedback_prompt",["jquery","underscore","underscore.string","common/js/components/views/feedback"],function(t,e,i,n){var s,o,r=n.extend({options:t.extend({},n.prototype.options,{type:"prompt",closeIcon:!1,icon:!1}),render:function(){return window.$body||(window.$body=t(document.body)),this.options.shown?$body.addClass("prompt-is-shown"):$body.removeClass("prompt-is-shown"),n.prototype.render.apply(this,arguments)},show:function(){return n.prototype.show.apply(this,arguments),this.inFocus()},hide:function(){return n.prototype.hide.apply(this,arguments),this.outFocus()}});return s=e.compose(i.capitalize,i.camelize),o=["warning","error","confirmation","announcement","step-required","help","mini"],e.each(o,function(e){var i;i=r.extend({options:t.extend({},r.prototype.options,{intent:e})}),r[s(e)]=i}),r})}.call(this,define||RequireJS.define),function(t,e){"use strict";RequireJS.define("common/js/components/utils/view_utils",["jquery","underscore","gettext","common/js/components/views/feedback_notification","common/js/components/views/feedback_prompt"],function(t,i,n,s,o){var r,a,u,c,d,l,h,p,m,f,g,v,_,y,w,b,$,x,T,U=65;return r=function(t,e){var i=e||"collapsed";t.closest(".expand-collapse").toggleClass("expand collapse"),t.closest(".is-collapsible, .window").toggleClass(i),t.closest(".is-collapsible").children("article").slideToggle()},a=function(){t(".ui-loading").show()},u=function(){t(".ui-loading").hide()},c=function(t,e,i,s,r){return new o.Warning({title:t,message:e,actions:{primary:{text:i,click:function(t){t.hide(),s()}},secondary:{text:n("Cancel"),click:function(t){return r&&r(),t.hide()}}}}).show()},d=function(t,e){var i;return i=new s.Mini({title:n(t)}),i.show(),e().done(function(){i.hide()})},l=function(e){return function(i){var n=this;h(t(i.currentTarget),function(){return n[e].apply(n,[i])})}},h=function(t,e){return t.addClass("is-disabled").attr("aria-disabled",!0),e().always(function(){t.removeClass("is-disabled").attr("aria-disabled",!1)})},y=function(e){return function(i){i.preventDefault(),t.ajax({url:t(this).data("dismiss-link"),type:"DELETE",
success:e})}},f=function(e){t("html, body").animate({scrollTop:e},500)},p=function(e){var i=e.offset().top;return i-t(window).scrollTop()},m=function(t,e){var i=t.offset().top,n=i-e;f(n)},g=function(t){window.location=t},v=function(){window.location.reload()},_=function(t,e){var n,s=t.changedAttributes();if(!s)return!1;for(n=0;n<e.length;n++)if(i.has(s,e[n]))return!0;return!1},w=function(t){return 0===t.length?n("Required field."):""},b=function(t,e){var i=w(t);if(i)return i;if(e){if(/\s/g.test(t))return n("Please do not use any spaces in this field.")}else if(t!==encodeURIComponent(t)||t.match(/[!'()*]/))return n("Please do not use any spaces or special characters in this field.");return""},$=function(e){var n=i.reduce(e,function(e,i){return e+t(i).val().length},0);return U>=n},x=function(e,n,s,o){$(s)?t(e.errorWrapper).removeClass(n.shown).addClass(n.hiding):(t(e.errorWrapper).addClass(n.shown).removeClass(n.hiding),t(e.errorMessage).html("<p>"+i.template(o)({limit:U})+"</p>"),t(e.save).addClass(n.disabled))},T=function(i){var n=t.Deferred();return e([i],function(){n.resolve()},function(){n.reject()}),n.promise()},{toggleExpandCollapse:r,showLoadingIndicator:a,hideLoadingIndicator:u,confirmThenRunOperation:c,runOperationShowingMessage:d,withDisabledElement:l,disableElementWhileRunning:h,deleteNotificationHandler:y,setScrollTop:f,getScrollOffset:p,setScrollOffset:m,redirect:g,reload:v,hasChangedAttributes:_,validateRequiredField:w,validateURLItemEncoding:b,validateTotalKeyLength:$,checkTotalKeyLengthViolations:x,loadJavaScript:T}})}.call(this,define||RequireJS.define,require||RequireJS.require),function(){"use strict";var t={}.hasOwnProperty,e=function(e,i){function n(){this.constructor=e}for(var s in i)t.call(i,s)&&(e[s]=i[s]);return n.prototype=i.prototype,e.prototype=new n,e.__super__=i.prototype,e};"undefined"!=typeof Backbone&&null!==Backbone&&(this.DiscussionThreadProfileView=function(t){function i(){return i.__super__.constructor.apply(this,arguments)}return e(i,t),i.prototype.render=function(){var t;return this.convertMath(),this.abbreviateBody(),t=$.extend(this.model.toJSON(),{permalink:this.model.urlFor("retrieve")}),this.model.get("anonymous")||(t=$.extend(t,{user:{username:this.model.username,user_url:this.model.user_url}})),edx.HtmlUtils.setHtml(this.$el,edx.HtmlUtils.template($("#profile-thread-template").html())(t)),this.$("span.timeago").timeago(),DiscussionUtil.typesetMathJax(this.$(".post-body")),this},i.prototype.convertMath=function(){var t=DiscussionUtil.markdownWithHighlight(this.model.get("body"));this.model.set("markdownBody",t)},i.prototype.abbreviateBody=function(){var t;t=DiscussionUtil.abbreviateHTML(this.model.get("markdownBody"),140),this.model.set("abbreviatedBody",t)},i}(Backbone.View))}.call(window),RequireJS.define("common/js/discussion/views/discussion_thread_profile_view",function(){}),RequireJS.define("text!discussion/templates/user-profile.underscore",[],function(){return'<div class="inline-threads"></div>\n<div class="inline-thread is-hidden">\n    <div class="forum-nav-bar">\n        <button class="btn-link all-posts-btn">\n            <span class="icon fa fa-chevron-prev" aria-hidden="true"></span>\n            <span><%- gettext("All Posts") %></span>\n        </button>\n    </div>\n    <div class="forum-content">\n    </div>\n</div>\n'}),function(){"use strict";var t={}.hasOwnProperty,e=function(e,i){function n(){this.constructor=e}for(var s in i)t.call(i,s)&&(e[s]=i[s]);return n.prototype=i.prototype,e.prototype=new n,e.__super__=i.prototype,e};"undefined"!=typeof Backbone&&null!==Backbone&&(this.DiscussionThreadListView=function(t){function i(){var t=this;return this.updateEmailNotifications=function(){return i.prototype.updateEmailNotifications.apply(t,arguments)},this.retrieveFollowed=function(){return i.prototype.retrieveFollowed.apply(t,arguments)},this.chooseGroup=function(){return i.prototype.chooseGroup.apply(t,arguments)},this.chooseFilter=function(){return i.prototype.chooseFilter.apply(t,arguments)},this.threadRemoved=function(){return i.prototype.threadRemoved.apply(t,arguments)},this.threadSelected=function(){return i.prototype.threadSelected.apply(t,arguments)},this.renderThread=function(){return i.prototype.renderThread.apply(t,arguments)},this.loadMorePages=function(){return i.prototype.loadMorePages.apply(t,arguments)},this.showMetadataAccordingToSort=function(){return i.prototype.showMetadataAccordingToSort.apply(t,arguments)},this.renderThreads=function(){return i.prototype.renderThreads.apply(t,arguments)},this.addAndSelectThread=function(){return i.prototype.addAndSelectThread.apply(t,arguments)},this.reloadDisplayedCollection=function(){return i.prototype.reloadDisplayedCollection.apply(t,arguments)},this.clearSearchAlerts=function(){return i.prototype.clearSearchAlerts.apply(t,arguments)},this.removeSearchAlert=function(){return i.prototype.removeSearchAlert.apply(t,arguments)},this.addSearchAlert=function(){return i.prototype.addSearchAlert.apply(t,arguments)},this.performSearch=function(){return i.prototype.performSearch.apply(t,arguments)},i.__super__.constructor.apply(this,arguments)}return e(i,t),i.prototype.events={"keypress .forum-nav-browse-filter-input":function(t){return DiscussionUtil.ignoreEnterKey(t)},"change .forum-nav-sort-control":"sortThreads","click .forum-nav-thread-link":"threadSelected","click .forum-nav-load-more-link":"loadMorePages","change .forum-nav-filter-main-control":"chooseFilter","change .forum-nav-filter-cohort-control":"chooseGroup"},i.prototype.initialize=function(t){var e=this;this.courseSettings=t.courseSettings,this.supportsActiveThread=t.supportsActiveThread,this.hideReadState=t.hideReadState||!1,this.displayedCollection=new Discussion(this.collection.models,{pages:this.collection.pages}),this.collection.on("change",this.reloadDisplayedCollection),this.discussionIds=this.$el.data("discussion-id")||"",this.collection.on("reset",function(t){return e.displayedCollection.current_page=t.current_page,e.displayedCollection.pages=t.pages,e.displayedCollection.reset(t.models)}),this.collection.on("add",this.addAndSelectThread),this.collection.on("thread:remove",this.threadRemoved),this.sidebar_padding=10,this.boardName=null,this.current_search="",this.mode=t.mode||"commentables",this.showThreadPreview=!0,this.searchAlertCollection=new Backbone.Collection([],{model:Backbone.Model}),this.searchAlertCollection.on("add",function(t){var i;return i=edx.HtmlUtils.template($("#search-alert-template").html())({messageHtml:t.attributes.message,cid:t.cid,css_class:t.attributes.css_class}),edx.HtmlUtils.append(e.$(".search-alerts"),i),e.$("#search-alert-"+t.cid+" .dismiss").bind("click",t,function(t){return e.removeSearchAlert(t.data.cid)})}),this.searchAlertCollection.on("remove",function(t){return e.$("#search-alert-"+t.cid).remove()}),this.searchAlertCollection.on("reset",function(){return e.$(".search-alerts").empty()}),this.template=edx.HtmlUtils.template($("#thread-list-template").html()),this.threadListItemTemplate=edx.HtmlUtils.template($("#thread-list-item-template").html())},i.prototype.addSearchAlert=function(t,e){var i=new Backbone.Model({message:t,css_class:e||""});return this.searchAlertCollection.add(i),i},i.prototype.removeSearchAlert=function(t){return this.searchAlertCollection.remove(t)},i.prototype.clearSearchAlerts=function(){return this.searchAlertCollection.reset()},i.prototype.reloadDisplayedCollection=function(t){var e,i,n,s;this.clearSearchAlerts(),s=t.get("id"),i=this.renderThread(t),n=this.$(".forum-nav-thread[data-id="+s+"]"),e=0!==n.has(".forum-nav-thread-link.is-active").length,n.replaceWith(i),this.showMetadataAccordingToSort(),this.supportsActiveThread&&e&&this.setActiveThread(s)},i.prototype.addAndSelectThread=function(t){var e=t.get("commentable_id"),i=this;return this.retrieveDiscussion(e,function(){return i.trigger("thread:created",t.get("id"))})},i.prototype.ignoreClick=function(t){return t.stopPropagation()},i.prototype.render=function(){var t=this;return this.timer=0,this.$el.empty(),edx.HtmlUtils.append(this.$el,this.template({isDiscussionDivisionEnabled:this.courseSettings.get("is_discussion_division_enabled"),isPrivilegedUser:DiscussionUtil.isPrivilegedUser()})),this.hideReadState&&this.$(".forum-nav-filter-main").addClass("is-hidden"),this.$(".forum-nav-sort-control option").removeProp("selected"),this.$(".forum-nav-sort-control option[value="+this.collection.sort_preference+"]").prop("selected",!0),this.displayedCollection.on("reset",this.renderThreads),this.displayedCollection.on("thread:remove",this.renderThreads),this.displayedCollection.on("change:commentable_id",function(){"commentables"===t.mode&&t.retrieveDiscussions(t.discussionIds.split(","))}),this.renderThreads(),this},i.prototype.renderThreads=function(){var t,e,i,n;for(this.$(".forum-nav-thread-list").empty(),i=0,n=this.displayedCollection.models.length;n>i;i++)e=this.displayedCollection.models[i],t=this.renderThread(e),this.$(".forum-nav-thread-list").append(t);0===this.$(".forum-nav-thread-list li").length&&(this.clearSearchAlerts(),this.addSearchAlert(gettext("There are no posts in this topic yet."))),this.showMetadataAccordingToSort(),this.renderMorePages(),this.trigger("threads:rendered")},i.prototype.showMetadataAccordingToSort=function(){var t=this.$(".forum-nav-thread-votes-count"),e=this.$(".forum-nav-thread-unread-comments-count"),i=this.$(".forum-nav-thread-comments-count");switch(t.hide(),i.hide(),e.hide(),this.$(".forum-nav-sort-control").val()){case"votes":t.show();break;default:e.show(),i.show()}},i.prototype.renderMorePages=function(){this.displayedCollection.hasMorePages()&&edx.HtmlUtils.append(this.$(".forum-nav-thread-list"),edx.HtmlUtils.template($("#nav-load-more-link").html())({}))},i.prototype.getLoadingContent=function(t){return edx.HtmlUtils.template($("#nav-loading-template").html())({srText:t})},i.prototype.loadMorePages=function(t){var e,i,n,s,o,r,a=this;switch(t&&t.preventDefault(),n=this.$(".forum-nav-load-more"),n.empty(),edx.HtmlUtils.append(n,this.getLoadingContent(gettext("Loading more threads"))),s=n.find(".forum-nav-loading"),DiscussionUtil.makeFocusTrap(s),s.focus(),o={filter:this.filter},this.mode){case"search":o.search_text=this.current_search,this.group_id&&(o.group_id=this.group_id);break;case"followed":o.user_id=window.user.id;break;case"user":o.user_id=this.$el.parent().data("user-id");break;case"commentables":o.commentable_ids=this.discussionIds,this.group_id&&(o.group_id=this.group_id);break;case"all":this.group_id&&(o.group_id=this.group_id)}return r=this.collection.last(),i=r?r.get("id"):void 0,i?this.once("threads:rendered",function(){var t=".forum-nav-thread[data-id='"+i+"'] + .forum-nav-thread .forum-nav-thread-link";return $(t).focus()}):this.once("threads:rendered",function(){var t=$(".forum-nav-thread-link").first();return t?t.focus():void 0}),e=function(){a.renderThreads(),DiscussionUtil.discussionAlert(gettext("Error"),gettext("Additional posts could not be loaded. Refresh the page and try again."))},this.collection.retrieveAnotherPage(this.mode,o,{sort_key:this.$(".forum-nav-sort-control").val()},e)},i.prototype.containsMarkup=function(t){var e="![",i=/\$/g,n=-1!==t.indexOf(e),s=(t.match(i)||[]).length>1;return n||s},i.prototype.renderThread=function(t){var e=t.get("comments_count"),i=t.get("unread_comments_count"),n=!t.get("read")&&i===e,s=this.containsMarkup(t.get("body"))?"":t.get("body"),o=_.extend({neverRead:n,threadUrl:t.urlFor("retrieve"),threadPreview:s,showThreadPreview:this.showThreadPreview,hideReadState:this.hideReadState},t.toJSON());return $(this.threadListItemTemplate(o).toString())},i.prototype.threadSelected=function(t){var e;return e=$(t.target).closest(".forum-nav-thread").attr("data-id"),this.supportsActiveThread&&this.setActiveThread(e),this.trigger("thread:selected",e),!1},i.prototype.threadRemoved=function(t){this.trigger("thread:removed",t)},i.prototype.setActiveThread=function(t){var e;this.$(".forum-nav-thread-link").find(".sr").remove(),this.$(".forum-nav-thread[data-id!='"+t+"'] .forum-nav-thread-link").removeClass("is-active"),e=edx.HtmlUtils.joinHtml(edx.HtmlUtils.HTML('<span class="sr">'),edx.HtmlUtils.ensureHtml(gettext("Current conversation")),edx.HtmlUtils.HTML("</span>")).toString(),this.$(".forum-nav-thread[data-id='"+t+"'] .forum-nav-thread-link").addClass("is-active").find(".forum-nav-thread-wrapper-1").prepend(e)},i.prototype.selectTopic=function(t){var e,i,n;return n=t.closest(".forum-nav-browse-menu-item"),n.hasClass("forum-nav-browse-menu-all")?(this.discussionIds="",this.$(".forum-nav-filter-cohort").show(),this.retrieveAllThreads()):n.hasClass("forum-nav-browse-menu-following")?(this.retrieveFollowed(),this.$(".forum-nav-filter-cohort").hide()):(e=n.find(".forum-nav-browse-menu-item").andSelf(),i=e.filter("[data-discussion-id]").map(function(t,e){return $(e).data("discussion-id")}).get(),this.retrieveDiscussions(i),this.$(".forum-nav-filter-cohort").toggle(n.data("divided")===!0))},i.prototype.chooseFilter=function(){return this.filter=$(".forum-nav-filter-main-control :selected").val(),this.clearSearchAlerts(),this.retrieveFirstPage()},i.prototype.chooseGroup=function(){return this.group_id=this.$(".forum-nav-filter-cohort-control :selected").val(),this.retrieveFirstPage()},i.prototype.retrieveDiscussion=function(t,e){var i=DiscussionUtil.urlFor("retrieve_discussion",t),n=this;return DiscussionUtil.safeAjax({url:i,type:"GET",success:function(t){n.collection.current_page=t.page,n.collection.pages=t.num_pages,n.collection.reset(t.discussion_data),Content.loadContentInfos(t.annotated_content_info),n.displayedCollection.reset(n.collection.models),e&&e()}})},i.prototype.retrieveDiscussions=function(t){return this.discussionIds=t.join(","),this.mode="commentables",this.retrieveFirstPage()},i.prototype.retrieveAllThreads=function(){return this.mode="all",this.retrieveFirstPage()},i.prototype.retrieveFirstPage=function(t){return this.collection.current_page=0,this.$(".forum-nav-thread-list").empty(),this.collection.models=[],this.loadMorePages(t)},i.prototype.sortThreads=function(t){return this.displayedCollection.setSortComparator(this.$(".forum-nav-sort-control").val()),this.retrieveFirstPage(t)},i.prototype.performSearch=function(t){this.trigger("search:initiated"),this.searchFor(t.val(),t)},i.prototype.searchFor=function(t,e){var i=DiscussionUtil.urlFor("search"),n=this;return this.clearSearchAlerts(),this.clearFilters(),this.mode="search",this.current_search=t,DiscussionUtil.safeAjax({$elem:e,data:{text:t},url:i,type:"GET",dataType:"json",$loading:$,loadingCallback:function(){var t=n.$(".forum-nav-thread-list");t.empty(),edx.HtmlUtils.append(t,edx.HtmlUtils.joinHtml(edx.HtmlUtils.HTML("<li class='forum-nav-load-more'>"),n.getLoadingContent(gettext("Loading posts list")),edx.HtmlUtils.HTML("</li>")))},loadedCallback:function(){return n.$(".forum-nav-thread-list .forum-nav-load-more").remove()},success:function(e,i){var s,o;return"success"===i&&(n.collection.reset(e.discussion_data),n.clearSearchAlerts(),Content.loadContentInfos(e.annotated_content_info),n.collection.current_page=e.page,n.collection.pages=e.num_pages,_.isNull(e.corrected_text)?0===e.discussion_data.length&&(n.addSearchAlert(gettext("No posts matched your query.")),n.displayedCollection.models=[]):(o=_.escape(gettext("No results found for {original_query}. Showing results for {suggested_query}.")),s=edx.HtmlUtils.interpolateHtml(o,{original_query:edx.HtmlUtils.joinHtml(edx.HtmlUtils.HTML("<em>"),t,edx.HtmlUtils.HTML("</em>")),suggested_query:edx.HtmlUtils.joinHtml(edx.HtmlUtils.HTML("<em>"),e.corrected_text,edx.HtmlUtils.HTML("</em>"))}),n.addSearchAlert(s)),0!==n.collection.models.length&&n.displayedCollection.reset(n.collection.models),t)?n.searchForUser(t):e}})},i.prototype.searchForUser=function(t){var e=this;return DiscussionUtil.safeAjax({data:{username:t},url:DiscussionUtil.urlFor("users"),type:"GET",dataType:"json",error:function(){},success:function(t){var i,n;t.users.length>0&&(n=edx.HtmlUtils.joinHtml(edx.HtmlUtils.interpolateHtml(edx.HtmlUtils.HTML('<a class="link-jump" href="{url}">'),{url:DiscussionUtil.urlFor("user_profile",t.users[0].id)}),t.users[0].username,edx.HtmlUtils.HTML("</a>")),i=edx.HtmlUtils.interpolateHtml(gettext("Show posts by {username}."),{username:n}),e.addSearchAlert(i,"search-by-user"))}})},i.prototype.clearFilters=function(){return this.$(".forum-nav-filter-main-control").val("all"),this.$(".forum-nav-filter-cohort-control").val("all")},i.prototype.retrieveFollowed=function(){return this.mode="followed",this.retrieveFirstPage()},i.prototype.updateEmailNotifications=function(){var t,e,i;t=$("input.email-setting"),e=t.prop("checked"),i=e?"enable_notifications":"disable_notifications",DiscussionUtil.safeAjax({url:DiscussionUtil.urlFor(i),type:"POST",error:function(){t.prop("checked",!e)}})},i}.call(this,Backbone.View))}.call(window),RequireJS.define("common/js/discussion/views/discussion_thread_list_view",function(){}),function(t){"use strict";RequireJS.define("discussion/js/views/discussion_user_profile_view",["underscore","jquery","backbone","gettext","URI","edx-ui-toolkit/js/utils/html-utils","common/js/components/utils/view_utils","common/js/discussion/discussion","common/js/discussion/utils","common/js/discussion/views/discussion_thread_profile_view","text!discussion/templates/user-profile.underscore","common/js/discussion/views/discussion_thread_list_view"],function(t,e,i,n,s,o,r,a,u,c,d,l){var h=i.View.extend({events:{"click .all-posts-btn":"navigateToAllThreads"},initialize:function(t){this.courseSettings=t.courseSettings,this.discussion=t.discussion,this.mode="user",this.listenTo(this.model,"change",this.render)},render:function(){return o.setHtml(this.$el,o.template(d)({})),this.discussionThreadListView=new l({collection:this.discussion,el:this.$(".inline-threads"),courseSettings:this.courseSettings,mode:this.mode,hideReadState:!0}).render(),this.discussionThreadListView.on("thread:selected",t.bind(this.navigateToThread,this)),this},navigateToThread:function(t){var e=this.discussion.get(t);this.threadView=new DiscussionThreadView({el:this.$(".forum-content"),model:e,mode:"inline",courseSettings:this.courseSettings}),this.threadView.render(),this.listenTo(this.threadView.showView,"thread:_delete",this.navigateToAllThreads),this.discussionThreadListView.$el.addClass("is-hidden"),this.$(".inline-thread").removeClass("is-hidden")},navigateToAllThreads:function(){this.$(".inline-thread").addClass("is-hidden"),this.threadView.$el.empty().off(),this.threadView.stopListening(),this.threadView=null,this.discussionThreadListView.$el.removeClass("is-hidden"),this.discussionThreadListView.$(".is-active").focus()}});return h})}.call(this,define||RequireJS.define),function(t){"use strict";RequireJS.define("discussion/js/discussion_profile_page_factory",["jquery","backbone","common/js/discussion/content","common/js/discussion/discussion","common/js/discussion/utils","common/js/discussion/models/discussion_user","common/js/discussion/models/discussion_course_settings","discussion/js/views/discussion_user_profile_view"],function(t,e,i,n,s,o,r,a){return function(e){var u,c,d,l=e.threads,h=e.contentInfo,p=e.userInfo,m=new o(p),f=e.page,g=e.numPages,v=e.sortPreference;s.loadRoles({Moderator:[],Administrator:[],"Community TA":[]}),void 0===e.roles&&(e.roles={}),s.loadRoles(e.roles),window.$$course_id=e.courseId,window.courseName=e.courseName,s.setUser(m),window.user=m,i.loadContentInfos(h),c=new n(l,{pages:g,sort:v}),d=new r(e.courseSettings),u=new a({el:t(".discussion-user-threads"),discussion:c,page:f,numPages:g,courseSettings:d}),u.render()}})}.call(this,define||RequireJS.define);