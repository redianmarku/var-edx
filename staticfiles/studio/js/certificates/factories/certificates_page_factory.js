/**
 * @license RequireJS domReady 2.0.1 Copyright (c) 2010-2012, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/requirejs/domReady for details
 */

/*!
 * jQuery Form Plugin
 * version: 3.18 (28-SEP-2012)
 * @requires jQuery v1.5 or later
 *
 * Examples and documentation at: http://malsup.com/jquery/form/
 * Project repository: https://github.com/malsup/form
 * Dual licensed under the MIT and GPL licenses:
 *    http://malsup.github.com/mit-license.txt
 *    http://malsup.github.com/gpl-license-v2.txt
 */

/*!
 * Smooth Scroll - v1.4.10 - 2013-03-02
 * https://github.com/kswedberg/jquery-smooth-scroll
 * Copyright (c) 2013 Karl Swedberg
 * Licensed MIT (https://github.com/kswedberg/jquery-smooth-scroll/blob/master/LICENSE-MIT)
 */

!function(e,t){"function"==typeof define&&define.amd?define("backbone-relational",["exports","backbone","underscore"],t):"undefined"!=typeof exports?t(exports,require("backbone"),require("underscore")):t(e,e.Backbone,e._)}(this,function(e,t,i){"use strict";t.Relational={showWarnings:!0},t.Semaphore={_permitsAvailable:null,_permitsUsed:0,acquire:function(){if(this._permitsAvailable&&this._permitsUsed>=this._permitsAvailable)throw new Error("Max permits acquired");this._permitsUsed++},release:function(){if(0===this._permitsUsed)throw new Error("All permits released");this._permitsUsed--},isLocked:function(){return this._permitsUsed>0},setAvailablePermits:function(e){if(this._permitsUsed>e)throw new Error("Available permits cannot be less than used permits");this._permitsAvailable=e}},t.BlockingQueue=function(){this._queue=[]},i.extend(t.BlockingQueue.prototype,t.Semaphore,{_queue:null,add:function(e){this.isBlocked()?this._queue.push(e):e()},process:function(){var e=this._queue;for(this._queue=[];e&&e.length;)e.shift()()},block:function(){this.acquire()},unblock:function(){this.release(),this.isBlocked()||this.process()},isBlocked:function(){return this.isLocked()}}),t.Relational.eventQueue=new t.BlockingQueue,t.Store=function(){this._collections=[],this._reverseRelations=[],this._orphanRelations=[],this._subModels=[],this._modelScopes=[e]},i.extend(t.Store.prototype,t.Events,{initializeRelation:function(e,n,s){var o=i.isString(n.type)?t[n.type]||this.getObjectByName(n.type):n.type;o&&o.prototype instanceof t.Relation?new o(e,n,s):t.Relational.showWarnings&&"undefined"!=typeof console&&console.warn("Relation=%o; missing or invalid relation type!",n)},addModelScope:function(e){this._modelScopes.push(e)},removeModelScope:function(e){this._modelScopes=i.without(this._modelScopes,e)},addSubModels:function(e,t){this._subModels.push({superModelType:t,subModels:e})},setupSuperModel:function(e){i.find(this._subModels,function(t){return i.filter(t.subModels||[],function(i,n){var s=this.getObjectByName(i);return e===s?(t.superModelType._subModels[n]=e,e._superModel=t.superModelType,e._subModelTypeValue=n,e._subModelTypeAttribute=t.superModelType.prototype.subModelTypeAttribute,!0):void 0},this).length},this)},addReverseRelation:function(e){var t=i.any(this._reverseRelations,function(t){return i.all(e||[],function(e,i){return e===t[i]})});!t&&e.model&&e.type&&(this._reverseRelations.push(e),this._addRelation(e.model,e),this.retroFitRelation(e))},addOrphanRelation:function(e){var t=i.any(this._orphanRelations,function(t){return i.all(e||[],function(e,i){return e===t[i]})});!t&&e.model&&e.type&&this._orphanRelations.push(e)},processOrphanRelations:function(){i.each(this._orphanRelations.slice(0),function(e){var n=t.Relational.store.getObjectByName(e.relatedModel);n&&(this.initializeRelation(null,e),this._orphanRelations=i.without(this._orphanRelations,e))},this)},_addRelation:function(e,t){e.prototype.relations||(e.prototype.relations=[]),e.prototype.relations.push(t),i.each(e._subModels||[],function(e){this._addRelation(e,t)},this)},retroFitRelation:function(e){var t=this.getCollection(e.model,!1);t&&t.each(function(t){t instanceof e.model&&new e.type(t,e)},this)},getCollection:function(e,n){e instanceof t.RelationalModel&&(e=e.constructor);for(var s=e;s._superModel;)s=s._superModel;var o=i.find(this._collections,function(e){return e.model===s});return o||n===!1||(o=this._createCollection(s)),o},getObjectByName:function(e){var t=e.split("."),n=null;return i.find(this._modelScopes,function(e){return n=i.reduce(t||[],function(e,t){return e?e[t]:void 0},e),n&&n!==e?!0:void 0},this),n},_createCollection:function(e){var i;return e instanceof t.RelationalModel&&(e=e.constructor),e.prototype instanceof t.RelationalModel&&(i=new t.Collection,i.model=e,this._collections.push(i)),i},resolveIdForItem:function(e,n){var s=i.isString(n)||i.isNumber(n)?n:null;return null===s&&(n instanceof t.RelationalModel?s=n.id:i.isObject(n)&&(s=n[e.prototype.idAttribute])),s||0===s||(s=null),s},find:function(e,t){var i=this.resolveIdForItem(e,t),n=this.getCollection(e);if(n){var s=n.get(i);if(s instanceof e)return s}return null},register:function(e){var t=this.getCollection(e);if(t){var i=e.collection;t.add(e),e.collection=i}},checkId:function(e,i){var n=this.getCollection(e),s=n&&n.get(i);if(s&&e!==s)throw t.Relational.showWarnings&&"undefined"!=typeof console&&console.warn("Duplicate id! Old RelationalModel=%o, new RelationalModel=%o",s,e),new Error("Cannot instantiate more than one Backbone.RelationalModel with the same id per type!")},update:function(e){var t=this.getCollection(e);t.contains(e)||this.register(e),t._onModelEvent("change:"+e.idAttribute,e,t),e.trigger("relational:change:id",e,t)},unregister:function(e){var n,s;e instanceof t.Model?(n=this.getCollection(e),s=[e]):e instanceof t.Collection?(n=this.getCollection(e.model),s=i.clone(e.models)):(n=this.getCollection(e),s=i.clone(n.models)),i.each(s,function(e){this.stopListening(e),i.invoke(e.getRelations(),"stopListening")},this),i.contains(this._collections,e)?n.reset([]):i.each(s,function(e){n.get(e)?n.remove(e):n.trigger("relational:remove",e,n)},this)},reset:function(){this.stopListening(),i.each(this._collections,function(e){this.unregister(e)},this),this._collections=[],this._subModels=[],this._modelScopes=[e]}}),t.Relational.store=new t.Store,t.Relation=function(e,n,s){if(this.instance=e,n=i.isObject(n)?n:{},this.reverseRelation=i.defaults(n.reverseRelation||{},this.options.reverseRelation),this.options=i.defaults(n,this.options,t.Relation.prototype.options),this.reverseRelation.type=i.isString(this.reverseRelation.type)?t[this.reverseRelation.type]||t.Relational.store.getObjectByName(this.reverseRelation.type):this.reverseRelation.type,this.key=this.options.key,this.keySource=this.options.keySource||this.key,this.keyDestination=this.options.keyDestination||this.keySource||this.key,this.model=this.options.model||this.instance.constructor,this.relatedModel=this.options.relatedModel,i.isUndefined(this.relatedModel)&&(this.relatedModel=this.model),!i.isFunction(this.relatedModel)||this.relatedModel.prototype instanceof t.RelationalModel||(this.relatedModel=i.result(this,"relatedModel")),i.isString(this.relatedModel)&&(this.relatedModel=t.Relational.store.getObjectByName(this.relatedModel)),this.checkPreconditions()&&(!this.options.isAutoRelation&&this.reverseRelation.type&&this.reverseRelation.key&&t.Relational.store.addReverseRelation(i.defaults({isAutoRelation:!0,model:this.relatedModel,relatedModel:this.model,reverseRelation:this.options},this.reverseRelation)),e)){var o=this.keySource;o!==this.key&&i.isObject(this.instance.get(this.key))&&(o=this.key),this.setKeyContents(this.instance.get(o)),this.relatedCollection=t.Relational.store.getCollection(this.relatedModel),this.keySource!==this.key&&delete this.instance.attributes[this.keySource],this.instance._relations[this.key]=this,this.initialize(s),this.options.autoFetch&&this.instance.getAsync(this.key,i.isObject(this.options.autoFetch)?this.options.autoFetch:{}),this.listenTo(this.instance,"destroy",this.destroy).listenTo(this.relatedCollection,"relational:add relational:change:id",this.tryAddRelated).listenTo(this.relatedCollection,"relational:remove",this.removeRelated)}},t.Relation.extend=t.Model.extend,i.extend(t.Relation.prototype,t.Events,t.Semaphore,{options:{createModels:!0,includeInJSON:!0,isAutoRelation:!1,autoFetch:!1,parse:!1},instance:null,key:null,keyContents:null,relatedModel:null,relatedCollection:null,reverseRelation:null,related:null,checkPreconditions:function(){var e=this.instance,n=this.key,s=this.model,o=this.relatedModel,a=t.Relational.showWarnings&&"undefined"!=typeof console;if(!s||!n||!o)return a&&console.warn("Relation=%o: missing model, key or relatedModel (%o, %o, %o).",this,s,n,o),!1;if(!(s.prototype instanceof t.RelationalModel))return a&&console.warn("Relation=%o: model does not inherit from Backbone.RelationalModel (%o).",this,e),!1;if(!(o.prototype instanceof t.RelationalModel))return a&&console.warn("Relation=%o: relatedModel does not inherit from Backbone.RelationalModel (%o).",this,o),!1;if(this instanceof t.HasMany&&this.reverseRelation.type===t.HasMany)return a&&console.warn("Relation=%o: relation is a HasMany, and the reverseRelation is HasMany as well.",this),!1;if(e&&i.keys(e._relations).length){var r=i.find(e._relations,function(e){return e.key===n},this);if(r)return a&&console.warn("Cannot create relation=%o on %o for model=%o: already taken by relation=%o.",this,n,e,r),!1}return!0},setRelated:function(e){this.related=e,this.instance.attributes[this.key]=e},_isReverseRelation:function(e){return e.instance instanceof this.relatedModel&&this.reverseRelation.key===e.key&&this.key===e.reverseRelation.key},getReverseRelations:function(e){for(var t=[],n=i.isUndefined(e)?this.related&&(this.related.models||[this.related]):[e],s=null,o=null,a=0;a<(n||[]).length;a++){s=n[a].getRelations()||[];for(var r=0;r<s.length;r++)o=s[r],this._isReverseRelation(o)&&t.push(o)}return t},destroy:function(){this.stopListening(),this instanceof t.HasOne?this.setRelated(null):this instanceof t.HasMany&&this.setRelated(this._prepareCollection()),i.each(this.getReverseRelations(),function(e){e.removeRelated(this.instance)},this)}}),t.HasOne=t.Relation.extend({options:{reverseRelation:{type:"HasMany"}},initialize:function(e){this.listenTo(this.instance,"relational:change:"+this.key,this.onChange);var t=this.findRelated(e);this.setRelated(t),i.each(this.getReverseRelations(),function(t){t.addRelated(this.instance,e)},this)},findRelated:function(e){var t=null;if(e=i.defaults({parse:this.options.parse},e),this.keyContents instanceof this.relatedModel)t=this.keyContents;else if(this.keyContents||0===this.keyContents){var n=i.defaults({create:this.options.createModels},e);t=this.relatedModel.findOrCreate(this.keyContents,n)}return t&&(this.keyId=null),t},setKeyContents:function(e){this.keyContents=e,this.keyId=t.Relational.store.resolveIdForItem(this.relatedModel,this.keyContents)},onChange:function(e,n,s){if(!this.isLocked()){this.acquire(),s=s?i.clone(s):{};var o=i.isUndefined(s.__related),a=o?this.related:s.__related;if(o){this.setKeyContents(n);var r=this.findRelated(s);this.setRelated(r)}if(a&&this.related!==a&&i.each(this.getReverseRelations(a),function(e){e.removeRelated(this.instance,null,s)},this),i.each(this.getReverseRelations(),function(e){e.addRelated(this.instance,s)},this),!s.silent&&this.related!==a){var l=this;this.changed=!0,t.Relational.eventQueue.add(function(){l.instance.trigger("change:"+l.key,l.instance,l.related,s,!0),l.changed=!1})}this.release()}},tryAddRelated:function(e,t,i){!this.keyId&&0!==this.keyId||e.id!==this.keyId||(this.addRelated(e,i),this.keyId=null)},addRelated:function(e,t){var n=this;e.queue(function(){if(e!==n.related){var s=n.related||null;n.setRelated(e),n.onChange(n.instance,e,i.defaults({__related:s},t))}})},removeRelated:function(e,t,n){if(this.related&&e===this.related){var s=this.related||null;this.setRelated(null),this.onChange(this.instance,e,i.defaults({__related:s},n))}}}),t.HasMany=t.Relation.extend({collectionType:null,options:{reverseRelation:{type:"HasOne"},collectionType:t.Collection,collectionKey:!0,collectionOptions:{}},initialize:function(e){if(this.listenTo(this.instance,"relational:change:"+this.key,this.onChange),this.collectionType=this.options.collectionType,!i.isFunction(this.collectionType)||this.collectionType===t.Collection||this.collectionType.prototype instanceof t.Collection||(this.collectionType=i.result(this,"collectionType")),i.isString(this.collectionType)&&(this.collectionType=t.Relational.store.getObjectByName(this.collectionType)),this.collectionType!==t.Collection&&!(this.collectionType.prototype instanceof t.Collection))throw new Error("`collectionType` must inherit from Backbone.Collection");var n=this.findRelated(e);this.setRelated(n)},_prepareCollection:function(e){if(this.related&&this.stopListening(this.related),!(e&&e instanceof t.Collection)){var n=i.isFunction(this.options.collectionOptions)?this.options.collectionOptions(this.instance):this.options.collectionOptions;e=new this.collectionType(null,n)}if(e.model=this.relatedModel,this.options.collectionKey){var s=this.options.collectionKey===!0?this.options.reverseRelation.key:this.options.collectionKey;e[s]&&e[s]!==this.instance?t.Relational.showWarnings&&"undefined"!=typeof console&&console.warn("Relation=%o; collectionKey=%s already exists on collection=%o",this,s,this.options.collectionKey):s&&(e[s]=this.instance)}return this.listenTo(e,"relational:add",this.handleAddition).listenTo(e,"relational:remove",this.handleRemoval).listenTo(e,"relational:reset",this.handleReset),e},findRelated:function(e){var n=null;if(e=i.defaults({parse:this.options.parse},e),this.keyContents instanceof t.Collection)this._prepareCollection(this.keyContents),n=this.keyContents;else{var s=[];i.each(this.keyContents,function(t){var n=null;n=t instanceof this.relatedModel?t:this.relatedModel.findOrCreate(t,i.extend({merge:!0},e,{create:this.options.createModels})),n&&s.push(n)},this),n=this.related instanceof t.Collection?this.related:this._prepareCollection(),n.set(s,i.defaults({merge:!1,parse:!1},e))}return this.keyIds=i.difference(this.keyIds,i.pluck(n.models,"id")),n},setKeyContents:function(e){this.keyContents=e instanceof t.Collection?e:null,this.keyIds=[],this.keyContents||!e&&0!==e||(this.keyContents=i.isArray(e)?e:[e],i.each(this.keyContents,function(e){var i=t.Relational.store.resolveIdForItem(this.relatedModel,e);(i||0===i)&&this.keyIds.push(i)},this))},onChange:function(e,n,s){s=s?i.clone(s):{},this.setKeyContents(n),this.changed=!1;var o=this.findRelated(s);if(this.setRelated(o),!s.silent){var a=this;t.Relational.eventQueue.add(function(){a.changed&&(a.instance.trigger("change:"+a.key,a.instance,a.related,s,!0),a.changed=!1)})}},handleAddition:function(e,n,s){s=s?i.clone(s):{},this.changed=!0,i.each(this.getReverseRelations(e),function(e){e.addRelated(this.instance,s)},this);var o=this;!s.silent&&t.Relational.eventQueue.add(function(){o.instance.trigger("add:"+o.key,e,o.related,s)})},handleRemoval:function(e,n,s){s=s?i.clone(s):{},this.changed=!0,i.each(this.getReverseRelations(e),function(e){e.removeRelated(this.instance,null,s)},this);var o=this;!s.silent&&t.Relational.eventQueue.add(function(){o.instance.trigger("remove:"+o.key,e,o.related,s)})},handleReset:function(e,n){var s=this;n=n?i.clone(n):{},!n.silent&&t.Relational.eventQueue.add(function(){s.instance.trigger("reset:"+s.key,s.related,n)})},tryAddRelated:function(e,t,n){var s=i.contains(this.keyIds,e.id);s&&(this.addRelated(e,n),this.keyIds=i.without(this.keyIds,e.id))},addRelated:function(e,t){var n=this;e.queue(function(){n.related&&!n.related.get(e)&&n.related.add(e,i.defaults({parse:!1},t))})},removeRelated:function(e,t,i){this.related.get(e)&&this.related.remove(e,i)}}),t.RelationalModel=t.Model.extend({relations:null,_relations:null,_isInitialized:!1,_deferProcessing:!1,_queue:null,_attributeChangeFired:!1,subModelTypeAttribute:"type",subModelTypes:null,constructor:function(e,n){if(n&&n.collection){var s=this,o=this.collection=n.collection;delete n.collection,this._deferProcessing=!0;var a=function(e){e===s&&(s._deferProcessing=!1,s.processQueue(),o.off("relational:add",a))};o.on("relational:add",a),i.defer(function(){a(s)})}t.Relational.store.processOrphanRelations(),t.Relational.store.listenTo(this,"relational:unregister",t.Relational.store.unregister),this._queue=new t.BlockingQueue,this._queue.block(),t.Relational.eventQueue.block();try{t.Model.apply(this,arguments)}finally{t.Relational.eventQueue.unblock()}},trigger:function(e){if(e.length>5&&0===e.indexOf("change")){var i=this,n=arguments;t.Relational.eventQueue.isLocked()?t.Relational.eventQueue.add(function(){var s=!0;if("change"===e)s=i.hasChanged()||i._attributeChangeFired,i._attributeChangeFired=!1;else{var o=e.slice(7),a=i.getRelation(o);a?(s=n[4]===!0,s?i.changed[o]=n[2]:a.changed||delete i.changed[o]):s&&(i._attributeChangeFired=!0)}s&&t.Model.prototype.trigger.apply(i,n)}):t.Model.prototype.trigger.apply(i,n)}else"destroy"===e?(t.Model.prototype.trigger.apply(this,arguments),t.Relational.store.unregister(this)):t.Model.prototype.trigger.apply(this,arguments);return this},initializeRelations:function(e){this.acquire(),this._relations={},i.each(this.relations||[],function(i){t.Relational.store.initializeRelation(this,i,e)},this),this._isInitialized=!0,this.release(),this.processQueue()},updateRelations:function(e,t){this._isInitialized&&!this.isLocked()&&i.each(this._relations,function(i){if(!e||i.keySource in e||i.key in e){var n=this.attributes[i.keySource]||this.attributes[i.key],s=e&&(e[i.keySource]||e[i.key]);(i.related!==n||null===n&&null===s)&&this.trigger("relational:change:"+i.key,this,n,t||{})}i.keySource!==i.key&&delete this.attributes[i.keySource]},this)},queue:function(e){this._queue.add(e)},processQueue:function(){this._isInitialized&&!this._deferProcessing&&this._queue.isBlocked()&&this._queue.unblock()},getRelation:function(e){return this._relations[e]},getRelations:function(){return i.values(this._relations)},getIdsToFetch:function(e,n){var s=e instanceof t.Relation?e:this.getRelation(e),o=s?s.keyIds&&s.keyIds.slice(0)||(s.keyId||0===s.keyId?[s.keyId]:[]):[];if(n){var a=s.related&&(s.related.models||[s.related]);i.each(a,function(e){(e.id||0===e.id)&&o.push(e.id)})}return o},getAsync:function(e,n){n=i.extend({add:!0,remove:!1,refresh:!1},n);var s=this,o=[],a=this.getRelation(e),r=a&&this.getIdsToFetch(a,n.refresh),l=a.related instanceof t.Collection?a.related:a.relatedCollection;if(r&&r.length){var c,d=[],u=[],h=function(){d=i.map(r,function(e){var t=a.relatedModel.findModel(e);if(!t){var i={};i[a.relatedModel.prototype.idAttribute]=e,t=a.relatedModel.findOrCreate(i,n),u.push(t)}return t},this)};if(l instanceof t.Collection&&i.isFunction(l.url)){var p=l.url();c=l.url(r),c===p&&(h(),c=l.url(d),c===p&&(c=null))}if(c){var f=i.defaults({error:function(){i.each(u,function(e){e.trigger("destroy",e,e.collection,n)}),n.error&&n.error.apply(d,arguments)},url:c},n);o=[l.fetch(f)]}else d.length||h(),o=i.map(d,function(e){var t=i.defaults({error:function(){i.contains(u,e)&&e.trigger("destroy",e,e.collection,n),n.error&&n.error.apply(d,arguments)}},n);return e.fetch(t)},this)}return $.when.apply(null,o).then(function(){return t.Model.prototype.get.call(s,e)})},set:function(e,n,s){t.Relational.eventQueue.block();var o,a;i.isObject(e)||null==e?(o=e,s=n):(o={},o[e]=n);try{var r=this.id,l=o&&this.idAttribute in o&&o[this.idAttribute];t.Relational.store.checkId(this,l),a=t.Model.prototype.set.apply(this,arguments),this._isInitialized||this.isLocked()?l&&l!==r&&t.Relational.store.update(this):(this.constructor.initializeModelHierarchy(),(l||0===l)&&t.Relational.store.register(this),this.initializeRelations(s)),o&&this.updateRelations(o,s)}finally{t.Relational.eventQueue.unblock()}return a},clone:function(){var e=i.clone(this.attributes);return i.isUndefined(e[this.idAttribute])||(e[this.idAttribute]=null),i.each(this.getRelations(),function(t){delete e[t.key]}),new this.constructor(e)},toJSON:function(e){if(this.isLocked())return this.id;this.acquire();var n=t.Model.prototype.toJSON.call(this,e);return!this.constructor._superModel||this.constructor._subModelTypeAttribute in n||(n[this.constructor._subModelTypeAttribute]=this.constructor._subModelTypeValue),i.each(this._relations,function(s){var o=n[s.key],a=s.options.includeInJSON,r=null;a===!0?o&&i.isFunction(o.toJSON)&&(r=o.toJSON(e)):i.isString(a)?(o instanceof t.Collection?r=o.pluck(a):o instanceof t.Model&&(r=o.get(a)),a===s.relatedModel.prototype.idAttribute&&(s instanceof t.HasMany?r=r.concat(s.keyIds):s instanceof t.HasOne&&(r=r||s.keyId,r||i.isObject(s.keyContents)||(r=s.keyContents||null)))):i.isArray(a)?o instanceof t.Collection?(r=[],o.each(function(e){var t={};i.each(a,function(i){t[i]=e.get(i)}),r.push(t)})):o instanceof t.Model&&(r={},i.each(a,function(e){r[e]=o.get(e)})):delete n[s.key],null===r&&e&&e.wait&&(r=o),a&&(n[s.keyDestination]=r),s.keyDestination!==s.key&&delete n[s.key]}),this.release(),n}},{setup:function(){return this.prototype.relations=(this.prototype.relations||[]).slice(0),this._subModels={},this._superModel=null,this.prototype.hasOwnProperty("subModelTypes")?t.Relational.store.addSubModels(this.prototype.subModelTypes,this):this.prototype.subModelTypes=null,i.each(this.prototype.relations||[],function(e){if(e.model||(e.model=this),e.reverseRelation&&e.model===this){var n=!0;if(i.isString(e.relatedModel)){var s=t.Relational.store.getObjectByName(e.relatedModel);n=s&&s.prototype instanceof t.RelationalModel}n?t.Relational.store.initializeRelation(null,e):i.isString(e.relatedModel)&&t.Relational.store.addOrphanRelation(e)}},this),this},build:function(e,t){this.initializeModelHierarchy();var i=this._findSubModelType(this,e)||this;return new i(e,t)},_findSubModelType:function(e,t){if(e._subModels&&e.prototype.subModelTypeAttribute in t){var i=t[e.prototype.subModelTypeAttribute],n=e._subModels[i];if(n)return n;for(i in e._subModels)if(n=this._findSubModelType(e._subModels[i],t))return n}return null},initializeModelHierarchy:function(){if(this.inheritRelations(),this.prototype.subModelTypes){var e=i.keys(this._subModels),n=i.omit(this.prototype.subModelTypes,e);i.each(n,function(e){var i=t.Relational.store.getObjectByName(e);i&&i.initializeModelHierarchy()})}},inheritRelations:function(){if(i.isUndefined(this._superModel)||i.isNull(this._superModel))if(t.Relational.store.setupSuperModel(this),this._superModel){if(this._superModel.inheritRelations(),this._superModel.prototype.relations){var e=i.filter(this._superModel.prototype.relations||[],function(e){return!i.any(this.prototype.relations||[],function(t){return e.relatedModel===t.relatedModel&&e.key===t.key},this)},this);this.prototype.relations=e.concat(this.prototype.relations)}}else this._superModel=!1},findOrCreate:function(e,t){t||(t={});var n=i.isObject(e)&&t.parse&&this.prototype.parse?this.prototype.parse(i.clone(e)):e,s=this.findModel(n);return i.isObject(e)&&(s&&t.merge!==!1?(delete t.collection,delete t.url,s.set(n,t)):s||t.create===!1||(s=this.build(n,i.defaults({parse:!1},t)))),s},find:function(e,t){return t||(t={}),t.create=!1,this.findOrCreate(e,t)},findModel:function(e){return t.Relational.store.find(this,e)}}),i.extend(t.RelationalModel.prototype,t.Semaphore),t.Collection.prototype.__prepareModel=t.Collection.prototype._prepareModel,t.Collection.prototype._prepareModel=function(e,n){var s;return e instanceof t.Model?(e.collection||(e.collection=this),s=e):(n=n?i.clone(n):{},n.collection=this,s="undefined"!=typeof this.model.findOrCreate?this.model.findOrCreate(e,n):new this.model(e,n),s&&s.validationError&&(this.trigger("invalid",this,e,n),s=!1)),s};var n=t.Collection.prototype.__set=t.Collection.prototype.set;t.Collection.prototype.set=function(e,s){if(!(this.model.prototype instanceof t.RelationalModel))return n.call(this,e,s);s&&s.parse&&(e=this.parse(e,s));var o=!i.isArray(e),a=[],r=[],l=null;e=o?e?[e]:[]:i.clone(e);for(var c=0;c<e.length;c++)l=e[c],l instanceof t.Model||(l=t.Collection.prototype._prepareModel.call(this,l,s)),l&&(r.push(l),this.get(l)||this.get(l.cid)?null!==l.id&&void 0!==l.id&&(this._byId[l.id]=l):a.push(l));r=o?r.length?r[0]:null:r;var d=n.call(this,r,i.defaults({merge:!1,parse:!1},s));for(c=0;c<a.length;c++)l=a[c],(this.get(l)||this.get(l.cid))&&this.trigger("relational:add",l,this,s);return d};var s=t.Collection.prototype.__remove=t.Collection.prototype.remove;t.Collection.prototype.remove=function(e,n){if(!(this.model.prototype instanceof t.RelationalModel))return s.call(this,e,n);var o=!i.isArray(e),a=[];e=o?e?[e]:[]:i.clone(e),n||(n={}),i.each(e,function(e){e=this.get(e)||e&&this.get(e.cid),e&&a.push(e)},this);var r=s.call(this,o?a.length?a[0]:null:a,n);return i.each(a,function(e){this.trigger("relational:remove",e,this,n)},this),r};var o=t.Collection.prototype.__reset=t.Collection.prototype.reset;t.Collection.prototype.reset=function(e,n){n=i.extend({merge:!0},n);var s=o.call(this,e,n);return this.model.prototype instanceof t.RelationalModel&&this.trigger("relational:reset",this,n),s};var a=t.Collection.prototype.__sort=t.Collection.prototype.sort;t.Collection.prototype.sort=function(e){var i=a.call(this,e);return this.model.prototype instanceof t.RelationalModel&&this.trigger("relational:reset",this,e),i};var r=t.Collection.prototype.__trigger=t.Collection.prototype.trigger;t.Collection.prototype.trigger=function(e){if(!(this.model.prototype instanceof t.RelationalModel))return r.apply(this,arguments);if("add"===e||"remove"===e||"reset"===e||"sort"===e){var n=this,s=arguments;i.isObject(s[3])&&(s=i.toArray(s),s[3]=i.clone(s[3])),t.Relational.eventQueue.add(function(){r.apply(n,s)})}else r.apply(this,arguments);return this},t.RelationalModel.extend=function(e,i){var n=t.Model.extend.call(this,e,i);return n.setup(this),n}}),function(e,t){if("function"==typeof define&&define.amd)define("backbone.associations",["underscore","backbone"],function(i,n){return t(e,n,i)});else if("undefined"!=typeof exports){var i=require("underscore"),n=require("backbone");t(e,n,i),"undefined"!=typeof module&&module.exports&&(module.exports=n),exports=n}else t(e,e.Backbone,e._)}(this,function(e,t,i){var n,s,o,a,r,l,c,d,u,h,p,f={};n=t.Model,s=t.Collection,o=n.prototype,r=s.prototype,a=t.Events,t.Associations={VERSION:"0.6.2"},t.Associations.scopes=[];var g=function(){return u},m=function(e){(!i.isString(e)||1>i.size(e))&&(e="."),u=e,c=RegExp("[\\"+u+"\\[\\]]+","g"),d=RegExp("[^\\"+u+"\\[\\]]+","g")};try{Object.defineProperty(t.Associations,"SEPARATOR",{enumerable:!0,get:g,set:m})}catch(v){}t.Associations.Many=t.Many="Many",t.Associations.One=t.One="One",t.Associations.Self=t.Self="Self",t.Associations.SEPARATOR=".",t.Associations.getSeparator=g,t.Associations.setSeparator=m,t.Associations.EVENTS_BUBBLE=!0,t.Associations.EVENTS_WILDCARD=!0,t.Associations.EVENTS_NC=!1,m(),l=t.AssociatedModel=t.Associations.AssociatedModel=n.extend({relations:void 0,_proxyCalls:void 0,constructor:function(e,t){t&&t.__parents__&&(this.parents=[t.__parents__]),n.apply(this,arguments)},on:function(e,n,s){var o=a.on.apply(this,arguments);if(t.Associations.EVENTS_NC)return o;var r=/\s+/;return i.isString(e)&&e&&!r.test(e)&&n&&(r=b(e))&&(f[r]="undefined"==typeof f[r]?1:f[r]+1),o},off:function(e,n,s){if(t.Associations.EVENTS_NC)return a.off.apply(this,arguments);var o=/\s+/,r=this._events,l={},c=r?i.keys(r):[],d=!e&&!n&&!s,u=i.isString(e)&&!o.test(e);if(d||u)for(var o=0,h=c.length;h>o;o++)l[c[o]]=r[c[o]]?r[c[o]].length:0;var p=a.off.apply(this,arguments);if(d||u)for(o=0,h=c.length;h>o;o++)(d=b(c[o]))&&(f[d]=r[c[o]]?f[d]-(l[c[o]]-r[c[o]].length):f[d]-l[c[o]]);return p},get:function(e){var t=this.__attributes__,i=o.get.call(this,e),t=t?x(i)?i:t[e]:i;return x(t)?t:this._getAttr.apply(this,arguments)},set:function(e,t,n){var s;return i.isObject(e)||null==e?(s=e,n=t):(s={},s[e]=t),e=this._set(s,n),this._processPendingEvents(),e},_set:function(e,t){var s,o,a,r,l=this;if(!e)return this;this.__attributes__=e;for(s in e)if(o||(o={}),s.match(c)){var d=y(s);r=i.initial(d),d=d[d.length-1],r=this.get(r),r instanceof n&&(r=o[r.cid]||(o[r.cid]={model:r,data:{}}),r.data[d]=e[s])}else r=o[this.cid]||(o[this.cid]={model:this,data:{}}),r.data[s]=e[s];if(o)for(a in o)r=o[a],this._setAttr.call(r.model,r.data,t)||(l=!1);else l=this._setAttr.call(this,e,t);return delete this.__attributes__,l},_setAttr:function(a,r){var l;if(r||(r={}),r.unset)for(l in a)a[l]=void 0;return this.parents=this.parents||[],this.relations&&i.each(this.relations,function(o){var l,c,d=o.key,u=o.scope||e,h=this._transformRelatedModel(o,a),p=this._transformCollectionType(o,h,a),f=i.isString(o.map)?w(o.map,u):o.map,g=this.attributes[d],m=g&&g.idAttribute,v=!1;if(l=o.options?i.extend({},o.options,r):r,a[d]){if(u=i.result(a,d),u=f?f.call(this,u,p?p:h):u,x(u))if(o.type===t.Many)g?(g._deferEvents=!0,g[l.reset?"reset":"set"](u instanceof s?u.models:u,l),h=g):(v=!0,u instanceof s?h=u:(h=this._createCollection(p||s,o.collectionOptions||(h?{model:h}:{})),h[l.reset?"reset":"set"](u,l)));else{if(o.type!==t.One)throw Error("type attribute must be specified and have the values Backbone.One or Backbone.Many");o=u instanceof n?u.attributes.hasOwnProperty(m):u.hasOwnProperty(m),p=u instanceof n?u.attributes[m]:u[m],g&&o&&g.attributes[m]===p?(g._deferEvents=!0,g._set(u instanceof n?u.attributes:u,l),h=g):(v=!0,u instanceof n?h=u:(l.__parents__=this,h=new h(u,l),delete l.__parents__))}else h=u;c=a[d]=h,(v||c&&!c._proxyCallback)&&(c._proxyCallback||(c._proxyCallback=function(){return t.Associations.EVENTS_BUBBLE&&this._bubbleEvent.call(this,d,c,arguments)}),c.on("all",c._proxyCallback,this))}a.hasOwnProperty(d)&&this._setupParents(a[d],this.attributes[d])},this),o.set.call(this,a,r)},_bubbleEvent:function(e,i,o){var a,r=o[0].split(":"),l=r[0],c="nested-change"==o[0],d="change"===l,g=o[1],m=-1,v=i._proxyCalls,r=r[1],y=!r||-1==r.indexOf(u);return!c&&(y&&(p=b(o[0])||e),t.Associations.EVENTS_NC||f[p])?t.Associations.EVENTS_WILDCARD&&/\[\*\]/g.test(r)?this:(i instanceof s&&(d||r)&&(m=i.indexOf(h||g)),this instanceof n&&(h=this),r=e+(-1!==m&&(d||r)?"["+m+"]":"")+(r?u+r:""),t.Associations.EVENTS_WILDCARD&&(a=r.replace(/\[\d+\]/g,"[*]")),c=[],c.push.apply(c,o),c[0]=l+":"+r,t.Associations.EVENTS_WILDCARD&&r!==a&&(c[0]=c[0]+" "+l+":"+a),v=i._proxyCalls=v||{},this._isEventAvailable.call(this,v,r)?this:(v[r]=!0,d&&(this._previousAttributes[e]=i._previousAttributes,this.changed[e]=i),this.trigger.apply(this,c),t.Associations.EVENTS_NC&&d&&this.get(r)!=o[2]&&(e=["nested-change",r,o[1]],o[2]&&e.push(o[2]),this.trigger.apply(this,e)),v&&r&&delete v[r],h=void 0,this)):void 0},_isEventAvailable:function(e,t){return i.find(e,function(e,i){return-1!==t.indexOf(i,t.length-i.length)})},_setupParents:function(e,t){e&&(e.parents=e.parents||[],-1==i.indexOf(e.parents,this)&&e.parents.push(this)),t&&0<t.parents.length&&t!=e&&(t.parents=i.difference(t.parents,[this]),t._proxyCallback&&t.off("all",t._proxyCallback,this))},_createCollection:function(e,t){var t=i.defaults(t,{model:e.model}),n=new e([],i.isFunction(t)?t.call(this):t);return n.parents=[this],n},_processPendingEvents:function(){this._processedEvents||(this._processedEvents=!0,this._deferEvents=!1,i.each(this._pendingEvents,function(e){e.c.trigger.apply(e.c,e.a)}),this._pendingEvents=[],i.each(this.relations,function(e){(e=this.attributes[e.key])&&e._processPendingEvents&&e._processPendingEvents()},this),delete this._processedEvents)},_transformRelatedModel:function(s,o){var a=s.relatedModel,r=s.scope||e;if(a&&!(a.prototype instanceof n)&&(a=i.isFunction(a)?a.call(this,s,o):a),a&&i.isString(a)&&(a=a===t.Self?this.constructor:w(a,r)),s.type===t.One){if(!a)throw Error("specify a relatedModel for Backbone.One type");if(!(a.prototype instanceof t.Model))throw Error("specify an AssociatedModel or Backbone.Model for Backbone.One type")}return a},_transformCollectionType:function(o,a,r){var l=o.collectionType,c=o.scope||e;if(l&&i.isFunction(l)&&l.prototype instanceof n)throw Error("type is of Backbone.Model. Specify derivatives of Backbone.Collection");if(l&&!(l.prototype instanceof s)&&(l=i.isFunction(l)?l.call(this,o,r):l),l&&i.isString(l)&&(l=w(l,c)),l&&!l.prototype instanceof s)throw Error("collectionType must inherit from Backbone.Collection");if(o.type===t.Many&&!a&&!l)throw Error("specify either a relatedModel or collectionType");return l},trigger:function(e){this._deferEvents?(this._pendingEvents=this._pendingEvents||[],this._pendingEvents.push({c:this,a:arguments})):o.trigger.apply(this,arguments)},toJSON:function(e){var t,n={};return n[this.idAttribute]=this.id,this.visited||(this.visited=!0,n=o.toJSON.apply(this,arguments),e&&e.serialize_keys&&(n=i.pick(n,e.serialize_keys)),this.relations&&i.each(this.relations,function(s){var o=s.key,a=s.remoteKey,r=this.attributes[o],l=!s.isTransient,s=s.serialize||[],c=i.clone(e);
delete n[o],l&&(s.length&&(c?c.serialize_keys=s:c={serialize_keys:s}),t=r&&r.toJSON?r.toJSON(c):r,n[a||o]=i.isArray(t)?i.compact(t):t)},this),delete this.visited),n},clone:function(e){return new this.constructor(this.toJSON(e))},cleanup:function(e){e=e||{},i.each(this.relations,function(e){(e=this.attributes[e.key])&&(e._proxyCallback&&e.off("all",e._proxyCallback,this),e.parents=i.difference(e.parents,[this]))},this),!e.listen&&this.off()},destroy:function(e){var e=e?i.clone(e):{},e=i.defaults(e,{remove_references:!0,listen:!0}),t=this;if(e.remove_references&&e.wait){var n=e.success;e.success=function(i){n&&n(t,i,e),t.cleanup(e)}}var s=o.destroy.apply(this,[e]);return e.remove_references&&!e.wait&&t.cleanup(e),s},_getAttr:function(e){var t,n,o=this,a=this.__attributes__,e=y(e);if(!(1>i.size(e))){for(n=0;n<e.length&&(t=e[n],o);n++)o=o instanceof s?isNaN(t)?void 0:o.at(t):a?x(o.attributes[t])?o.attributes[t]:a[t]:o.attributes[t];return o}}});var y=function(e){return""===e?[""]:i.isString(e)?e.match(d):e||[]},b=function(e){return e?(e=e.split(":"),1<e.length?(e=e[e.length-1],e=e.split(u),1<e.length?e[e.length-1].split("[")[0]:e[0].split("[")[0]):""):e},w=function(e,n){var s,o=[n];o.push.apply(o,t.Associations.scopes);for(var a,r=0,l=o.length;l>r&&(!(a=o[r])||!(s=i.reduce(e.split(u),function(e,t){return e[t]},a)));++r);return s},_=function(e,t,n){var s,o;return i.find(e,function(e){return(s=i.find(e.relations,function(i){return e.get(i.key)===t},this))?(o=e,!0):void 0},this),s&&s.map?s.map.call(o,n,t):n},x=function(e){return!i.isUndefined(e)&&!i.isNull(e)},k={};return i.each(["set","remove","reset"],function(e){k[e]=s.prototype[e],r[e]=function(t,i){return this.model.prototype instanceof l&&this.parents&&(arguments[0]=_(this.parents,this,t)),k[e].apply(this,arguments)}}),k.trigger=r.trigger,r.trigger=function(e){this._deferEvents?(this._pendingEvents=this._pendingEvents||[],this._pendingEvents.push({c:this,a:arguments})):k.trigger.apply(this,arguments)},r._processPendingEvents=l.prototype._processPendingEvents,r.on=l.prototype.on,r.off=l.prototype.off,t}),function(){this.AjaxPrefix={addAjaxPrefix:function(e,t){return e.postWithPrefix=function(e,i,n,s){return $.post(""+t()+e,i,n,s)},e.getWithPrefix=function(e,i,n,s){return $.get(""+t()+e,i,n,s)},e.ajaxWithPrefix=function(e,i){return null!=i?$.ajax(""+t()+e,i):(i=e,i.url=""+t()+i.url,$.ajax(i))}}}}.call(this),define("js/src/ajax_prefix",function(){}),define("domReady",[],function(){"use strict";function e(e){var t;for(t=0;t<e.length;t+=1)e[t](c)}function t(){var t=d;l&&t.length&&(d=[],e(t))}function i(){l||(l=!0,a&&clearInterval(a),t())}function n(e){return l?e(c):d.push(e),n}var s,o,a,r="undefined"!=typeof window&&window.document,l=!r,c=r?document:null,d=[];if(r){if(document.addEventListener)document.addEventListener("DOMContentLoaded",i,!1),window.addEventListener("load",i,!1);else if(window.attachEvent){window.attachEvent("onload",i),o=document.createElement("div");try{s=null===window.frameElement}catch(u){}o.doScroll&&s&&window.external&&(a=setInterval(function(){try{o.doScroll(),i()}catch(e){}},30))}"complete"===document.readyState&&i()}return n.version="2.0.1",n.load=function(e,t,i,s){s.isBuild?i(null):n(i)},n}),define("text",{load:function(e){throw new Error("Dynamic load not allowed: "+e)}}),define("text!common/templates/components/system-feedback.underscore",[],function(){return'<div class="wrapper wrapper-<%= type %> wrapper-<%= type %>-<%= intent %>\n            <% if(obj.shown) { %>is-shown<% } else { %>is-hiding<% } %>\n            <% if(_.contains([\'help\', \'mini\'], intent)) { %>wrapper-<%= type %>-status<% } %>"\n     id="<%= type %>-<%= intent %>"\n     aria-hidden="<% if(obj.shown) { %>false<% } else { %>true<% } %>"\n     aria-labelledby="<%= type %>-<%= intent %>-title"\n     tabindex="-1"\n     <% if (obj.message) { %>aria-describedby="<%= type %>-<%= intent %>-description" <% } %>\n     <% if (obj.actions) { %>role="dialog"<% } %>\n  >\n  <div class="<%= type %> <%= intent %> <% if(obj.actions) { %>has-actions<% } %>">\n    <% if(obj.icon) { %>\n      <% var iconClass = {"warning": "warning", "confirmation": "check", "error": "warning", "announcement": "bullhorn", "step-required": "exclamation-circle", "help": "question", "mini": "cog"} %>\n      <span class="feedback-symbol fa fa-<%= iconClass[intent] %>" aria-hidden="true"></span>\n    <% } %>\n\n    <div class="copy">\n      <h2 class="title title-3" id="<%= type %>-<%= intent %>-title"><%- title %></h2>\n      <% if(obj.message) { %><p class="message" id="<%= type %>-<%= intent %>-description"><%- message %></p><% } %>\n    </div>\n\n    <% if(obj.actions) { %>\n    <nav class="nav-actions">\n      <ul>\n        <% if(actions.primary) { %>\n        <li class="nav-item">\n          <button class="action-primary <%= actions.primary.class %>"><%- actions.primary.text %></button>\n        </li>\n        <% } %>\n        <% if(actions.secondary) {\n             _.each(actions.secondary, function(secondary) { %>\n        <li class="nav-item">\n          <button class="action-secondary <%= secondary.class %>"><%- secondary.text %></button>\n        </li>\n        <%   });\n           } %>\n      </ul>\n    </nav>\n    <% } %>\n\n    <% if(obj.closeIcon) { %>\n    <a href="#" rel="view" class="action action-close action-<%= type %>-close">\n      <span class="icon fa fa-times-circle" aria-hidden="true"></span>\n      <span class="label">close <%= type %></span>\n    </a>\n    <% } %>\n  </div>\n</div>\n'}),function(e){"use strict";e("common/js/components/views/feedback",["jquery","underscore","underscore.string","backbone","edx-ui-toolkit/js/utils/html-utils","text!../../../../common/templates/components/system-feedback.underscore"],function(e,t,i,n,s,o){var a=["a[href]:not([tabindex='-1'])","area[href]:not([tabindex='-1'])","input:not([disabled]):not([tabindex='-1'])","select:not([disabled]):not([tabindex='-1'])","textarea:not([disabled]):not([tabindex='-1'])","button:not([disabled]):not([tabindex='-1'])","iframe:not([tabindex='-1'])","[tabindex]:not([tabindex='-1'])","[contentEditable=true]:not([tabindex='-1'])"],r=n.View.extend({options:{title:"",message:"",intent:null,type:null,shown:!0,icon:!0,closeIcon:!0,minShown:0,maxShown:1/0,outFocusElement:null},initialize:function(i){if(this.options=t.extend({},this.options,i),!this.options.type)throw"SystemFeedback: type required (given "+JSON.stringify(this.options)+")";if(!this.options.intent)throw"SystemFeedback: intent required (given "+JSON.stringify(this.options)+")";return this.setElement(e("#page-"+this.options.type)),this.options.actions&&this.options.actions.secondary&&!t.isArray(this.options.actions.secondary)&&(this.options.actions.secondary=[this.options.actions.secondary]),this},inFocus:function(e){var t,i=e||".wrapper";return this.options.outFocusElement=this.options.outFocusElement||document.activeElement,this.$(i).first().focus(),t=this.$(a.join()),t.on("keydown",function(e){9===e.which&&e.shiftKey&&e.target===t.first()[0]?(e.preventDefault(),t.last().focus()):9!==e.which||e.shiftKey||e.target!==t.last()[0]||(e.preventDefault(),t.first().focus())}),this},outFocus:function(){return this.$(a.join()).off("keydown"),this.options.outFocusElement&&this.options.outFocusElement.focus(),this},show:function(){return clearTimeout(this.hideTimeout),this.options.shown=!0,this.shownAt=new Date,this.render(),e.isNumeric(this.options.maxShown)&&(this.hideTimeout=setTimeout(t.bind(this.hide,this),this.options.maxShown)),this},hide:function(){return this.shownAt&&e.isNumeric(this.options.minShown)&&this.options.minShown>new Date-this.shownAt?(clearTimeout(this.hideTimeout),this.hideTimeout=setTimeout(t.bind(this.hide,this),this.options.minShown-(new Date-this.shownAt))):(this.options.shown=!1,delete this.shownAt,this.render()),this},events:{"click .action-close":"hide","click .action-primary":"primaryClick","click .action-secondary":"secondaryClick"},render:function(){var e=r["active_"+this.options.type];return e&&e!==this&&(e.stopListening(),e.undelegateEvents()),s.setHtml(this.$el,s.template(o)(this.options)),r["active_"+this.options.type]=this,this},primaryClick:function(e){var t,i;t=this.options.actions,t&&(i=t.primary,i&&(i.preventDefault!==!1&&e.preventDefault(),i.click&&i.click.call(e.target,this,e)))},secondaryClick:function(e){var i,n,s,o;i=this.options.actions,i&&(n=i.secondary,n&&(o=0,e&&e.target&&(o=t.indexOf(this.$(".action-secondary"),e.target)),s=n[o],s.preventDefault!==!1&&e.preventDefault(),s.click&&s.click.call(e.target,this,e)))}});return r})}.call(this,define||RequireJS.define),function(e){"use strict";e("common/js/components/views/feedback_notification",["jquery","underscore","underscore.string","./feedback"],function(e,t,i,n){var s,o,a,r=n.extend({options:e.extend({},n.prototype.options,{type:"notification",closeIcon:!1})});return s=t.compose(i.capitalize,i.camelize),o=["warning","error","confirmation","announcement","step-required","help","mini"],t.each(o,function(t){var i;i=r.extend({options:e.extend({},r.prototype.options,{intent:t})}),r[s(t)]=i}),a=r.Mini.prototype.options,a.minShown=1250,a.closeIcon=!1,r})}.call(this,define||RequireJS.define),define("cms/js/main",["domReady","jquery","underscore","underscore.string","backbone","gettext","../../common/js/components/views/feedback_notification","jquery.cookie"],function(e,t,i,n,s,o,a){"use strict";var r,l;return r=function(){return AjaxPrefix.addAjaxPrefix(jQuery,function(){return t("meta[name='path_prefix']").attr("content")}),window.CMS=window.CMS||{},window.CMS.URL=window.CMS.URL||{},window.onTouchBasedDevice=function(){return navigator.userAgent.match(/iPhone|iPod|iPad|Android/i)},i.extend(window.CMS,s.Events),s.emulateHTTP=!0,t.ajaxSetup({headers:{"X-CSRFToken":t.cookie("csrftoken")},dataType:"json",content:{script:!1}}),t(document).ajaxError(function(e,t,i){var n,s,r=o("This may be happening because of an error with our server or your internet connection. Try refreshing the page or making sure you are online.");if(i.notifyOnError!==!1)return s=t.getResponseHeader("content-type"),s&&s.indexOf("json")>-1&&t.responseText&&(r=JSON.parse(t.responseText).error),n=new a.Error({title:o("Studio's having trouble saving your work"),message:r}),console.log("Studio AJAX Error",{url:e.currentTarget.URL,response:t.responseText,status:t.status}),n.show()}),l=function(e,i,n,s){return t.isFunction(i)&&(n=i,i=void 0),t.ajax({url:e,type:s,contentType:"application/json; charset=utf-8",dataType:"json",data:JSON.stringify(i),success:n,global:i?i.global:!0})},t.postJSON=function(e,t,i){return l(e,t,i,"POST")},t.patchJSON=function(e,t,i){return l(e,t,i,"PATCH")},e(function(){return window.onTouchBasedDevice()?t("body").addClass("touch-based-device"):null})},r(),r}),define("js/certificates/models/signatory",["underscore","backbone","backbone-relational"],function(e,t){"use strict";var i=t.RelationalModel.extend({idAttribute:"id",defaults:{name:"",title:"",organization:"",signature_image_path:""},initialize:function(){return this.setOriginalAttributes(),this},parse:function(e){return e},setOriginalAttributes:function(){this._originalAttributes=this.parse(this.toJSON())},reset:function(){this.set(this._originalAttributes,{parse:!0,validate:!0})}});return i}),define("js/certificates/collections/signatories",["backbone","js/certificates/models/signatory"],function(e,t){"use strict";var i=e.Collection.extend({model:t});return i}),define("js/certificates/models/certificate",["underscore","backbone","backbone-relational","backbone.associations","gettext","cms/js/main","js/certificates/models/signatory","js/certificates/collections/signatories"],function(e,t,i,n,s,o,a,r){"use strict";var l=t.RelationalModel.extend({idAttribute:"id",defaults:{course_title:"",name:"Name of the certificate",description:"Description of the certificate",version:1,is_active:!1},relations:[{type:t.HasMany,key:"signatories",relatedModel:a,collectionType:r,reverseRelation:{key:"certificate",includeInJSON:"id"}}],initialize:function(e,t){return this.canBeEmpty=t&&t.canBeEmpty,t.add&&(e.signatories=new a({certificate:this})),this.setOriginalAttributes(),this},parse:function(e){return e},setOriginalAttributes:function(){this._originalAttributes=this.parse(this.toJSON()),this.get("signatories").each(function(e){e.setOriginalAttributes()}),this.isNew()||this.get("signatories").url||(this.get("signatories").url=this.collection.url+"/"+this.get("id")+"/signatories")},validate:function(t){if(!t.name.trim())return{message:s("Certificate name is required."),attributes:{name:!0}};var i=e.every(t.signatories.models,function(e){return e.isValid()});return i?void 0:{message:s("Signatory field(s) has invalid data."),attributes:{signatories:t.signatories.models}}},reset:function(){this.set(this._originalAttributes,{parse:!0,validate:!0})}});return l}),define("js/certificates/collections/certificates",["backbone","gettext","js/certificates/models/certificate"],function(e,t,i){"use strict";var n=e.Collection.extend({model:i,maxAllowed:1,initialize:function(e,t){this.url=t.certificateUrl,this.bind("remove",this.onModelRemoved,this),this.bind("add",this.onModelAdd,this)},certificateArray:function(e){var t;try{t=JSON.parse(e)}catch(i){t="object"==typeof e?e:[]}return t},onModelRemoved:function(){window.certWebPreview&&0===this.length&&window.certWebPreview.remove(),this.toggleAddNewItemButtonState()},onModelAdd:function(){this.toggleAddNewItemButtonState()},toggleAddNewItemButtonState:function(){this.length>=this.maxAllowed?$(".action-add").addClass("action-add-hidden"):$(".action-add").removeClass("action-add-hidden")},parse:function(e){var t=this.certificateArray(e);return t.forEach(function(e){this.push(e)},this),this.models}});return n}),define("js/utils/handle_iframe_binding",["jquery"],function(e){var t=function(t){var n=null;n="undefined"==typeof t?e("iframe, embed"):"undefined"!=typeof t.nodeName?e(t).find("iframe, embed"):t.$("iframe, embed"),i(n)},i=function(t){t.each(function(){if("IFRAME"===e(this).prop("tagName")){var t=e(this).attr("src");if(t){var i="wmode=transparent";if(-1!==t.indexOf("?")){var n=t.split("?");if(-1===n[1].search("wmode=transparent")){var s=n[1],o=n[0];e(this).attr("src",o+"?"+i+"&"+s)}}else 0!==t.lastIndexOf("javascript:",0)&&e(this).attr("src",t+"?"+i)}}else e(this).attr("wmode","transparent")})},n=function(t){if(t){var n=null,s=document.createElement("div");e(s).html(t),n=e(s).find("iframe, embed"),n.length>0&&(i(n),t=e(s).html())}return t};return{iframeBinding:t,iframeBindingHtml:n}}),define("js/utils/templates",["jquery","underscore"],function(e,t){var i=function(i){var n="#"+i+"-tpl",s=e(n).text();return s||console.error("Failed to load "+i+" template"),t.template(s)};return{loadTemplate:i}}),function(e){"use strict";e("common/js/components/views/feedback_prompt",["jquery","underscore","underscore.string","common/js/components/views/feedback"],function(e,t,i,n){var s,o,a=n.extend({options:e.extend({},n.prototype.options,{type:"prompt",closeIcon:!1,icon:!1}),render:function(){return window.$body||(window.$body=e(document.body)),this.options.shown?$body.addClass("prompt-is-shown"):$body.removeClass("prompt-is-shown"),n.prototype.render.apply(this,arguments)},show:function(){return n.prototype.show.apply(this,arguments),this.inFocus()},hide:function(){return n.prototype.hide.apply(this,arguments),this.outFocus()}});return s=t.compose(i.capitalize,i.camelize),o=["warning","error","confirmation","announcement","step-required","help","mini"],t.each(o,function(t){var i;i=a.extend({options:e.extend({},a.prototype.options,{intent:t})}),a[s(t)]=i}),a})}.call(this,define||RequireJS.define),function(e,t){"use strict";e("common/js/components/utils/view_utils",["jquery","underscore","gettext","common/js/components/views/feedback_notification","common/js/components/views/feedback_prompt"],function(e,i,n,s,o){var a,r,l,c,d,u,h,p,f,g,m,v,y,b,w,_,x,k,S,C=65;return a=function(e,t){var i=t||"collapsed";e.closest(".expand-collapse").toggleClass("expand collapse"),e.closest(".is-collapsible, .window").toggleClass(i),e.closest(".is-collapsible").children("article").slideToggle()},r=function(){e(".ui-loading").show()},l=function(){e(".ui-loading").hide()},c=function(e,t,i,s,a){return new o.Warning({title:e,message:t,actions:{primary:{text:i,click:function(e){e.hide(),s()}},secondary:{text:n("Cancel"),click:function(e){return a&&a(),e.hide()}}}}).show()},d=function(e,t){var i;return i=new s.Mini({title:n(e)}),i.show(),t().done(function(){i.hide()})},u=function(t){return function(i){var n=this;h(e(i.currentTarget),function(){return n[t].apply(n,[i])})}},h=function(e,t){return e.addClass("is-disabled").attr("aria-disabled",!0),t().always(function(){e.removeClass("is-disabled").attr("aria-disabled",!1)})},b=function(t){return function(i){i.preventDefault(),e.ajax({url:e(this).data("dismiss-link"),type:"DELETE",success:t})}},g=function(t){e("html, body").animate({scrollTop:t},500)},p=function(t){var i=t.offset().top;return i-e(window).scrollTop()},f=function(e,t){var i=e.offset().top,n=i-t;g(n)},m=function(e){window.location=e},v=function(){window.location.reload()},y=function(e,t){var n,s=e.changedAttributes();if(!s)return!1;for(n=0;n<t.length;n++)if(i.has(s,t[n]))return!0;return!1},w=function(e){return 0===e.length?n("Required field."):""},_=function(e,t){var i=w(e);if(i)return i;if(t){if(/\s/g.test(e))return n("Please do not use any spaces in this field.")}else if(e!==encodeURIComponent(e)||e.match(/[!'()*]/))return n("Please do not use any spaces or special characters in this field.");return""},x=function(t){var n=i.reduce(t,function(t,i){return t+e(i).val().length},0);return C>=n},k=function(t,n,s,o){x(s)?e(t.errorWrapper).removeClass(n.shown).addClass(n.hiding):(e(t.errorWrapper).addClass(n.shown).removeClass(n.hiding),e(t.errorMessage).html("<p>"+i.template(o)({limit:C})+"</p>"),e(t.save).addClass(n.disabled))},S=function(i){var n=e.Deferred();return t([i],function(){n.resolve()},function(){n.reject()}),n.promise()},{toggleExpandCollapse:a,showLoadingIndicator:r,hideLoadingIndicator:l,confirmThenRunOperation:c,runOperationShowingMessage:d,withDisabledElement:u,disableElementWhileRunning:h,deleteNotificationHandler:b,setScrollTop:g,getScrollOffset:p,setScrollOffset:f,redirect:m,reload:v,hasChangedAttributes:y,validateRequiredField:w,validateURLItemEncoding:_,validateTotalKeyLength:x,checkTotalKeyLengthViolations:k,loadJavaScript:S}})}.call(this,define||RequireJS.define,require||RequireJS.require),define("js/views/baseview",["jquery","underscore","backbone","gettext","js/utils/handle_iframe_binding","js/utils/templates","common/js/components/utils/view_utils"],function(e,t,i,n,s,o,a){var r=i.View.extend({events:{"click .ui-toggle-expansion":"toggleExpandCollapse"},options:{collapsedClass:"collapsed"},constructor:function(e){t.bindAll(this,"beforeRender","render","afterRender"),this.options&&(e=t.extend({},t.result(this,"options"),e)),Math.trunc||(Math.trunc=function(e){return e=+e,e-e%1||(isFinite(e)&&0!==e?0>e?-0:0:e)}),this.options=e;var n=this;this.render=t.wrap(this.render,function(e,t){return n.beforeRender(),e(t),n.afterRender(),n}),i.View.prototype.constructor.apply(this,arguments)},beforeRender:function(){},render:function(){return this},afterRender:function(){s.iframeBinding(this)},toggleExpandCollapse:function(t){var i=e(t.target);t.stopPropagation(),t.preventDefault(),a.toggleExpandCollapse(i,this.options.collapsedClass)},loadTemplate:function(e){return o.loadTemplate(e)}});return r}),define("js/views/pages/base_page",["jquery","js/views/baseview"],function(e,t){var i=t.extend({initialize:function(){t.prototype.initialize.call(this)},hasContent:function(){return!0},renderPage:function(){return e.Deferred().resolve().promise()},render:function(){var e=this;return this.$(".ui-loading").removeClass("is-hidden"),this.renderPage().done(function(){e.hasContent()||e.$(".no-content").removeClass("is-hidden")}).always(function(){e.$(".ui-loading").addClass("is-hidden")}),this}});return i}),define("js/views/list",["js/views/baseview"],function(e){"use strict";var t=e.extend({events:{"click .action-add":"onAddItem","click .new-button":"onAddItem"},listContainerCss:".list-items",initialize:function(){this.restrictEditing=this.options.restrictEditing||!1,this.listenTo(this.collection,"add",this.addNewItemView),this.listenTo(this.collection,"remove",this.onRemoveItem),this.template=this.loadTemplate("list"),this.listenTo(this.collection,"change:editing",this.toggleAddButton),this.listenTo(this.collection,"add",this.toggleAddButton),this.listenTo(this.collection,"remove",this.toggleAddButton)},render:function(e){return this.$el.html(this.template({itemCategoryDisplayName:this.itemCategoryDisplayName,newItemMessage:this.newItemMessage,emptyMessage:this.emptyMessage,length:this.collection.length,isEditing:e&&e.get("editing"),canCreateNewItem:this.canCreateItem(this.collection),restrictEditing:this.restrictEditing})),this.collection.each(function(e){this.$(this.listContainerCss).append(this.createItemView({model:e,restrictEditing:this.restrictEditing}).render().el)},this),this},hideOrShowAddButton:function(e){var t=".action-add";this.collection.length&&(e?this.$(t).removeClass("is-hidden"):this.$(t).addClass("is-hidden"))},toggleAddButton:function(e){e.get("editing")&&this.collection.contains(e)?this.hideOrShowAddButton(!1):this.hideOrShowAddButton(!0)},addNewItemView:function(e){var t=this.createItemView({model:e});this.collection.length>1?this.$(this.listContainerCss).append(t.render().el):this.render(),t.$el.focus()},canCreateItem:function(e){var t=!0;if(e.length>0){var i=e.maxAllowed;!_.isUndefined(i)&&e.length>=i&&(t=!1)}return t},onAddItem:function(e){e&&e.preventDefault&&e.preventDefault(),this.collection.add({editing:!0},this.newModelOptions)},onRemoveItem:function(){0===this.collection.length&&this.render()}});return t}),define("js/views/list_item",["js/views/baseview","jquery","gettext","common/js/components/utils/view_utils"],function(e,t,i,n){"use strict";var s=e.extend({canDelete:!1,initialize:function(){this.restrictEditing=this.options.restrictEditing||!1,this.listenTo(this.model,"change:editing",this.render),this.listenTo(this.model,"remove",this.remove)},className:function(){var e=this.model.collection.indexOf(this.model);return["wrapper-collection","wrapper-collection-"+e,this.baseClassName,this.baseClassName+"s-list-item",this.baseClassName+"s-list-item-"+e].join(" ")},deleteItem:function(e){if(e&&e.preventDefault&&e.preventDefault(),this.canDelete){var t=this.model,s=this.itemDisplayName;n.confirmThenRunOperation(interpolate(i("Delete this %(item_display_name)s?"),{item_display_name:s},!0),interpolate(i("Deleting this %(item_display_name)s is permanent and cannot be undone."),{item_display_name:s},!0),i("Delete"),function(){return n.runOperationShowingMessage(i("Deleting"),function(){return t.destroy({wait:!0})})})}},render:function(){return this.view&&this.view.remove(),this.model.get("editing")?this.view=this.createEditView():this.view=this.createDetailsView(),this.$el.html(this.view.render().el),this}});return s}),define("js/models/uploads",["backbone","underscore","gettext"],function(e,t,i){var n=e.Model.extend({defaults:{title:"",message:"",selectedFile:null,uploading:!1,uploadedBytes:0,totalBytes:0,finished:!1,mimeTypes:[],fileFormats:[]},validate:function(e,n){return e.selectedFile&&!this.checkTypeValidity(e.selectedFile)?{message:t.template(i("Only <%= fileTypes %> files can be uploaded. Please select a file ending in <%= fileExtensions %> to upload."))(this.formatValidTypes()),attributes:{selectedFile:!0}}:void 0},fileTypes:function(){var e=t.map(this.attributes.mimeTypes,function(e){return e.split("/")[1].toUpperCase()}),i=t.map(this.attributes.fileFormats,function(e){return e.toUpperCase()});return e.concat(i)},checkTypeValidity:function(e){var i=this.attributes,n=function(e){return RegExp("(?:.+)\\.("+e.join("|")+")$","i")};return 0===i.mimeTypes.length&&0===i.fileFormats.length||t.contains(i.mimeTypes,e.type)||n(i.fileFormats).test(e.name)},formatValidTypes:function(){var e=this.attributes;if(1===e.mimeTypes.concat(e.fileFormats).length)return{fileTypes:this.fileTypes()[0],fileExtensions:"."+this.fileTypes()[0].toLowerCase()};var n=i("or"),s=function(e){return t.template("<%= initial %> <%= or %> <%= last %>")({initial:t.initial(e).join(", "),or:n,last:t.last(e)})};return{fileTypes:s(this.fileTypes()),fileExtensions:s(t.map(this.fileTypes(),function(e){return"."+e.toLowerCase()}))}}});return n}),define("js/views/modals/base_modal",["jquery","underscore","gettext","js/views/baseview"],function(e,t,i,n){var s=n.extend({events:{"click .action-cancel":"cancel"},options:t.extend({},n.prototype.options,{type:"prompt",closeIcon:!1,icon:!1,modalName:"basic",modalType:"generic",modalSize:"lg",title:"",modalWindowClass:".modal-window",viewSpecificClasses:"",addPrimaryActionButton:!1,primaryActionButtonType:"save",primaryActionButtonTitle:i("Save"),showEditorModeButtons:!0}),initialize:function(){var t=this.options.parent,i=this.options.parentElement;this.modalTemplate=this.loadTemplate("basic-modal"),this.buttonTemplate=this.loadTemplate("modal-button"),t?i=t.$el:i||(i=this.$el.closest(this.options.modalWindowClass),0===i.length&&(i=e("body"))),this.parentElement=i},render:function(){this.$el.html(this.modalTemplate({name:this.options.modalName,type:this.options.modalType,size:this.options.modalSize,title:this.getTitle(),modalSRTitle:this.options.modalSRTitle,showEditorModeButtons:this.options.showEditorModeButtons,viewSpecificClasses:this.options.viewSpecificClasses})),this.addActionButtons(),this.renderContents(),this.parentElement.append(this.$el)},getTitle:function(){return this.options.title},renderContents:function(){var e=this.getContentHtml();this.$(".modal-content").html(e)},getContentHtml:function(){return""},show:function(i){var n=void 0===i;this.render(),this.resize(),e(window).resize(t.bind(this.resize,this)),n&&this.$el.find(this.options.modalWindowClass).focus()},hide:function(){this.undelegateEvents(),this.$el.html("")},cancel:function(e){e&&(e.preventDefault(),e.stopPropagation()),this.hide()},addActionButtons:function(){this.options.addPrimaryActionButton&&this.addActionButton(this.options.primaryActionButtonType,this.options.primaryActionButtonTitle,!0),this.addActionButton("cancel",i("Cancel"))},addActionButton:function(e,t,i){var n=this.buttonTemplate({type:e,name:t,isPrimary:i});this.getActionBar().find("ul").append(n)},getActionBar:function(){return this.$(this.options.modalWindowClass+" > div > .modal-actions")},getActionButton:function(e){return this.getActionBar().find(".action-"+e)},enableActionButton:function(e){this.getActionBar().find(".action-"+e).prop("disabled",!1).removeClass("is-disabled")},disableActionButton:function(e){this.getActionBar().find(".action-"+e).prop("disabled",!0).addClass("is-disabled")},resize:function(){var t,i,n,s,o,a,r,l,c;n=this.$el.find(this.options.modalWindowClass),a=e(window).width(),r=e(window).height(),l=.8*a,c=.8*r,s=Math.min(n.outerWidth(),l),o=Math.min(n.outerHeight(),c),i=(a-s)/2,t=(r-o)/2,n.css({top:t+e(window).scrollTop(),left:i+e(window).scrollLeft()})}});return s}),function(e){"use strict";function t(t){var i=t.data;t.isDefaultPrevented()||(t.preventDefault(),e(this).ajaxSubmit(i))}function i(t){var i=t.target,n=e(i);if(!n.is(":submit,input:image")){var s=n.closest(":submit");if(0===s.length)return;i=s[0]}var o=this;if(o.clk=i,"image"==i.type)if(void 0!==t.offsetX)o.clk_x=t.offsetX,o.clk_y=t.offsetY;else if("function"==typeof e.fn.offset){var a=n.offset();o.clk_x=t.pageX-a.left,o.clk_y=t.pageY-a.top}else o.clk_x=t.pageX-i.offsetLeft,o.clk_y=t.pageY-i.offsetTop;setTimeout(function(){o.clk=o.clk_x=o.clk_y=null},100)}function n(){if(e.fn.ajaxSubmit.debug){var t="[jquery.form] "+Array.prototype.join.call(arguments,"");window.console&&window.console.log?window.console.log(t):window.opera&&window.opera.postError&&window.opera.postError(t)}}var s={};s.fileapi=void 0!==e("<input type='file'/>").get(0).files,s.formdata=void 0!==window.FormData,e.fn.ajaxSubmit=function(t){function i(t){var i,n,s=e.param(t).split("&"),o=s.length,a={};for(i=0;o>i;i++)n=s[i].split("="),a[decodeURIComponent(n[0])]=decodeURIComponent(n[1]);return a}function o(n){for(var s=new FormData,o=0;o<n.length;o++)s.append(n[o].name,n[o].value);if(t.extraData){var a=i(t.extraData);for(var l in a)a.hasOwnProperty(l)&&s.append(l,a[l])}t.data=null;var c=e.extend(!0,{},e.ajaxSettings,t,{contentType:!1,processData:!1,cache:!1,type:r||"POST"});t.uploadProgress&&(c.xhr=function(){var e=jQuery.ajaxSettings.xhr();return e.upload&&(e.upload.onprogress=function(e){var i=0,n=e.loaded||e.position,s=e.total;e.lengthComputable&&(i=Math.ceil(n/s*100)),t.uploadProgress(e,n,s,i)}),e}),c.data=null;var d=c.beforeSend;return c.beforeSend=function(e,t){t.data=s,d&&d.call(this,e,t)},e.ajax(c)}function a(i){function s(e){var t=e.contentWindow?e.contentWindow.document:e.contentDocument?e.contentDocument:e.document;return t}function o(){function t(){try{var e=s(m).readyState;n("state = "+e),e&&"uninitialized"==e.toLowerCase()&&setTimeout(t,50)}catch(i){n("Server abort: ",i," (",i.name,")"),a(R),_&&clearTimeout(_),_=void 0}}var i=d.attr("target"),o=d.attr("action");x.setAttribute("target",p),r||x.setAttribute("method","POST"),o!=u.url&&x.setAttribute("action",u.url),u.skipEncodingOverride||r&&!/post/i.test(r)||d.attr({encoding:"multipart/form-data",enctype:"multipart/form-data"}),u.timeout&&(_=setTimeout(function(){w=!0,a(C)},u.timeout));var l=[];try{if(u.extraData)for(var c in u.extraData)u.extraData.hasOwnProperty(c)&&(e.isPlainObject(u.extraData[c])&&u.extraData[c].hasOwnProperty("name")&&u.extraData[c].hasOwnProperty("value")?l.push(e('<input type="hidden" name="'+u.extraData[c].name+'">').attr("value",u.extraData[c].value).appendTo(x)[0]):l.push(e('<input type="hidden" name="'+c+'">').attr("value",u.extraData[c]).appendTo(x)[0]));u.iframeTarget||(g.appendTo("body"),m.attachEvent?m.attachEvent("onload",a):m.addEventListener("load",a,!1)),setTimeout(t,15),x.submit()}finally{x.setAttribute("action",o),i?x.setAttribute("target",i):d.removeAttr("target"),e(l).remove()}}function a(t){if(!v.aborted&&!E){try{A=s(m)}catch(i){n("cannot access response document: ",i),t=R}if(t===C&&v)return v.abort("timeout"),void S.reject(v,"timeout");if(t==R&&v)return v.abort("server abort"),void S.reject(v,"error","server abort");if(A&&A.location.href!=u.iframeSrc||w){m.detachEvent?m.detachEvent("onload",a):m.removeEventListener("load",a,!1);var o,r="success";try{if(w)throw"timeout";var l="xml"==u.dataType||A.XMLDocument||e.isXMLDoc(A);if(n("isXml="+l),!l&&window.opera&&(null===A.body||!A.body.innerHTML)&&--D)return n("requeing onLoad callback, DOM not available"),void setTimeout(a,250);var c=A.body?A.body:A.documentElement;v.responseText=c?c.innerHTML:null,v.responseXML=A.XMLDocument?A.XMLDocument:A,l&&(u.dataType="xml"),v.getResponseHeader=function(e){var t={"content-type":u.dataType};return t[e]},c&&(v.status=Number(c.getAttribute("status"))||v.status,v.statusText=c.getAttribute("statusText")||v.statusText);var d=(u.dataType||"").toLowerCase(),p=/(json|script|text)/.test(d);if(p||u.textarea){var f=A.getElementsByTagName("textarea")[0];if(f)v.responseText=f.value,v.status=Number(f.getAttribute("status"))||v.status,v.statusText=f.getAttribute("statusText")||v.statusText;else if(p){var y=A.getElementsByTagName("pre")[0],b=A.getElementsByTagName("body")[0];y?v.responseText=y.textContent?y.textContent:y.innerText:b&&(v.responseText=b.textContent?b.textContent:b.innerText)}}else"xml"==d&&!v.responseXML&&v.responseText&&(v.responseXML=O(v.responseText));try{j=I(v,d,u)}catch(t){r="parsererror",v.error=o=t||r}}catch(t){n("error caught: ",t),r="error",v.error=o=t||r}v.aborted&&(n("upload aborted"),r=null),v.status&&(r=v.status>=200&&v.status<300||304===v.status?"success":"error"),"success"===r?(u.success&&u.success.call(u.context,j,"success",v),
S.resolve(v.responseText,"success",v),h&&e.event.trigger("ajaxSuccess",[v,u])):r&&(void 0===o&&(o=v.statusText),u.error&&u.error.call(u.context,v,r,o),S.reject(v,"error",o),h&&e.event.trigger("ajaxError",[v,u,o])),h&&e.event.trigger("ajaxComplete",[v,u]),h&&!--e.active&&e.event.trigger("ajaxStop"),u.complete&&u.complete.call(u.context,v,r),E=!0,u.timeout&&clearTimeout(_),setTimeout(function(){u.iframeTarget||g.remove(),v.responseXML=null},100)}}}var l,c,u,h,p,g,m,v,y,b,w,_,x=d[0],k=!!e.fn.prop,S=e.Deferred();if(e(":input[name=submit],:input[id=submit]",x).length)return alert('Error: Form elements must not have name or id of "submit".'),S.reject(),S;if(i)for(c=0;c<f.length;c++)l=e(f[c]),k?l.prop("disabled",!1):l.removeAttr("disabled");if(u=e.extend(!0,{},e.ajaxSettings,t),u.context=u.context||u,p="jqFormIO"+(new Date).getTime(),u.iframeTarget?(g=e(u.iframeTarget),b=g.attr("name"),b?p=b:g.attr("name",p)):(g=e('<iframe name="'+p+'" src="'+u.iframeSrc+'" />'),g.css({position:"absolute",top:"-1000px",left:"-1000px"})),m=g[0],v={aborted:0,responseText:null,responseXML:null,status:0,statusText:"n/a",getAllResponseHeaders:function(){},getResponseHeader:function(){},setRequestHeader:function(){},abort:function(t){var i="timeout"===t?"timeout":"aborted";if(n("aborting upload... "+i),this.aborted=1,m.contentWindow.document.execCommand)try{m.contentWindow.document.execCommand("Stop")}catch(s){}g.attr("src",u.iframeSrc),v.error=i,u.error&&u.error.call(u.context,v,i,t),h&&e.event.trigger("ajaxError",[v,u,i]),u.complete&&u.complete.call(u.context,v,i)}},h=u.global,h&&0===e.active++&&e.event.trigger("ajaxStart"),h&&e.event.trigger("ajaxSend",[v,u]),u.beforeSend&&u.beforeSend.call(u.context,v,u)===!1)return u.global&&e.active--,S.reject(),S;if(v.aborted)return S.reject(),S;y=x.clk,y&&(b=y.name,b&&!y.disabled&&(u.extraData=u.extraData||{},u.extraData[b]=y.value,"image"==y.type&&(u.extraData[b+".x"]=x.clk_x,u.extraData[b+".y"]=x.clk_y)));var C=1,R=2,T=e("meta[name=csrf-token]").attr("content"),M=e("meta[name=csrf-param]").attr("content");M&&T&&(u.extraData=u.extraData||{},u.extraData[M]=T),u.forceSync?o():setTimeout(o,10);var j,A,E,D=50,O=e.parseXML||function(e,t){return window.ActiveXObject?(t=new ActiveXObject("Microsoft.XMLDOM"),t.async="false",t.loadXML(e)):t=(new DOMParser).parseFromString(e,"text/xml"),t&&t.documentElement&&"parsererror"!=t.documentElement.nodeName?t:null},N=e.parseJSON||function(e){return window.eval("("+e+")")},I=function(t,i,n){var s=t.getResponseHeader("content-type")||"",o="xml"===i||!i&&s.indexOf("xml")>=0,a=o?t.responseXML:t.responseText;return o&&"parsererror"===a.documentElement.nodeName&&e.error&&e.error("parsererror"),n&&n.dataFilter&&(a=n.dataFilter(a,i)),"string"==typeof a&&("json"===i||!i&&s.indexOf("json")>=0?a=N(a):("script"===i||!i&&s.indexOf("javascript")>=0)&&e.globalEval(a)),a};return S}if(!this.length)return n("ajaxSubmit: skipping submit process - no element selected"),this;var r,l,c,d=this;"function"==typeof t&&(t={success:t}),r=this.attr("method"),l=this.attr("action"),c="string"==typeof l?e.trim(l):"",c=c||window.location.href||"",c&&(c=(c.match(/^([^#]+)/)||[])[1]),t=e.extend(!0,{url:c,success:e.ajaxSettings.success,type:r||"GET",iframeSrc:/^https/i.test(window.location.href||"")?"javascript:false":"about:blank"},t);var u={};if(this.trigger("form-pre-serialize",[this,t,u]),u.veto)return n("ajaxSubmit: submit vetoed via form-pre-serialize trigger"),this;if(t.beforeSerialize&&t.beforeSerialize(this,t)===!1)return n("ajaxSubmit: submit aborted via beforeSerialize callback"),this;var h=t.traditional;void 0===h&&(h=e.ajaxSettings.traditional);var p,f=[],g=this.formToArray(t.semantic,f);if(t.data&&(t.extraData=t.data,p=e.param(t.data,h)),t.beforeSubmit&&t.beforeSubmit(g,this,t)===!1)return n("ajaxSubmit: submit aborted via beforeSubmit callback"),this;if(this.trigger("form-submit-validate",[g,this,t,u]),u.veto)return n("ajaxSubmit: submit vetoed via form-submit-validate trigger"),this;var m=e.param(g,h);p&&(m=m?m+"&"+p:p),"GET"==t.type.toUpperCase()?(t.url+=(t.url.indexOf("?")>=0?"&":"?")+m,t.data=null):t.data=m;var v=[];if(t.resetForm&&v.push(function(){d.resetForm()}),t.clearForm&&v.push(function(){d.clearForm(t.includeHidden)}),!t.dataType&&t.target){var y=t.success||function(){};v.push(function(i){var n=t.replaceTarget?"replaceWith":"html";e(t.target)[n](i).each(y,arguments)})}else t.success&&v.push(t.success);t.success=function(e,i,n){for(var s=t.context||this,o=0,a=v.length;a>o;o++)v[o].apply(s,[e,i,n||d,d])};var b=e("input:file:enabled[value]",this),w=b.length>0,_="multipart/form-data",x=d.attr("enctype")==_||d.attr("encoding")==_,k=s.fileapi&&s.formdata;n("fileAPI :"+k);var S,C=(w||x)&&!k;t.iframe!==!1&&(t.iframe||C)?t.closeKeepAlive?e.get(t.closeKeepAlive,function(){S=a(g)}):S=a(g):S=(w||x)&&k?o(g):e.ajax(t),d.removeData("jqxhr").data("jqxhr",S);for(var R=0;R<f.length;R++)f[R]=null;return this.trigger("form-submit-notify",[this,t]),this},e.fn.ajaxForm=function(s){if(s=s||{},s.delegation=s.delegation&&e.isFunction(e.fn.on),!s.delegation&&0===this.length){var o={s:this.selector,c:this.context};return!e.isReady&&o.s?(n("DOM not ready, queuing ajaxForm"),e(function(){e(o.s,o.c).ajaxForm(s)}),this):(n("terminating; zero elements found by selector"+(e.isReady?"":" (DOM not ready)")),this)}return s.delegation?(e(document).off("submit.form-plugin",this.selector,t).off("click.form-plugin",this.selector,i).on("submit.form-plugin",this.selector,s,t).on("click.form-plugin",this.selector,s,i),this):this.ajaxFormUnbind().bind("submit.form-plugin",s,t).bind("click.form-plugin",s,i)},e.fn.ajaxFormUnbind=function(){return this.unbind("submit.form-plugin click.form-plugin")},e.fn.formToArray=function(t,i){var n=[];if(0===this.length)return n;var o=this[0],a=t?o.getElementsByTagName("*"):o.elements;if(!a)return n;var r,l,c,d,u,h,p;for(r=0,h=a.length;h>r;r++)if(u=a[r],c=u.name)if(t&&o.clk&&"image"==u.type)u.disabled||o.clk!=u||(n.push({name:c,value:e(u).val(),type:u.type}),n.push({name:c+".x",value:o.clk_x},{name:c+".y",value:o.clk_y}));else if(d=e.fieldValue(u,!0),d&&d.constructor==Array)for(i&&i.push(u),l=0,p=d.length;p>l;l++)n.push({name:c,value:d[l]});else if(s.fileapi&&"file"==u.type&&!u.disabled){i&&i.push(u);var f=u.files;if(f.length)for(l=0;l<f.length;l++)n.push({name:c,value:f[l],type:u.type});else n.push({name:c,value:"",type:u.type})}else null!==d&&"undefined"!=typeof d&&(i&&i.push(u),n.push({name:c,value:d,type:u.type,required:u.required}));if(!t&&o.clk){var g=e(o.clk),m=g[0];c=m.name,c&&!m.disabled&&"image"==m.type&&(n.push({name:c,value:g.val()}),n.push({name:c+".x",value:o.clk_x},{name:c+".y",value:o.clk_y}))}return n},e.fn.formSerialize=function(t){return e.param(this.formToArray(t))},e.fn.fieldSerialize=function(t){var i=[];return this.each(function(){var n=this.name;if(n){var s=e.fieldValue(this,t);if(s&&s.constructor==Array)for(var o=0,a=s.length;a>o;o++)i.push({name:n,value:s[o]});else null!==s&&"undefined"!=typeof s&&i.push({name:this.name,value:s})}}),e.param(i)},e.fn.fieldValue=function(t){for(var i=[],n=0,s=this.length;s>n;n++){var o=this[n],a=e.fieldValue(o,t);null===a||"undefined"==typeof a||a.constructor==Array&&!a.length||(a.constructor==Array?e.merge(i,a):i.push(a))}return i},e.fieldValue=function(t,i){var n=t.name,s=t.type,o=t.tagName.toLowerCase();if(void 0===i&&(i=!0),i&&(!n||t.disabled||"reset"==s||"button"==s||("checkbox"==s||"radio"==s)&&!t.checked||("submit"==s||"image"==s)&&t.form&&t.form.clk!=t||"select"==o&&-1==t.selectedIndex))return null;if("select"==o){var a=t.selectedIndex;if(0>a)return null;for(var r=[],l=t.options,c="select-one"==s,d=c?a+1:l.length,u=c?a:0;d>u;u++){var h=l[u];if(h.selected){var p=h.value;if(p||(p=h.attributes&&h.attributes.value&&!h.attributes.value.specified?h.text:h.value),c)return p;r.push(p)}}return r}return e(t).val()},e.fn.clearForm=function(t){return this.each(function(){e("input,select,textarea",this).clearFields(t)})},e.fn.clearFields=e.fn.clearInputs=function(t){var i=/^(?:color|date|datetime|email|month|number|password|range|search|tel|text|time|url|week)$/i;return this.each(function(){var n=this.type,s=this.tagName.toLowerCase();i.test(n)||"textarea"==s?this.value="":"checkbox"==n||"radio"==n?this.checked=!1:"select"==s?this.selectedIndex=-1:t&&(t===!0&&/hidden/.test(n)||"string"==typeof t&&e(this).is(t))&&(this.value="")})},e.fn.resetForm=function(){return this.each(function(){("function"==typeof this.reset||"object"==typeof this.reset&&!this.reset.nodeType)&&this.reset()})},e.fn.enable=function(e){return void 0===e&&(e=!0),this.each(function(){this.disabled=!e})},e.fn.selected=function(t){return void 0===t&&(t=!0),this.each(function(){var i=this.type;if("checkbox"==i||"radio"==i)this.checked=t;else if("option"==this.tagName.toLowerCase()){var n=e(this).parent("select");t&&n[0]&&"select-one"==n[0].type&&n.find("option").selected(!1),this.selected=t}})},e.fn.ajaxSubmit.debug=!1}(jQuery),define("jquery.form",["jquery"],function(e){return function(){var t;return t||e.jQuery.fn.ajaxForm}}(this)),define("js/views/uploads",["jquery","underscore","gettext","js/views/modals/base_modal","jquery.form"],function(e,t,i,n){var s=n.extend({events:t.extend({},n.prototype.events,{"change input[type=file]":"selectFile","click .action-upload":"upload"}),options:e.extend({},n.prototype.options,{modalName:"assetupload",modalSize:"med",successMessageTimeout:2e3,viewSpecificClasses:"confirm"}),initialize:function(e){n.prototype.initialize.call(this),this.template=this.loadTemplate("upload-dialog"),this.listenTo(this.model,"change",this.renderContents),this.options.title=this.model.get("title"),this.uploadData=t.extend({},e.uploadData)},addActionButtons:function(){this.addActionButton("upload",i("Upload"),!0),n.prototype.addActionButtons.call(this)},renderContents:function(){var t=this.model.isValid(),i=this.model.get("selectedFile"),s=this.$("input[type=file]").get(0);return n.prototype.renderContents.call(this),i&&t?(e(s).removeClass("error"),this.$("input[type=file]").replaceWith(s),this.$(".action-upload").removeClass("disabled")):this.$(".action-upload").addClass("disabled"),this},getContentHtml:function(){return this.template({url:this.options.url||CMS.URL.UPLOAD_ASSET,message:this.model.escape("message"),selectedFile:this.model.get("selectedFile"),uploading:this.model.get("uploading"),uploadedBytes:this.model.get("uploadedBytes"),totalBytes:this.model.get("totalBytes"),finished:this.model.get("finished"),error:this.model.validationError})},selectFile:function(t){var i=t.target.files[0]||null;this.model.set({selectedFile:i}),i&&e.isEmptyObject(this.model.changed)&&this.model.trigger("change")},upload:function(e){var i=t.extend({},this.uploadData);i.notifyOnError=!1,e&&e.preventDefault&&e.preventDefault(),this.model.set("uploading",!0),this.$("form").ajaxSubmit({success:t.bind(this.success,this),error:t.bind(this.error,this),uploadProgress:t.bind(this.progress,this),data:i})},progress:function(e,t,i){this.model.set({uploadedBytes:t,totalBytes:i})},success:function(e,t,i,n){this.model.set({uploading:!1,finished:!0}),this.options.onSuccess&&this.options.onSuccess(e,t,i,n);var s=this;this.removalTimeout=setTimeout(function(){s.hide()},this.options.successMessageTimeout)},error:function(){this.model.set({uploading:!1,uploadedBytes:0,title:i("We're sorry, there was an error")})}});return s}),define("text!templates/signatory-editor.underscore",[],function(){return'     <div class="signatory-panel-default">\n       <% if (is_editing_all_collections && signatories_count > 1 && (total_saved_signatories > 1 || isNew) ) { %>\n       <a class="signatory-panel-delete" href="#" data-tooltip="Delete">\n          <span class="icon fa fa-trash-o" aria-hidden="true"></span>\n          <span class="sr action-button-text"><%- gettext("Delete") %></span>\n       </a>\n       <% } %>\n       <div class="signatory-panel-header"><%- gettext("Signatory") %> <%- signatory_number %></div>\n       <div class="signatory-panel-body">\n         <fieldset class="collection-fields signatory-fields">\n            <legend class="sr"><%- gettext("Certificate Signatory Configuration") %></legend>\n            <div class="input-wrap field text add-signatory-name <% if(error && error.name) { print(\'error\'); } %>">\n                <label for="signatory-name-<%- signatory_number %>"><%- gettext("Name ") %></label>\n                <input id="signatory-name-<%- signatory_number %>" class="collection-name-input input-text signatory-name-input" name="signatory-name" type="text" placeholder="<%- gettext("Name of the signatory") %>" value="<%- name %>"  aria-describedby="signatory-name-<%- signatory_number %>-tip" />\n                <span id="signatory-name-<%- signatory_number %>-tip" class="tip tip-stacked"><%- gettext("The name of this signatory as it should appear on certificates.") %></span>\n                <% if(error && error.name) { %>\n                  <span class="message-error"><%- error.name %></span>\n                <% } %>\n            </div>\n            <div class="input-wrap field text add-signatory-title <% if(error && error.title) { print(\'error\'); } %>">\n                <label for="signatory-title-<%- signatory_number %>"><%- gettext("Title ") %></label>\n                <textarea id="signatory-title-<%- signatory_number %>" class="collection-name-input text input-text signatory-title-input" name="signatory-title" placeholder="<%- gettext("Title of the signatory") %>"  aria-describedby="signatory-title-<%- signatory_number %>-tip" ><%- title %></textarea>\n                <span id="signatory-title-<%- signatory_number %>-tip" class="tip tip-stacked"><%- gettext("Titles more than 100 characters may prevent students from printing their certificate on a single page.") %></span>\n                <% if(error && error.title) { %>\n                  <span class="message-error"><%- error.title %></span>\n                <% } %>\n            </div>\n            <div class="input-wrap field text add-signatory-organization <% if(error && error.organization) { print(\'error\'); } %>">\n                <label for="signatory-organization-<%- signatory_number %>"><%- gettext("Organization ") %></label>\n                <input id="signatory-organization-<%- signatory_number %>" class="collection-name-input input-text signatory-organization-input" name="signatory-organization" type="text" placeholder="<%- gettext("Organization of the signatory") %>" value="<%- organization %>"  aria-describedby="signatory-organization-<%- signatory_number %>-tip" />\n                <span id="signatory-organization-<%- signatory_number %>-tip" class="tip tip-stacked"><%- gettext("The organization that this signatory belongs to, as it should appear on certificates.") %></span>\n                <% if(error && error.organization) { %>\n                  <span class="message-error"><%- error.organization %></span>\n                <% } %>\n            </div>\n            <div class="input-wrap field text add-signatory-signature">\n                <label for="signatory-signature-<%- signatory_number %>"><%- gettext("Signature Image") %></label>\n                <% if (signature_image_path != "") { %>\n                    <div class="current-signature-image"><span class="wrapper-signature-image"><img class="signature-image" src="<%- signature_image_path %>" alt="Signature Image"></span></div>\n                <% } %>\n                <div class="signature-upload-wrapper">\n                  <div class="signature-upload-input-wrapper">\n                    <input id="signatory-signature-<%- signatory_number %>" class="collection-name-input input-text signatory-signature-input" name="signatory-signature-url" type="text" placeholder="<%- gettext("Path to Signature Image") %>" value="<%- signature_image_path %>"  aria-describedby="signatory-signature-<%- signatory_number %>-tip" readonly />\n                    <span id="signatory-signature-<%- signatory_number %>-tip" class="tip tip-stacked"><%- gettext("Image must be in PNG format") %></span>\n                  </div>\n                  <button type="button" class="action action-upload-signature"><%- gettext("Upload Signature Image") %></button>\n                </div>\n            </div>\n         </fieldset>\n       </div>\n     </div>\n'}),define("js/certificates/views/signatory_editor",["jquery","underscore","backbone","gettext","js/utils/templates","common/js/components/utils/view_utils","common/js/components/views/feedback_prompt","common/js/components/views/feedback_notification","js/models/uploads","js/views/uploads","text!templates/signatory-editor.underscore"],function(e,t,i,n,s,o,a,r,l,c,d){"use strict";var u=i.View.extend({tagName:"div",events:{"change .signatory-name-input":"setSignatoryName","change .signatory-title-input":"setSignatoryTitle","change .signatory-organization-input":"setSignatoryOrganization","click  .signatory-panel-delete":"deleteItem","change .signatory-signature-input":"setSignatorySignatureImagePath","click .action-upload-signature":"uploadSignatureImage"},className:function(){var e=this.getModelIndex(this.model);return["signatory-edit","signatory-edit-view-"+e].join(" ")},initialize:function(e){t.bindAll(this,"render"),this.model.bind("change",this.render),this.eventAgg=e.eventAgg,this.isEditingAllCollections=e.isEditingAllCollections},getModelIndex:function(e){return this.model.collection.indexOf(e)},loadTemplate:function(e){return s.loadTemplate(e)},getTotalSignatoriesOnServer:function(){var e=0;return this.model.collection.each(function(t){t.isNew()||e++}),e},render:function(){var i=e.extend({modelIsValid:this.model.isValid(),error:this.model.validationError},this.model.attributes,{signatory_number:this.getModelIndex(this.model)+1,signatories_count:this.model.collection.length,isNew:this.model.isNew(),is_editing_all_collections:this.isEditingAllCollections,total_saved_signatories:this.getTotalSignatoriesOnServer()});return e(this.el).html(t.template(d)(i))},setSignatoryName:function(e){e&&e.preventDefault&&e.preventDefault(),this.model.set("name",this.$(".signatory-name-input").val(),{silent:!0}),this.toggleValidationErrorMessage("name"),this.eventAgg.trigger("onSignatoryUpdated",this.model)},setSignatoryTitle:function(e){e&&e.preventDefault&&e.preventDefault(),this.model.set("title",this.$(".signatory-title-input").val(),{silent:!0}),this.toggleValidationErrorMessage("title"),this.eventAgg.trigger("onSignatoryUpdated",this.model)},setSignatoryOrganization:function(e){e&&e.preventDefault&&e.preventDefault(),this.model.set("organization",this.$(".signatory-organization-input").val(),{silent:!0}),this.eventAgg.trigger("onSignatoryUpdated",this.model)},setSignatorySignatureImagePath:function(e){e&&e.preventDefault&&e.preventDefault(),this.model.set("signature_image_path",this.$(".signatory-signature-input").val(),{silent:!0})},deleteItem:function(e){e&&e.preventDefault&&e.preventDefault();var i=this.model,s=this,o=t.template(n('Delete "<%= signatoryName %>" from the list of signatories?')),l=new a.Warning({title:o({signatoryName:i.get("name")}),message:n("This action cannot be undone."),actions:{primary:{text:n("Delete"),click:function(){var e=new r.Mini({title:n("Deleting")});i.isNew()?(i.collection.remove(i),s.eventAgg.trigger("onSignatoryRemoved",i)):(e.show(),i.destroy({wait:!0,success:function(t){e.hide(),s.eventAgg.trigger("onSignatoryRemoved",t)}})),l.hide()}},secondary:{text:n("Cancel"),click:function(){l.hide()}}}});l.show()},uploadSignatureImage:function(e){e.preventDefault();var t=new l({title:n("Upload signature image."),message:n("Image must be in PNG format."),mimeTypes:["image/png"]}),i=this,s=new c({model:t,onSuccess:function(e){i.model.set("signature_image_path",e.asset.url)}});s.show()},toggleValidationErrorMessage:function(i){var n="div.add-signatory-"+i;if(!this.model.isValid()&&t.has(this.model.validationError,i)){if(!e(n).hasClass("error")){var s=this.model.validationError[i];e(n).addClass("error"),e(n).append("<span class='message-error'>"+s+"</span>")}}else e(n).removeClass("error"),e(n+">span.message-error").remove()}});return u}),define("text!templates/signatory-details.underscore",[],function(){return'<div class="signatory-panel-default">\n  <% if (CMS.User.isGlobalStaff || !certificate.get(\'is_active\')) { %>\n  <div class="actions certificate-actions signatory-panel-edit">\n    <span class="action action-edit-signatory">\n      <a href="javascript:void(0);" class="edit-signatory"><span class="icon fa fa-pencil" aria-hidden="true"></span> <%- gettext("Edit") %></a>\n    </span>\n  </div>\n  <% } %>\n  <div class="signatory-panel-header"><%- gettext("Signatory") %> <%- signatory_number %>&nbsp;</div>\n  <div class="signatory-panel-body">\n    <div>\n        <div>\n          <span class="signatory-name-label"><b><%- gettext("Name") %>:</b>&nbsp;</span>\n          <span class="signatory-name-value"><%- name %></span>\n        </div>\n        <div>\n          <span class="signatory-title-label"><b><%- gettext("Title") %>:</b>&nbsp;</span>\n          <span class="signatory-title-value"><%= _.escape(title).replace(new RegExp(\'\\r?\\n\',\'g\'), \'<br />\') %></span>\n        </div>\n        <div>\n          <span class="signatory-organization-label"><b><%- gettext("Organization") %>:</b>&nbsp;</span>\n          <span class="signatory-organization-value"><%- organization %></span>\n        </div>\n    </div>\n    <div class="signatory-image">\n      <% if (signature_image_path != "") { %>\n            <div class="wrapper-signature-image">\n                <img class="signature-image" src="<%- signature_image_path %>" alt="<%- gettext(\'Signature Image\') %>">\n            </div>\n      <% } %>\n    </div>\n  </div>\n</div>\n'}),define("text!templates/signatory-actions.underscore",[],function(){return'<div class="collection-edit">\n    <div class="actions custom-signatory-action">\n            <button class="signatory-panel-save action action-primary" type="submit"><%= gettext("Save") %></button>\n            <button class="signatory-panel-close action action-secondary action-cancel"><%= gettext("Cancel") %></button>\n    </div>\n</div>\n'}),define("js/certificates/views/signatory_details",["jquery","underscore","underscore.string","backbone","gettext","js/utils/templates","common/js/components/utils/view_utils","js/views/baseview","js/certificates/views/signatory_editor","text!templates/signatory-details.underscore","text!templates/signatory-actions.underscore"],function(e,t,i,n,s,o,a,r,l,c,d){"use strict";var u=r.extend({tagName:"div",events:{"click .edit-signatory":"editSignatory","click  .signatory-panel-save":"saveSignatoryData","click  .signatory-panel-close":"closeSignatoryEditView"},className:function(){var e=this.model.collection.indexOf(this.model);return["signatory-details","signatory-details-view-"+e].join(" ")},initialize:function(){this.eventAgg=t.extend({},n.Events),this.edit_view=new l({model:this.model,isEditingAllCollections:!1,eventAgg:this.eventAgg})},loadTemplate:function(e){return o.loadTemplate(e)},editSignatory:function(i){i&&i.preventDefault&&i.preventDefault(),this.$el.html(this.edit_view.render()),e(t.template(d)()).appendTo(this.el),this.edit_view.delegateEvents(),this.delegateEvents()},saveSignatoryData:function(t){t&&t.preventDefault&&t.preventDefault();var i=this.model.get("certificate");if(i.isValid()){var n=this;a.runOperationShowingMessage(s("Saving"),function(){var t=e.Deferred(),s=i;return s.save({},{success:function(){s.setOriginalAttributes(),t.resolve(),n.closeSignatoryEditView()}}),t})}},closeSignatoryEditView:function(e){e&&e.preventDefault&&e.preventDefault(),e&&this.model.reset(),this.render()},render:function(){var i=e.extend({},this.model.attributes,{signatory_number:this.model.collection.indexOf(this.model)+1});return e(this.el).html(t.template(c)(i))}});return u}),function(e){function t(e){return e.replace(/(:|\.)/g,"\\$1")}var i="1.4.10",n={exclude:[],excludeWithin:[],offset:0,direction:"top",scrollElement:null,scrollTarget:null,beforeScroll:function(){},afterScroll:function(){},easing:"swing",speed:400,autoCoefficent:2},s=function(t){var i=[],n=!1,s=t.dir&&"left"==t.dir?"scrollLeft":"scrollTop";return this.each(function(){if(this!=document&&this!=window){var t=e(this);t[s]()>0?i.push(this):(t[s](1),n=t[s]()>0,n&&i.push(this),t[s](0))}}),i.length||this.each(function(){"BODY"===this.nodeName&&(i=[this])}),"first"===t.el&&i.length>1&&(i=[i[0]]),i};e.fn.extend({scrollable:function(e){var t=s.call(this,{dir:e});return this.pushStack(t)},firstScrollable:function(e){var t=s.call(this,{el:"first",dir:e});return this.pushStack(t)},smoothScroll:function(i){i=i||{};var n=e.extend({},e.fn.smoothScroll.defaults,i),s=e.smoothScroll.filterPath(location.pathname);return this.unbind("click.smoothscroll").bind("click.smoothscroll",function(i){var o=this,a=e(this),r=n.exclude,l=n.excludeWithin,c=0,d=0,u=!0,h={},p=location.hostname===o.hostname||!o.hostname,f=n.scrollTarget||(e.smoothScroll.filterPath(o.pathname)||s)===s,g=t(o.hash);if(n.scrollTarget||p&&f&&g){for(;u&&r.length>c;)a.is(t(r[c++]))&&(u=!1);for(;u&&l.length>d;)a.closest(l[d++]).length&&(u=!1)}else u=!1;u&&(i.preventDefault(),e.extend(h,n,{scrollTarget:n.scrollTarget||g,link:o}),e.smoothScroll(h))}),this}}),e.smoothScroll=function(t,i){var n,s,o,a,r=0,l="offset",c="scrollTop",d={},u={};"number"==typeof t?(n=e.fn.smoothScroll.defaults,o=t):(n=e.extend({},e.fn.smoothScroll.defaults,t||{}),n.scrollElement&&(l="position","static"==n.scrollElement.css("position")&&n.scrollElement.css("position","relative"))),n=e.extend({link:null},n),c="left"==n.direction?"scrollLeft":c,n.scrollElement?(s=n.scrollElement,r=s[c]()):s=e("html, body").firstScrollable(),n.beforeScroll.call(s,n),o="number"==typeof t?t:i||e(n.scrollTarget)[l]()&&e(n.scrollTarget)[l]()[n.direction]||0,d[c]=o+r+n.offset,a=n.speed,"auto"===a&&(a=d[c]||s.scrollTop(),a/=n.autoCoefficent),u={duration:a,easing:n.easing,complete:function(){n.afterScroll.call(n.link,n)}},n.step&&(u.step=n.step),s.length?s.stop().animate(d,u):n.afterScroll.call(n.link,n)},e.smoothScroll.version=i,e.smoothScroll.filterPath=function(e){return e.replace(/^\//,"").replace(/(index|default).[a-zA-Z]{3,4}$/,"").replace(/\/$/,"")},e.fn.smoothScroll.defaults=n}(jQuery),define("jquery.smoothScroll",["jquery"],function(e){return function(){var t;return t||e.jQuery.fn.smoothScroll}}(this)),define("text!templates/certificate-details.underscore",[],function(){return'<div class="collection-details wrapper-certificate">\n    <header class="collection-header">\n        <h3 class="sr title">\n            <%- name %>\n        </h3>\n    </header>\n\n   <ol class="collection-info certificate-info certificate-info-<% if(showDetails){ print(\'block\'); } else { print(\'inline\'); } %>">\n     <% if (!_.isUndefined(id)) { %>\n         <li class="sr certificate-id">\n            <span class="certificate-label"><%- gettext(\'ID\') %>: </span>\n            <span class="certificate-value"><%- id %></span>\n        </li>\n     <% } %>\n     <% if (showDetails) { %>\n         <section class="certificate-settings course-details">\n             <header>\n               <h2 class="title title-2"><%- gettext("Certificate Details") %></h2>\n             </header>\n             <div class=\'certificate-info-section\'>\n                 <div class=\'course-title-section pull-left\'>\n                    <p class="actual-course-title">\n                            <span class="certificate-label"><%- gettext(\'Course Title\') %>: </span>\n                            <span class="certificate-value"><%- course.get(\'name\') %></span>\n                    </p>\n                    <% if (course_title) { %>\n                        <p class="course-title-override">\n                            <span class="certificate-label"><b><%- gettext(\'Course Title Override\') %>: </b></span>\n                            <span class="certificate-value"><%- course_title %></span>\n                        </p>\n                    <% } %>\n                 </div>\n\n                <div class=\'course-number-section pull-left\'>\n                    <p class="actual-course-number">\n                            <span class="certificate-label"><b><%- gettext(\'Course Number\') %>: </b> </span>\n                            <span class="certificate-value"><%- course.get(\'num\') %></span>\n                    </p>\n\n                    <% if (course.get(\'display_course_number\')) { %>\n                        <p class="course-number-override">\n                            <span class="certificate-label"><b><%- gettext(\'Course Number Override\') %>: </b></span>\n                            <span class="certificate-value"><%- course.get(\'display_course_number\') %></span>\n                        </p>\n                    <% } %>\n                </div>\n            </div>\n        </section>\n\n\n        <section class="certificate-settings signatories">\n             <header>\n               <h2 class="title title-2"><%- gettext("Certificate Signatories") %></h2>\n             </header>\n             <p class="instructions"><%- gettext("It is strongly recommended that you include four or fewer signatories. If you include additional signatories, preview the certificate in Print View to ensure the certificate will print correctly on one page.") %></p>\n             <div class="signatory-details-list"></div>\n        </section>\n    <% } %>\n   </ol>\n\n    <ul class="actions certificate-actions">\n        <% if (CMS.User.isGlobalStaff || !is_active) { %>\n        <li class="action action-edit">\n            <button class="edit"><span class="icon fa fa-pencil" aria-hidden="true"></span> <%- gettext("Edit") %></button>\n        </li>\n        <li class="action action-delete wrapper-delete-button" data-tooltip="<%- gettext(\'Delete\') %>">\n            <button class="delete action-icon" title="<%- gettext(\'Delete\') %>"><span class="icon fa fa-trash-o" aria-hidden="true"></span></button>\n        </li>\n        <% } %>\n    </ul>\n</div>\n'}),define("js/certificates/views/certificate_details",["jquery","underscore","underscore.string","gettext","js/views/baseview","js/certificates/models/signatory","js/certificates/views/signatory_details","common/js/components/utils/view_utils","jquery.smoothScroll","text!templates/certificate-details.underscore"],function(e,t,i,n,s,o,a,r,l,c){"use strict";var d=s.extend({tagName:"div",events:{"click .edit":"editCertificate"},className:function(){return["collection","certificates","certificate-details"].join(" ")},initialize:function(){this.showDetails=!0,this.listenTo(this.model,"change",this.render)},editCertificate:function(e){e&&e.preventDefault&&e.preventDefault();var t=this;this.model.get("is_active")===!0?r.confirmThenRunOperation(n("Edit this certificate?"),n("This certificate has already been activated and is live. Are you sure you want to continue editing?"),n("Yes, allow edits to the active Certificate"),function(){return t.model.set("editing",!0)}):this.model.set("editing",!0)},render:function(i){var n=e.extend({},this.model.attributes,{index:this.model.collection.indexOf(this.model),showDetails:this.showDetails||i||!1});if(this.$el.html(t.template(c)(n)),this.showDetails||i){var s=this;this.model.get("signatories").each(function(t){var i=new a({model:t});s.$("div.signatory-details-list").append(e(i.render().$el))})}return this.model.collection.length>0&&window.certWebPreview&&window.certWebPreview.show(),e.smoothScroll({offset:0,easing:"swing",speed:1e3}),this}});return d}),define("js/views/list_item_editor",["js/views/baseview","common/js/components/utils/view_utils","underscore","gettext"],function(e,t,i,n){"use strict";var s=e.extend({initialize:function(){this.listenTo(this.model,"invalid",this.render),this.listenTo(this.getSaveableModel(),"invalid",this.render)},render:function(){this.$el.html(this.template(i.extend({error:this.model.validationError||this.getSaveableModel().validationError
},this.getTemplateOptions())))},setAndClose:function(e){return e&&e.preventDefault&&e.preventDefault(),this.setValues(),this.model.isValid()&&this.getSaveableModel().isValid()?void t.runOperationShowingMessage(n("Saving"),function(){var e=$.Deferred(),t=this.getSaveableModel();return t.save({},{success:function(){t.setOriginalAttributes(),this.close(),e.resolve()}.bind(this)}),e}.bind(this)):!1},cancel:function(e){return e&&e.preventDefault&&e.preventDefault(),this.getSaveableModel().reset(),this.close()},close:function(){return this.remove(),this.model.isNew()&&!i.isUndefined(this.model.collection)?this.model.collection.remove(this.model):this.model.set("editing",!1),this}});return s}),define("text!templates/certificate-editor.underscore",[],function(){return'<form class="collection-edit-form certificate-edit-form">\n    <div aria-live="polite">\n    <% if (error && error.message) { %>\n        <div class="certificate-edit-error message message-status message-status error is-shown" name="certificate-edit-error">\n          <%- gettext(error.message) %>\n        </div>\n    <% } %>\n    </div>\n    <div class="wrapper-form">\n        <fieldset class="collection-fields certificate-fields">\n            <legend class="sr"><%- gettext("Certificate Information") %></legend>\n            <div class="sr input-wrap field text required add-collection-name add-certificate-name <% if(error && error.attributes && error.attributes.name) { print(\'error\'); } %>">\n                <label for="certificate-name-<%- uniqueId %>"><%- gettext("Certificate Name") %></label>\n                <input id="certificate-name-<%- uniqueId %>" class="collection-name-input input-text" name="certificate-name" type="text" placeholder="<%- gettext("Name of the certificate") %>" value="<%- name %>" aria-describedby="certificate-name-<%-uniqueId %>-tip" />\n                <span id="certificate-name-<%- uniqueId %>-tip" class="tip tip-stacked"><%- gettext("Name of the certificate") %></span>\n            </div>\n            <div class="sr input-wrap field text add-certificate-description">\n                <label for="certificate-description-<%- uniqueId %>"><%- gettext("Description") %></label>\n                <textarea id="certificate-description-<%- uniqueId %>" class="certificate-description-input text input-text" name="certificate-description" placeholder="<%- gettext("Description of the certificate") %>" aria-describedby="certificate-description-<%-uniqueId %>-tip"><%- description %></textarea>\n                <span id="certificate-description-<%- uniqueId %>-tip" class="tip tip-stacked"><%- gettext("Description of the certificate") %></span>\n            </div>\n            <header>\n              <h2 class="title title-2"><%- gettext("Certificate Details") %></h2>\n            </header>\n            <div class="actual-course-title">\n                <span class="actual-course-title"><%- gettext("Course Title") %>: </span>\n                <span class="actual-title"><%- course.get(\'name\') %></span>\n            </div>\n            <div class="input-wrap field text add-certificate-course-title">\n                <label for="certificate-course-title-<%- uniqueId %>"><%- gettext("Course Title Override") %></label>\n                <input id="certificate-course-title-<%- uniqueId %>" class="certificate-course-title-input input-text" name="certificate-course-title" type="text" placeholder="<%- gettext("Course title") %>" value="<%- course_title %>" aria-describedby="certificate-course-title-<%-uniqueId %>-tip" />\n                <span id="certificate-course-title-<%- uniqueId %>-tip" class="tip tip-stacked"><%- gettext("Specify an alternative to the official course title to display on certificates. Leave blank to use the official course title.") %></span>\n            </div>\n        </fieldset>\n         <header>\n            <h2 class="title title-2"><%- gettext("Certificate Signatories") %></h2>\n         </header>\n         <p class="instructions"><%- gettext("It is strongly recommended that you include four or fewer signatories. If you include additional signatories, preview the certificate in Print View to ensure the certificate will print correctly on one page.") %></p>\n        <div class="signatory-edit-list"> </div>\n        <span>\n           <button class="action action-add-signatory" type="button"><%- gettext("Add Additional Signatory") %></button>\n           <span class="tip tip-stacked"><%- gettext("(Add signatories for a certificate)") %></span>\n        </span>\n    </div>\n    <div class="actions">\n        <button class="action action-primary" type="submit"><% if (isNew) { print(gettext("Create")) } else { print(gettext("Save")) } %></button>\n        <button class="action action-secondary action-cancel"><%- gettext("Cancel") %></button>\n        <% if (!isNew && (CMS.User.isGlobalStaff || !is_active)) { %>\n            <span class="wrapper-delete-button">\n                <a class="button action-delete delete" href="#"><%- gettext("Delete") %></a>\n            </span>\n        <% } %>\n    </div>\n</form>\n'}),define("js/certificates/views/certificate_editor",["jquery","underscore","backbone","gettext","js/views/list_item_editor","js/certificates/models/signatory","js/certificates/views/signatory_editor","text!templates/certificate-editor.underscore"],function(e,t,i,n,s,o,a,r){"use strict";var l=100,c=s.extend({tagName:"div",events:{"change .collection-name-input":"setName","change .certificate-description-input":"setDescription","change .certificate-course-title-input":"setCourseTitle","focus .input-text":"onFocus","blur .input-text":"onBlur",submit:"setAndClose","click .action-cancel":"cancel","click .action-add-signatory":"addSignatory"},className:function(){var e=this.model.collection.indexOf(this.model);return["collection-edit","certificates","certificate-edit","certificate-edit-"+e].join(" ")},initialize:function(e){t.bindAll(this,"onSignatoryRemoved","clearErrorMessage"),this.max_signatories_limit=e.max_signatories_limit||l,this.template=t.template(r),this.eventAgg=t.extend({},i.Events),this.eventAgg.bind("onSignatoryRemoved",this.onSignatoryRemoved),this.eventAgg.bind("onSignatoryUpdated",this.clearErrorMessage),s.prototype.initialize.call(this)},onSignatoryRemoved:function(){this.model.setOriginalAttributes(),this.render()},clearErrorMessage:function(){this.$(".certificate-edit-error").remove()},render:function(){s.prototype.render.call(this);var t=this;return this.model.get("signatories").each(function(i){var n=new a({model:i,isEditingAllCollections:!0,eventAgg:t.eventAgg});t.$("div.signatory-edit-list").append(e(n.render()))}),this.disableAddSignatoryButton(),this},addSignatory:function(){new o({certificate:this.getSaveableModel()});this.render()},disableAddSignatoryButton:function(){this.$(".signatory-edit-list > div.signatory-edit").length>=this.max_signatories_limit&&this.$(".action-add-signatory").addClass("disableClick")},getTemplateOptions:function(){return{id:this.model.get("id"),uniqueId:t.uniqueId(),name:this.model.get("name"),description:this.model.get("description"),course_title:this.model.get("course_title"),org_logo_path:this.model.get("org_logo_path"),is_active:this.model.get("is_active"),isNew:this.model.isNew()}},getSaveableModel:function(){return this.model},setName:function(e){e&&e.preventDefault&&e.preventDefault(),this.model.set("name",this.$(".collection-name-input").val(),{silent:!0})},setDescription:function(e){e&&e.preventDefault&&e.preventDefault(),this.model.set("description",this.$(".certificate-description-input").val(),{silent:!0})},setCourseTitle:function(e){e&&e.preventDefault&&e.preventDefault(),this.model.set("course_title",this.$(".certificate-course-title-input").val(),{silent:!0})},setValues:function(){return this.setName(),this.setDescription(),this.setCourseTitle(),this}});return c}),define("js/certificates/views/certificate_item",["gettext","js/views/list_item","js/certificates/views/certificate_details","js/certificates/views/certificate_editor"],function(e,t,i,n){"use strict";var s=t.extend({events:{"click .delete":"deleteItem"},tagName:"section",baseClassName:"certificate",canDelete:!0,itemDisplayName:e("certificate"),attributes:function(){return{id:this.model.get("id"),tabindex:-1}},createEditView:function(){return new n({model:this.model})},createDetailsView:function(){return new i({model:this.model})}});return s}),define("js/certificates/views/certificates_list",["gettext","js/views/list","js/certificates/views/certificate_item"],function(e,t,i){"use strict";var n=t.extend({tagName:"div",className:"certificates-list",newModelOptions:{},itemCategoryDisplayName:e("certificate"),newItemMessage:e("Set up your certificate"),emptyMessage:e("You have not created any certificates yet."),createItemView:function(e){return new i(e)}});return n}),define("js/certificates/views/certificates_page",["jquery","underscore","gettext","js/views/pages/base_page","js/certificates/views/certificates_list"],function(e,t,i,n,s){"use strict";var o=n.extend({initialize:function(e){n.prototype.initialize.call(this),this.certificatesCollection=e.certificatesCollection,this.certificatesListView=new s({collection:this.certificatesCollection})},renderPage:function(){return this.$(".wrapper-certificates.certificates-list").append(this.certificatesListView.render().el),e.Deferred().resolve().promise()}});return o}),define("text!templates/certificate-web-preview.underscore",[],function(){return'<label for="course-modes"><%= gettext("Choose mode") %></label>\n<select id="course-modes">\n<% _.each(course_modes, function(course_mode) { %>\n     <option value= "<%= course_mode %>"><%= course_mode %></option>\n<% }); %>\n</select>\n<a href=<%= certificate_web_view_url %> class="button preview-certificate-link" target="_blank">\n    <%= gettext("Preview Certificate") %>\n</a>\n<button class="button activate-cert">\n    <span>\n    <% if(!is_active) { %>\n        <%= gettext("Activate") %></span>\n    <% } else { %>\n        <%= gettext("Deactivate") %></span>\n    <% } %>\n</button>\n'}),define("js/certificates/views/certificate_preview",["underscore","gettext","js/views/baseview","common/js/components/utils/view_utils","common/js/components/views/feedback_notification","text!templates/certificate-web-preview.underscore"],function(e,t,i,n,s,o){"use strict";var a=i.extend({el:$(".preview-certificate"),events:{"change #course-modes":"courseModeChanged","click .activate-cert":"toggleCertificateActivation"},initialize:function(e){this.course_modes=e.course_modes,this.certificate_web_view_url=e.certificate_web_view_url,this.certificate_activation_handler_url=e.certificate_activation_handler_url,this.is_active=e.is_active},render:function(){return this.$el.html(e.template(o)({course_modes:this.course_modes,certificate_web_view_url:this.certificate_web_view_url,is_active:this.is_active})),this},toggleCertificateActivation:function(){var e="Activating";this.is_active&&(e="Deactivating");var i=new s.Mini({title:t(e)});$.ajax({url:this.certificate_activation_handler_url,type:"POST",dataType:"json",contentType:"application/json",data:JSON.stringify({is_active:!this.is_active}),beforeSend:function(){i.show()},success:function(){i.hide(),location.reload()}})},courseModeChanged:function(e){$(".preview-certificate-link").attr("href",function(t,i){return i.replace(/preview=([^&]+)/,function(){return"preview="+e.target.options[e.target.selectedIndex].text})})},show:function(){this.render()},remove:function(){return this.is_active=!1,this.$el.empty(),this}});return a}),define("js/certificates/factories/certificates_page_factory",["jquery","js/certificates/collections/certificates","js/certificates/models/certificate","js/certificates/views/certificates_page","js/certificates/views/certificate_preview"],function(e,t,i,n,s){"use strict";return function(i,o,a,r,l,c,d){var u=new t(i,{parse:!0,canBeEmpty:!0,certificateUrl:o});!window.certWebPreview&&l&&(window.certWebPreview=new s({course_modes:r,certificate_web_view_url:l,certificate_activation_handler_url:d,is_active:c})),new n({el:e("#content"),certificatesCollection:u}).render()}});