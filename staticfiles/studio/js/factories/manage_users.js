define("js/utils/handle_iframe_binding",["jquery"],function(e){var t=function(t){var i=null;i="undefined"==typeof t?e("iframe, embed"):"undefined"!=typeof t.nodeName?e(t).find("iframe, embed"):t.$("iframe, embed"),n(i)},n=function(t){t.each(function(){if("IFRAME"===e(this).prop("tagName")){var t=e(this).attr("src");if(t){var n="wmode=transparent";if(-1!==t.indexOf("?")){var i=t.split("?");if(-1===i[1].search("wmode=transparent")){var s=i[1],r=i[0];e(this).attr("src",r+"?"+n+"&"+s)}}else 0!==t.lastIndexOf("javascript:",0)&&e(this).attr("src",t+"?"+n)}}else e(this).attr("wmode","transparent")})},i=function(t){if(t){var i=null,s=document.createElement("div");e(s).html(t),i=e(s).find("iframe, embed"),i.length>0&&(n(i),t=e(s).html())}return t};return{iframeBinding:t,iframeBindingHtml:i}}),define("js/utils/templates",["jquery","underscore"],function(e,t){var n=function(n){var i="#"+n+"-tpl",s=e(i).text();return s||console.error("Failed to load "+n+" template"),t.template(s)};return{loadTemplate:n}}),define("text",{load:function(e){throw new Error("Dynamic load not allowed: "+e)}}),define("text!common/templates/components/system-feedback.underscore",[],function(){return'<div class="wrapper wrapper-<%= type %> wrapper-<%= type %>-<%= intent %>\n            <% if(obj.shown) { %>is-shown<% } else { %>is-hiding<% } %>\n            <% if(_.contains([\'help\', \'mini\'], intent)) { %>wrapper-<%= type %>-status<% } %>"\n     id="<%= type %>-<%= intent %>"\n     aria-hidden="<% if(obj.shown) { %>false<% } else { %>true<% } %>"\n     aria-labelledby="<%= type %>-<%= intent %>-title"\n     tabindex="-1"\n     <% if (obj.message) { %>aria-describedby="<%= type %>-<%= intent %>-description" <% } %>\n     <% if (obj.actions) { %>role="dialog"<% } %>\n  >\n  <div class="<%= type %> <%= intent %> <% if(obj.actions) { %>has-actions<% } %>">\n    <% if(obj.icon) { %>\n      <% var iconClass = {"warning": "warning", "confirmation": "check", "error": "warning", "announcement": "bullhorn", "step-required": "exclamation-circle", "help": "question", "mini": "cog"} %>\n      <span class="feedback-symbol fa fa-<%= iconClass[intent] %>" aria-hidden="true"></span>\n    <% } %>\n\n    <div class="copy">\n      <h2 class="title title-3" id="<%= type %>-<%= intent %>-title"><%- title %></h2>\n      <% if(obj.message) { %><p class="message" id="<%= type %>-<%= intent %>-description"><%- message %></p><% } %>\n    </div>\n\n    <% if(obj.actions) { %>\n    <nav class="nav-actions">\n      <ul>\n        <% if(actions.primary) { %>\n        <li class="nav-item">\n          <button class="action-primary <%= actions.primary.class %>"><%- actions.primary.text %></button>\n        </li>\n        <% } %>\n        <% if(actions.secondary) {\n             _.each(actions.secondary, function(secondary) { %>\n        <li class="nav-item">\n          <button class="action-secondary <%= secondary.class %>"><%- secondary.text %></button>\n        </li>\n        <%   });\n           } %>\n      </ul>\n    </nav>\n    <% } %>\n\n    <% if(obj.closeIcon) { %>\n    <a href="#" rel="view" class="action action-close action-<%= type %>-close">\n      <span class="icon fa fa-times-circle" aria-hidden="true"></span>\n      <span class="label">close <%= type %></span>\n    </a>\n    <% } %>\n  </div>\n</div>\n'}),function(e){"use strict";e("common/js/components/views/feedback",["jquery","underscore","underscore.string","backbone","edx-ui-toolkit/js/utils/html-utils","text!../../../../common/templates/components/system-feedback.underscore"],function(e,t,n,i,s,r){var o=["a[href]:not([tabindex='-1'])","area[href]:not([tabindex='-1'])","input:not([disabled]):not([tabindex='-1'])","select:not([disabled]):not([tabindex='-1'])","textarea:not([disabled]):not([tabindex='-1'])","button:not([disabled]):not([tabindex='-1'])","iframe:not([tabindex='-1'])","[tabindex]:not([tabindex='-1'])","[contentEditable=true]:not([tabindex='-1'])"],a=i.View.extend({options:{title:"",message:"",intent:null,type:null,shown:!0,icon:!0,closeIcon:!0,minShown:0,maxShown:1/0,outFocusElement:null},initialize:function(n){if(this.options=t.extend({},this.options,n),!this.options.type)throw"SystemFeedback: type required (given "+JSON.stringify(this.options)+")";if(!this.options.intent)throw"SystemFeedback: intent required (given "+JSON.stringify(this.options)+")";return this.setElement(e("#page-"+this.options.type)),this.options.actions&&this.options.actions.secondary&&!t.isArray(this.options.actions.secondary)&&(this.options.actions.secondary=[this.options.actions.secondary]),this},inFocus:function(e){var t,n=e||".wrapper";return this.options.outFocusElement=this.options.outFocusElement||document.activeElement,this.$(n).first().focus(),t=this.$(o.join()),t.on("keydown",function(e){9===e.which&&e.shiftKey&&e.target===t.first()[0]?(e.preventDefault(),t.last().focus()):9!==e.which||e.shiftKey||e.target!==t.last()[0]||(e.preventDefault(),t.first().focus())}),this},outFocus:function(){return this.$(o.join()).off("keydown"),this.options.outFocusElement&&this.options.outFocusElement.focus(),this},show:function(){return clearTimeout(this.hideTimeout),this.options.shown=!0,this.shownAt=new Date,this.render(),e.isNumeric(this.options.maxShown)&&(this.hideTimeout=setTimeout(t.bind(this.hide,this),this.options.maxShown)),this},hide:function(){return this.shownAt&&e.isNumeric(this.options.minShown)&&this.options.minShown>new Date-this.shownAt?(clearTimeout(this.hideTimeout),this.hideTimeout=setTimeout(t.bind(this.hide,this),this.options.minShown-(new Date-this.shownAt))):(this.options.shown=!1,delete this.shownAt,this.render()),this},events:{"click .action-close":"hide","click .action-primary":"primaryClick","click .action-secondary":"secondaryClick"},render:function(){var e=a["active_"+this.options.type];return e&&e!==this&&(e.stopListening(),e.undelegateEvents()),s.setHtml(this.$el,s.template(r)(this.options)),a["active_"+this.options.type]=this,this},primaryClick:function(e){var t,n;t=this.options.actions,t&&(n=t.primary,n&&(n.preventDefault!==!1&&e.preventDefault(),n.click&&n.click.call(e.target,this,e)))},secondaryClick:function(e){var n,i,s,r;n=this.options.actions,n&&(i=n.secondary,i&&(r=0,e&&e.target&&(r=t.indexOf(this.$(".action-secondary"),e.target)),s=i[r],s.preventDefault!==!1&&e.preventDefault(),s.click&&s.click.call(e.target,this,e)))}});return a})}.call(this,define||RequireJS.define),function(e){"use strict";e("common/js/components/views/feedback_notification",["jquery","underscore","underscore.string","./feedback"],function(e,t,n,i){var s,r,o,a=i.extend({options:e.extend({},i.prototype.options,{type:"notification",closeIcon:!1})});return s=t.compose(n.capitalize,n.camelize),r=["warning","error","confirmation","announcement","step-required","help","mini"],t.each(r,function(t){var n;n=a.extend({options:e.extend({},a.prototype.options,{intent:t})}),a[s(t)]=n}),o=a.Mini.prototype.options,o.minShown=1250,o.closeIcon=!1,a})}.call(this,define||RequireJS.define),function(e){"use strict";e("common/js/components/views/feedback_prompt",["jquery","underscore","underscore.string","common/js/components/views/feedback"],function(e,t,n,i){var s,r,o=i.extend({options:e.extend({},i.prototype.options,{type:"prompt",closeIcon:!1,icon:!1}),render:function(){return window.$body||(window.$body=e(document.body)),this.options.shown?$body.addClass("prompt-is-shown"):$body.removeClass("prompt-is-shown"),i.prototype.render.apply(this,arguments)},show:function(){return i.prototype.show.apply(this,arguments),this.inFocus()},hide:function(){return i.prototype.hide.apply(this,arguments),this.outFocus()}});return s=t.compose(n.capitalize,n.camelize),r=["warning","error","confirmation","announcement","step-required","help","mini"],t.each(r,function(t){var n;n=o.extend({options:e.extend({},o.prototype.options,{intent:t})}),o[s(t)]=n}),o})}.call(this,define||RequireJS.define),function(e,t){"use strict";e("common/js/components/utils/view_utils",["jquery","underscore","gettext","common/js/components/views/feedback_notification","common/js/components/views/feedback_prompt"],function(e,n,i,s,r){var o,a,l,c,u,d,h,p,m,f,g,y,v,w,b,k,x,E,_,j=65;return o=function(e,t){var n=t||"collapsed";e.closest(".expand-collapse").toggleClass("expand collapse"),e.closest(".is-collapsible, .window").toggleClass(n),e.closest(".is-collapsible").children("article").slideToggle()},a=function(){e(".ui-loading").show()},l=function(){e(".ui-loading").hide()},c=function(e,t,n,s,o){return new r.Warning({title:e,message:t,actions:{primary:{text:n,click:function(e){e.hide(),s()}},secondary:{text:i("Cancel"),click:function(e){return o&&o(),e.hide()}}}}).show()},u=function(e,t){var n;return n=new s.Mini({title:i(e)}),n.show(),t().done(function(){n.hide()})},d=function(t){return function(n){var i=this;h(e(n.currentTarget),function(){return i[t].apply(i,[n])})}},h=function(e,t){return e.addClass("is-disabled").attr("aria-disabled",!0),t().always(function(){e.removeClass("is-disabled").attr("aria-disabled",!1)})},w=function(t){return function(n){n.preventDefault(),e.ajax({url:e(this).data("dismiss-link"),type:"DELETE",success:t})}},f=function(t){e("html, body").animate({scrollTop:t},500)},p=function(t){var n=t.offset().top;return n-e(window).scrollTop()},m=function(e,t){var n=e.offset().top,i=n-t;f(i)},g=function(e){window.location=e},y=function(){window.location.reload()},v=function(e,t){var i,s=e.changedAttributes();if(!s)return!1;for(i=0;i<t.length;i++)if(n.has(s,t[i]))return!0;return!1},b=function(e){return 0===e.length?i("Required field."):""},k=function(e,t){var n=b(e);if(n)return n;if(t){if(/\s/g.test(e))return i("Please do not use any spaces in this field.")}else if(e!==encodeURIComponent(e)||e.match(/[!'()*]/))return i("Please do not use any spaces or special characters in this field.");return""},x=function(t){var i=n.reduce(t,function(t,n){return t+e(n).val().length},0);return j>=i},E=function(t,i,s,r){x(s)?e(t.errorWrapper).removeClass(i.shown).addClass(i.hiding):(e(t.errorWrapper).addClass(i.shown).removeClass(i.hiding),e(t.errorMessage).html("<p>"+n.template(r)({limit:j})+"</p>"),e(t.save).addClass(i.disabled))},_=function(n){var i=e.Deferred();return t([n],function(){i.resolve()},function(){i.reject()}),i.promise()},{toggleExpandCollapse:o,showLoadingIndicator:a,hideLoadingIndicator:l,confirmThenRunOperation:c,runOperationShowingMessage:u,withDisabledElement:d,disableElementWhileRunning:h,deleteNotificationHandler:w,setScrollTop:f,getScrollOffset:p,setScrollOffset:m,redirect:g,reload:y,hasChangedAttributes:v,validateRequiredField:b,validateURLItemEncoding:k,validateTotalKeyLength:x,checkTotalKeyLengthViolations:E,loadJavaScript:_}})}.call(this,define||RequireJS.define,require||RequireJS.require),define("js/views/baseview",["jquery","underscore","backbone","gettext","js/utils/handle_iframe_binding","js/utils/templates","common/js/components/utils/view_utils"],function(e,t,n,i,s,r,o){var a=n.View.extend({events:{"click .ui-toggle-expansion":"toggleExpandCollapse"},options:{collapsedClass:"collapsed"},constructor:function(e){t.bindAll(this,"beforeRender","render","afterRender"),this.options&&(e=t.extend({},t.result(this,"options"),e)),Math.trunc||(Math.trunc=function(e){return e=+e,e-e%1||(isFinite(e)&&0!==e?0>e?-0:0:e)}),this.options=e;var i=this;this.render=t.wrap(this.render,function(e,t){return i.beforeRender(),e(t),i.afterRender(),i}),n.View.prototype.constructor.apply(this,arguments)},beforeRender:function(){},render:function(){return this},afterRender:function(){s.iframeBinding(this)},toggleExpandCollapse:function(t){var n=e(t.target);t.stopPropagation(),t.preventDefault(),o.toggleExpandCollapse(n,this.options.collapsedClass)},loadTemplate:function(e){return r.loadTemplate(e)}});return a}),define("js/views/manage_users_and_roles",["jquery","underscore","gettext","js/views/baseview","common/js/components/views/feedback_prompt","common/js/components/utils/view_utils"],function(e,t,n,i,s,r){"use strict";function o(t){return new s.Error({title:t.invalidEmail.title,message:t.invalidEmail.message,actions:{primary:{text:t.invalidEmail.primaryAction,click:function(t){t.hide(),e("#user-email-input").focus()}}}})}function a(n,i,r){return new s.Warning({title:n.alreadyMember.title,message:t.template(n.alreadyMember.messageTpl,{interpolate:/\{(.+?)}/g})({email:i,container:r}),actions:{primary:{text:n.alreadyMember.primaryAction,click:function(t){t.hide(),e("#user-email-input").focus()}}}})}function l(e,t,n,i){return new s.Error({title:t,message:n,actions:{primary:{text:e.defaults.confirmation,click:function(e){e.hide(),i()}}}})}function c(t){return e(t).closest("li[data-email]").data("email")}var u={defaults:{confirmation:n("Ok"),changeRoleError:n("There was an error changing the user's role"),unknown:n("Unknown")},errors:{addUser:n("Error adding user"),deleteUser:n("Error removing user")},invalidEmail:{title:n("A valid email address is required"),message:n("You must enter a valid email address in order to add a new team member"),primaryAction:n("Return and add email address")},alreadyMember:{title:n("Already a member"),messageTpl:n("{email} is already on the {container} team. Recheck the email address if you want to add a new member."),primaryAction:n("Return to team listing")},deleteUser:{title:n("Are you sure?"),messageTpl:n("Are you sure you want to restrict {email} access to “{container}”?"),primaryAction:n("Delete"),secondaryAction:n("Cancel")}},d=i.extend({events:function(){for(var e={"click .create-user-button":"addUserHandler","submit #create-user-form":"createUserFormSubmit","click .action-cancel":"cancelEditHandler",keyup:"keyUpHandler","click .remove-user":"removeUserHandler"},n={},i=this,s=0;s<i.options.roles.length;s++){var r=i.options.roles[s].key,o="click .user-actions .make-"+r;!function(e){n[o]=function(t){i.handleRoleButtonClick(t.target,e)}}(r)}return t.extend(e,n)},initialize:function(e){i.prototype.initialize.call(this),this.containerName=e.containerName,this.tplUserURL=e.tplUserURL,this.roles=e.roles,this.users=e.users,this.allow_actions=e.allow_actions,this.current_user_id=e.current_user_id,this.initial_role=this.roles[0],this.admin_role=this.roles[this.roles.length-1];var t=e.messages_modifier||function(e){return e};this.messages=t(u),this.$userEmailInput=this.$el.find("#user-email-input"),this.$createUserButton=this.$el.find(".create-user-button"),this.$createUserFormWrapper=this.$el.find(".wrapper-create-user"),this.$cancelButton=this.$el.find(".action-cancel"),this.$userList=this.$el.find("#user-list")},render:function(){this.$userList.empty();for(var e=this.loadTemplate("team-member"),n=t.object(t.pluck(this.roles,"key"),t.pluck(this.roles,"name")),i=this.getAdminRoleCount(),s={format:function(e,n){return t.template(e,{interpolate:/\{(.+?)}/g})(n)}},r=0;r<this.users.length;r++){var o=this.users[r],a=this.current_user_id==o.id,l={user:o,actions:this.getPossibleRoleChangesForRole(o.role,i),roles:n,allow_delete:!(o.role===this.admin_role.key&&1===i),allow_actions:this.allow_actions,is_current_user:a,viewHelpers:s};this.$userList.append(e(l))}},getAdminRoleCount:function(){var e=this;return t.filter(this.users,function(t){return t.role===e.admin_role.key}).length},getPossibleRoleChangesForRole:function(e,n){var i=[],s=t.map(this.roles,function(e){return e.key});if(e===this.admin_role.key&&1===n)i.push({notoggle:!0});else for(var r=t.indexOf(s,e),o=this.roles.length-1;o>=0;o--){var a=this.roles[o];1===Math.abs(r-o)&&i.push({to_role:a.key,label:r>o?this.roles[r].name:a.name,direction:r>o?"remove":"add"})}return i},checkEmail:function(e){var n=t.map(this.users,function(e){return e.email});return e?t.contains(n,e)?{valid:!1,msg:a(this.messages,e,this.containerName)}:{valid:!0}:{valid:!1,msg:o(this.messages)}},changeRole:function(t,n,i){var s=this,o=this.tplUserURL.replace("@@EMAIL@@",t),a=i.errMessage||this.messages.defaults.changeRoleError,c=i.onSuccess||function(e){r.reload()},u=i.onError||function(){};e.ajax({url:o,type:n?"POST":"DELETE",dataType:"json",contentType:"application/json",data:JSON.stringify({role:n}),success:c,error:function(e,t,n){var i,r;try{i=JSON.parse(e.responseText).error||s.messages.defaults.unknown}catch(o){i=s.messages.defaults.unknown}r=l(s.messages,a,i,u),r.show()}})},handleRoleButtonClick:function(e,t){this.changeRole(c(e),t,{})},addUserHandler:function(e){e.preventDefault(),this.$createUserButton.toggleClass("is-disabled").attr("aria-disabled",this.$createUserButton.hasClass("is-disabled")),this.$createUserFormWrapper.toggleClass("is-shown"),this.$userEmailInput.focus()},cancelEditHandler:function(e){e.preventDefault(),this.$createUserButton.toggleClass("is-disabled").attr("aria-disabled",this.$createUserButton.hasClass("is-disabled")),this.$createUserFormWrapper.toggleClass("is-shown"),this.$userEmailInput.val("")},createUserFormSubmit:function(e){e.preventDefault();var t=this,n=this.$userEmailInput.val().trim(),i=this.checkEmail(n);return i.valid?void this.changeRole(n,this.initial_role.key,{errMessage:this.messages.errors.addUser,onError:function(){t.$userEmailInput.focus()}}):void i.msg.show()},keyUpHandler:function(e){e.which===jQuery.ui.keyCode.ESCAPE&&this.$createUserFormWrapper.is(".is-shown")&&this.$cancelButton.click()},removeUserHandler:function(e){e.preventDefault();var n=this,i=c(e.target),r=new s.Warning({title:n.messages.deleteUser.title,message:t.template(n.messages.deleteUser.messageTpl,{interpolate:/\{(.+?)}/g})({email:i,container:n.containerName}),actions:{primary:{text:n.messages.deleteUser.primaryAction,click:function(e){e.hide(),n.changeRole(i,null,{errMessage:n.messages.errors.deleteUser})}},secondary:{text:n.messages.deleteUser.secondaryAction,click:function(e){e.hide()}}}});r.show()}});return d}),define("js/factories/manage_users",["underscore","gettext","js/views/manage_users_and_roles"],function(e,t,n){"use strict";return function(i,s,r,o,a){function l(n){var i=e.extend({},n);return i.alreadyMember.title=t("Already a course team member"),i.deleteUser.messageTpl=t("Are you sure you want to delete {email} from the course team for “{container}”?"),i}var c=[{key:"staff",name:t("Staff")},{key:"instructor",name:t("Admin")}],u={el:$("#content"),containerName:i,tplUserURL:r,roles:c,users:s,messages_modifier:l,current_user_id:o,allow_actions:a},d=new n(u);d.render()}});